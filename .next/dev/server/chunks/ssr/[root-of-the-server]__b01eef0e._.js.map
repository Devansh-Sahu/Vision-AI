{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/models.ts"],"sourcesContent":["// lib/models.ts\r\n// Self-hosted TFJS FaceMesh + MediaPipe Object Detector\r\n\r\nimport * as tf from \"@tensorflow/tfjs\"\r\nimport { ObjectDetector, FilesetResolver } from \"@mediapipe/tasks-vision\"\r\n\r\nlet faceMeshModel: tf.GraphModel | null = null\r\nlet modelsLoaded = false\r\n\r\nlet faceMeshLoadingPromise: Promise<void> | null = null\r\n\r\n// -------------------------------\r\n// Load MediaPipe Object Detector\r\n// -------------------------------\r\n\r\nlet objectDetector: ObjectDetector | null = null\r\nlet objectLoadingPromise: Promise<void> | null = null\r\n\r\nexport async function loadModels() {\r\n  if (modelsLoaded) return\r\n  if (typeof window === \"undefined\") return\r\n  if (objectLoadingPromise) return objectLoadingPromise\r\n\r\n  objectLoadingPromise = (async () => {\r\n    try {\r\n      const vision = await FilesetResolver.forVisionTasks(\r\n        \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.8/wasm\"\r\n      );\r\n\r\n      // Use Lite0 for maximum speed (user requested \"highly fast\")\r\n      objectDetector = await ObjectDetector.createFromOptions(vision, {\r\n        baseOptions: {\r\n          modelAssetPath: `https://storage.googleapis.com/mediapipe-models/object_detector/efficientdet_lite0/float32/1/efficientdet_lite0.tflite`,\r\n          delegate: \"GPU\"\r\n        },\r\n        scoreThreshold: 0.25, // Lower threshold to detect small/far animals\r\n        runningMode: \"VIDEO\"\r\n      });\r\n\r\n      console.log(\"MediaPipe EfficientDet-Lite0 loaded\")\r\n      modelsLoaded = true\r\n    } catch (err) {\r\n      console.error(\"Error loading MediaPipe Detector:\", err)\r\n    }\r\n  })()\r\n\r\n  return objectLoadingPromise\r\n}\r\n\r\nexport function getObjectDetector() {\r\n  return objectDetector\r\n}\r\n\r\n// ----------------------------------------\r\n// Load FaceMesh graph model (self-hosted)\r\n// ----------------------------------------\r\nexport async function ensureFaceMeshLoaded() {\r\n  if (faceMeshModel) return\r\n  if (typeof window === \"undefined\") return\r\n  if (faceMeshLoadingPromise) return faceMeshLoadingPromise\r\n\r\n  faceMeshLoadingPromise = (async () => {\r\n    try {\r\n\r\n\r\n      faceMeshModel = await tf.loadGraphModel(\r\n        \"/models/facemesh/model.json\",\r\n        { fromTFHub: false }\r\n      )\r\n\r\n      console.log(\"FaceMesh model loaded (local)\")\r\n    } catch (err) {\r\n      console.error(\"Failed to load FaceMesh:\", err)\r\n      faceMeshModel = null\r\n    }\r\n  })()\r\n\r\n  return faceMeshLoadingPromise\r\n}\r\n\r\nexport function getFaceMeshModel() {\r\n  return faceMeshModel\r\n}\r\n\r\n// -----------------------------------------------\r\n// Run FaceMesh inference and return raw tensors\r\n// -----------------------------------------------\r\nexport async function runFaceMesh(video: HTMLVideoElement) {\r\n  if (!faceMeshModel) return null\r\n\r\n  try {\r\n    const input = tf.tidy(() => {\r\n      return tf.browser.fromPixels(video)\r\n        .resizeBilinear([192, 192])\r\n        .expandDims(0)\r\n        .toFloat()\r\n        .div(127.5)\r\n        .sub(1) // Normalize to [-1, 1]\r\n    })\r\n\r\n    // Get model output using the correct output names from the model\r\n    // Using execute() instead of executeAsync() since we don't have dynamic output shapes\r\n    const outputs = faceMeshModel.execute(input, [\r\n      'Identity_2', // output_mesh (landmarks)\r\n      'Identity_1', // output_faceflag (confidence)\r\n      'Identity'    // output_contours\r\n    ]) as tf.Tensor[]\r\n\r\n    // Clean up input tensor\r\n    input.dispose()\r\n\r\n    try {\r\n      // Convert to arrays for debugging\r\n      const [landmarksData, faceFlagData] = await Promise.all([\r\n        outputs[0].array() as Promise<number[][]>,\r\n        outputs[1].array() as Promise<number[][]>\r\n      ])\r\n\r\n      // Clean up output tensors\r\n      outputs.forEach(t => t.dispose())\r\n\r\n      // Check for valid output\r\n      if (!landmarksData?.[0] || !faceFlagData?.[0]) {\r\n        console.warn('No face detected or invalid output format')\r\n        return null\r\n      }\r\n\r\n      // Return the raw tensors for further processing\r\n      // Convert to tensors with proper shapes\r\n      const landmarksTensor = tf.tensor2d(landmarksData, [landmarksData.length, landmarksData[0].length])\r\n      const confidenceTensor = tf.tensor1d(faceFlagData[0])\r\n\r\n      return [landmarksTensor, confidenceTensor]\r\n    } catch (error) {\r\n      console.error('Error processing face mesh output:', error)\r\n      // Ensure cleanup on error\r\n      for (const t of outputs) {\r\n        try {\r\n          t.dispose()\r\n        } catch (e) {\r\n          console.warn('Error disposing tensor:', e)\r\n        }\r\n      }\r\n      return null\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in runFaceMesh:', error)\r\n    return null\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;AAChB,wDAAwD;;;;;;;;;;;;;AAExD;AAAA;AAAA;AAAA;AAAA;AACA;;;AAEA,IAAI,gBAAsC;AAC1C,IAAI,eAAe;AAEnB,IAAI,yBAA+C;AAEnD,kCAAkC;AAClC,iCAAiC;AACjC,kCAAkC;AAElC,IAAI,iBAAwC;AAC5C,IAAI,uBAA6C;AAE1C,eAAe;IACpB,IAAI,cAAc;IAClB,wCAAmC;;;AA2BrC;AAEO,SAAS;IACd,OAAO;AACT;AAKO,eAAe;IACpB,IAAI,eAAe;IACnB,wCAAmC;;;AAoBrC;AAEO,SAAS;IACd,OAAO;AACT;AAKO,eAAe,YAAY,KAAuB;IACvD,IAAI,CAAC,eAAe,OAAO;IAE3B,IAAI;QACF,MAAM,QAAQ,uKAAO,CAAC;YACpB,OAAO,oNAAU,CAAC,UAAU,CAAC,OAC1B,cAAc,CAAC;gBAAC;gBAAK;aAAI,EACzB,UAAU,CAAC,GACX,OAAO,GACP,GAAG,CAAC,OACJ,GAAG,CAAC,GAAG,uBAAuB;;QACnC;QAEA,iEAAiE;QACjE,sFAAsF;QACtF,MAAM,UAAU,cAAc,OAAO,CAAC,OAAO;YAC3C;YACA;YACA,WAAc,kBAAkB;SACjC;QAED,wBAAwB;QACxB,MAAM,OAAO;QAEb,IAAI;YACF,kCAAkC;YAClC,MAAM,CAAC,eAAe,aAAa,GAAG,MAAM,QAAQ,GAAG,CAAC;gBACtD,OAAO,CAAC,EAAE,CAAC,KAAK;gBAChB,OAAO,CAAC,EAAE,CAAC,KAAK;aACjB;YAED,0BAA0B;YAC1B,QAAQ,OAAO,CAAC,CAAA,IAAK,EAAE,OAAO;YAE9B,yBAAyB;YACzB,IAAI,CAAC,eAAe,CAAC,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE;gBAC7C,QAAQ,IAAI,CAAC;gBACb,OAAO;YACT;YAEA,gDAAgD;YAChD,wCAAwC;YACxC,MAAM,kBAAkB,mLAAW,CAAC,eAAe;gBAAC,cAAc,MAAM;gBAAE,aAAa,CAAC,EAAE,CAAC,MAAM;aAAC;YAClG,MAAM,mBAAmB,mLAAW,CAAC,YAAY,CAAC,EAAE;YAEpD,OAAO;gBAAC;gBAAiB;aAAiB;QAC5C,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sCAAsC;YACpD,0BAA0B;YAC1B,KAAK,MAAM,KAAK,QAAS;gBACvB,IAAI;oBACF,EAAE,OAAO;gBACX,EAAE,OAAO,GAAG;oBACV,QAAQ,IAAI,CAAC,2BAA2B;gBAC1C;YACF;YACA,OAAO;QACT;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;IACT;AACF"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/sounds.ts"],"sourcesContent":["// Soft alert sound (using Web Audio API for better control)\nclass AlertSound {\n  private audioContext: AudioContext | null = null;\n  private oscillator: OscillatorNode | null = null;\n  private gainNode: GainNode | null = null;\n  \n  constructor() {\n    // Initialize audio context on user interaction\n    if (typeof window !== 'undefined') {\n      window.addEventListener('click', this.initAudio, { once: true });\n    }\n  }\n\n  private initAudio = () => {\n    if (this.audioContext) return;\n    \n    try {\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n      this.gainNode = this.audioContext.createGain();\n      this.gainNode.gain.value = 0.3; // 30% volume\n      this.gainNode.connect(this.audioContext.destination);\n    } catch (e) {\n      console.warn('Web Audio API not supported', e);\n    }\n  };\n\n  play() {\n    if (!this.audioContext) this.initAudio();\n    if (!this.audioContext || !this.gainNode) return;\n\n    // Stop any existing sound\n    if (this.oscillator) {\n      this.oscillator.stop();\n    }\n\n    // Create oscillator for the alert sound\n    this.oscillator = this.audioContext.createOscillator();\n    this.oscillator.type = 'sine';\n    this.oscillator.frequency.setValueAtTime(880, this.audioContext.currentTime); // A5 note\n    this.oscillator.frequency.exponentialRampToValueAtTime(\n      440, \n      this.audioContext.currentTime + 0.5 // Ramp down to A4 over 0.5s\n    );\n    \n    // Connect and play\n    this.oscillator.connect(this.gainNode);\n    this.oscillator.start();\n    this.oscillator.stop(this.audioContext.currentTime + 1); // Stop after 1 second\n  }\n}\n\nexport const alertSound = new AlertSound();\n"],"names":[],"mappings":"AAAA,4DAA4D;;;;;AAC5D,MAAM;IACI,eAAoC,KAAK;IACzC,aAAoC,KAAK;IACzC,WAA4B,KAAK;IAEzC,aAAc;QACZ,+CAA+C;QAC/C;;IAGF;IAEQ,YAAY;QAClB,IAAI,IAAI,CAAC,YAAY,EAAE;QAEvB,IAAI;YACF,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,OAAO,YAAY,IAAI,AAAC,OAAe,kBAAkB;YAClF,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,YAAY,CAAC,UAAU;YAC5C,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,GAAG,KAAK,aAAa;YAC7C,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW;QACrD,EAAE,OAAO,GAAG;YACV,QAAQ,IAAI,CAAC,+BAA+B;QAC9C;IACF,EAAE;IAEF,OAAO;QACL,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS;QACtC,IAAI,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;QAE1C,0BAA0B;QAC1B,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,UAAU,CAAC,IAAI;QACtB;QAEA,wCAAwC;QACxC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,gBAAgB;QACpD,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG;QACvB,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,cAAc,CAAC,KAAK,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,UAAU;QACxF,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,4BAA4B,CACpD,KACA,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,4BAA4B;;QAGlE,mBAAmB;QACnB,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ;QACrC,IAAI,CAAC,UAAU,CAAC,KAAK;QACrB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,sBAAsB;IACjF;AACF;AAEO,MAAM,aAAa,IAAI"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/biometric-eye-model.ts"],"sourcesContent":["import { DrowsinessMetrics } from \"./types\"\r\n\r\n// --- Constants & Config ---\r\n\r\nconst LANDMARKS = {\r\n    // Standard 6-point eye definition for MediaPipe FaceMesh\r\n    // P1: Left Corner, P2: Top Outer, P3: Top Inner, P4: Right Corner, P5: Bot Inner, P6: Bot Outer\r\n    LEFT_EYE: [33, 160, 158, 133, 153, 144],\r\n    RIGHT_EYE: [263, 387, 385, 362, 380, 373],\r\n}\r\n\r\ntype Point = { x: number; y: number; z?: number }\r\n\r\ninterface EyeGeometry {\r\n    ear: number\r\n    verticalDist: number\r\n    horizontalWith: number\r\n    // A measure of how much the upper lid deviates from the straight line connecting corners\r\n    upperLidCurvature: number\r\n}\r\n\r\ninterface EyeStateInternal {\r\n    opennessPercent: number // 0-100\r\n    rawOpennessMetric: number // The raw fused metric before normalization\r\n    velocity: number // deg/sec or unit/sec\r\n    isBlink: boolean\r\n    isMicrosleep: boolean\r\n    isDrowsy: boolean\r\n    confidence: number\r\n}\r\n\r\n/**\r\n * OneEuroFilter for signal smoothing (jitter reduction + responsiveness)\r\n */\r\nclass OneEuroFilter {\r\n    private minCutoff: number\r\n    private beta: number\r\n    private dCutoff: number\r\n    private dxPrev: number = 0\r\n    private xPrev: number | null = null\r\n    private tPrev: number | null = null\r\n\r\n    constructor(minCutoff = 1.0, beta = 0.0, dCutoff = 1.0) {\r\n        this.minCutoff = minCutoff\r\n        this.beta = beta\r\n        this.dCutoff = dCutoff\r\n    }\r\n\r\n    filter(x: number, t: number = Date.now()): number {\r\n        if (this.xPrev === null || this.tPrev === null) {\r\n            this.xPrev = x\r\n            this.tPrev = t\r\n            return x\r\n        }\r\n\r\n        const dt = (t - this.tPrev) / 1000.0\r\n        if (dt === 0) return this.xPrev // Force distinct timestamps\r\n\r\n        const a_d = this.smoothingFactor(dt, this.dCutoff)\r\n        const dx = (x - this.xPrev) / dt\r\n        const dxHat = this.exponentialSmoothing(a_d, dx, this.dxPrev)\r\n\r\n        const cutoff = this.minCutoff + this.beta * Math.abs(dxHat)\r\n        const a = this.smoothingFactor(dt, cutoff)\r\n        const xHat = this.exponentialSmoothing(a, x, this.xPrev)\r\n\r\n        this.xPrev = xHat\r\n        this.dxPrev = dxHat\r\n        this.tPrev = t\r\n        return xHat\r\n    }\r\n\r\n    private smoothingFactor(dt: number, cutoff: number): number {\r\n        const r = 2 * Math.PI * cutoff\r\n        return r * dt / (1 + r * dt)\r\n    }\r\n\r\n    private exponentialSmoothing(a: number, x: number, xPrev: number): number {\r\n        return a * x + (1 - a) * xPrev\r\n    }\r\n\r\n    reset() {\r\n        this.xPrev = null;\r\n        this.tPrev = null;\r\n        this.dxPrev = 0;\r\n    }\r\n}\r\n\r\n/**\r\n * Biometric Eye Engine\r\n * Encapsulates geometry, calibration, and temporal state.\r\n */\r\nexport class BiometricEyeEngine {\r\n    // Calibration State\r\n    // We track \"Open\" (approx 95th percentile) and \"Closed\" (absolute min during blinks)\r\n    // We use asymmetric learning rates to push boundaries\r\n    private calibration = {\r\n        openBaseline: 0.30, // Default to a healthy open eye value\r\n        closedBaseline: 0.10, // Default to fully closed\r\n        isInitialized: false,\r\n        samples: 0\r\n    }\r\n\r\n    // Filters\r\n    private opennessFilter = new OneEuroFilter(2.0, 0.01, 1.0) // More responsive, less lag\r\n    private velocityFilter = new OneEuroFilter(10.0, 0.0) // Fast response for velocity\r\n\r\n    // State Tracking\r\n    private lastMetric: number = 0.3\r\n    private lastTime: number = 0\r\n\r\n    // Event State\r\n    private blinkStartTime: number | null = null\r\n    private microsleepStartTime: number | null = null\r\n\r\n    constructor() {\r\n        this.lastTime = Date.now()\r\n    }\r\n\r\n    /**\r\n     * Main Process Loop\r\n     */\r\n    public processFrame(landmarks: Point[]): EyeStateInternal | null {\r\n        const now = Date.now()\r\n\r\n        // 1. Extract Geometry\r\n        const leftEye = this.getEyeGeometry(landmarks, LANDMARKS.LEFT_EYE)\r\n        const rightEye = this.getEyeGeometry(landmarks, LANDMARKS.RIGHT_EYE)\r\n\r\n        if (!leftEye || !rightEye) return null\r\n\r\n        // 2. Fusion Logic: Weighted average favoring stability\r\n        const avgEAR = (leftEye.ear + rightEye.ear) / 2\r\n\r\n        const rawMetric = avgEAR\r\n\r\n        // 3. Adaptive Calibration with Safety Bounds\r\n        this.updateCalibration(rawMetric)\r\n\r\n        // 4. Perceptual Normalization\r\n        // Map raw metric to 0-100% based on learnt range\r\n        const normalizedOpenness = this.computePerceptualOpenness(rawMetric)\r\n\r\n        // 5. Temporal Smoothing\r\n        const smoothedOpenness = this.opennessFilter.filter(normalizedOpenness, now)\r\n\r\n        // 6. Velocity Calculation\r\n        const dt = (now - this.lastTime) / 1000\r\n        // Only calc velocity if time progressed\r\n        let velocity = 0;\r\n        if (dt > 0) {\r\n            velocity = (smoothedOpenness - this.lastMetric) / dt\r\n        }\r\n        this.lastMetric = smoothedOpenness\r\n        this.lastTime = now\r\n\r\n        // 7. Event Detection (Blinks, Microsleeps)\r\n        const state = this.detectEvents(smoothedOpenness, velocity, now)\r\n\r\n        return {\r\n            opennessPercent: smoothedOpenness,\r\n            rawOpennessMetric: rawMetric,\r\n            velocity,\r\n            ...state\r\n        }\r\n    }\r\n\r\n    private getEyeGeometry(landmarks: Point[], indices: number[]): EyeGeometry | null {\r\n        // Need all points\r\n        const points = indices.map(i => landmarks[i])\r\n        if (points.some(p => !p)) return null\r\n\r\n        const [p1, p2, p3, p4, p5, p6] = points\r\n\r\n        // Vertical 1: p2 -> p6\r\n        const v1 = this.distance(p2, p6)\r\n        // Vertical 2: p3 -> p5\r\n        const v2 = this.distance(p3, p5)\r\n        // Horizontal: p1 -> p4\r\n        const h = this.distance(p1, p4)\r\n\r\n        if (h < 1e-4) return null // Avoid div by zero\r\n\r\n        const ear = (v1 + v2) / (2 * h)\r\n\r\n        return {\r\n            ear,\r\n            verticalDist: (v1 + v2) / 2,\r\n            horizontalWith: h,\r\n            upperLidCurvature: 0\r\n        }\r\n    }\r\n\r\n    private distance(a: Point, b: Point): number {\r\n        return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2))\r\n    }\r\n\r\n    /**\r\n     * Adapts the Open/Closed baselines over time.\r\n     * STRICT SAFETY: We prevent the baselines from \"collapsing\" (Open becoming == Closed).\r\n     * We also enforce absolute limits so \"Closed\" never looks \"Open\".\r\n     */\r\n    private updateCalibration(val: number) {\r\n        if (!this.calibration.isInitialized) {\r\n            // Initialization Phase (First 60 frames / ~2 sec)\r\n            // Just aggressively expand bounds\r\n            if (this.calibration.samples < 60) {\r\n                this.calibration.openBaseline = Math.max(0.25, Math.max(this.calibration.openBaseline, val))\r\n                this.calibration.closedBaseline = Math.min(0.15, Math.min(this.calibration.closedBaseline, val))\r\n                this.calibration.samples++\r\n                return\r\n            } else {\r\n                this.calibration.isInitialized = true\r\n            }\r\n        }\r\n\r\n        // Dynamic Learning Rates\r\n        const learnUp = 0.05   // Fast adaptation to new max\r\n        const learnDown = 0.001 // Very slow decay to prevent \"drowsy\" drift\r\n\r\n        // 1. Update Open Baseline\r\n        // Only update if value is REASONABLE (not an outlier blink, not a glitch)\r\n        // We assume legitimate \"Open\" eyes are > 0.20\r\n        if (val > 0.20) {\r\n            if (val > this.calibration.openBaseline) {\r\n                // New local max found - adapt\r\n                this.calibration.openBaseline = val * learnUp + this.calibration.openBaseline * (1 - learnUp)\r\n            } else {\r\n                // Decay very slowly\r\n                this.calibration.openBaseline = this.calibration.openBaseline - (this.calibration.openBaseline * learnDown)\r\n            }\r\n        }\r\n\r\n        // 2. Update Closed Baseline\r\n        // Only consider values that look like blinks (< 0.20)\r\n        if (val < 0.20) {\r\n            if (val < this.calibration.closedBaseline) {\r\n                // New local min found - adapt\r\n                this.calibration.closedBaseline = val * learnUp + this.calibration.closedBaseline * (1 - learnUp)\r\n            } else {\r\n                // Decay\r\n                this.calibration.closedBaseline = this.calibration.closedBaseline + (this.calibration.closedBaseline * learnDown)\r\n            }\r\n        }\r\n\r\n        // 3. STRICT SAFETY CLAMPS (The Fix)\r\n        // Absolute physically possible limits for \"generic\" human eyes\r\n        // Open eyes are rarely < 0.22 EAR. Closed eyes are rarely > 0.18 EAR.\r\n        this.calibration.openBaseline = Math.max(0.24, Math.min(0.45, this.calibration.openBaseline))\r\n        this.calibration.closedBaseline = Math.max(0.05, Math.min(0.18, this.calibration.closedBaseline))\r\n\r\n        // Ensure Enforced Separation\r\n        if (this.calibration.openBaseline - this.calibration.closedBaseline < 0.10) {\r\n            // Push open baseline up if they get too close\r\n            this.calibration.openBaseline = this.calibration.closedBaseline + 0.10\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Non-linear mapping from metric to 0-100 perception.\r\n     */\r\n    private computePerceptualOpenness(val: number): number {\r\n        const { openBaseline, closedBaseline } = this.calibration\r\n\r\n        // HARD FORCE CLOSED Logic\r\n        // If EAR is below 0.15, it is physically impossible to be \"Open\". \r\n        // Return 0 immediately. This fixes the \"100% when closed\" bug.\r\n        if (val < 0.15) return 0;\r\n\r\n        // 0. Clamping relative to calibration\r\n        if (val <= closedBaseline) return 0\r\n        if (val >= openBaseline) return 100\r\n\r\n        // 1. Linear normalization\r\n        let t = (val - closedBaseline) / (openBaseline - closedBaseline)\r\n\r\n        // 2. Non-linear perception curve\r\n        // We want the 0-15% range effectively mapped to \"closed/nearly closed\"\r\n        // We want 80-100% mapped to \"fully open\"\r\n\r\n        let openness = 0;\r\n        if (t < 0.2) {\r\n            openness = (t / 0.2) * 5 // 0-5% (Basically closed)\r\n        } else if (t < 0.6) {\r\n            // Critical zone: 0.2 to 0.6 maps to 5% to 70%\r\n            // This makes the drop-off steeper\r\n            openness = 5 + ((t - 0.2) / 0.4) * 65\r\n        } else {\r\n            // Open zone: 0.6 to 1.0 maps to 70% to 100%\r\n            openness = 70 + ((t - 0.6) / 0.4) * 30\r\n        }\r\n\r\n        return openness\r\n    }\r\n\r\n    private detectEvents(openness: number, velocity: number, time: number) {\r\n        let isBlink = false\r\n        let isMicrosleep = false\r\n        let isDrowsy = false\r\n        let confidence = 1.0 // Placeholder\r\n\r\n        // Blink Logic\r\n        // If openness drops below 10% quickly, it's a blink\r\n        if (openness < 15) {\r\n            if (!this.blinkStartTime) {\r\n                this.blinkStartTime = time\r\n            }\r\n            isBlink = true\r\n\r\n            // Microwave/Long Closure Logic\r\n            const duration = time - this.blinkStartTime\r\n            if (duration > 500) { // > 500ms closed\r\n                isMicrosleep = true\r\n            }\r\n        } else {\r\n            // Reset blink timer if eyes open\r\n            if (openness > 30) {\r\n                this.blinkStartTime = null\r\n            }\r\n        }\r\n\r\n        // Drowsiness Logic (Composite)\r\n        // 1. Sustained partial closure (hovering at 30-50%)\r\n        // 2. High frequency of microsleeps (external logic usually handles freq, here we handle state)\r\n        // 3. Slow eyelid velocity (droopy)\r\n\r\n        if (openness > 15 && openness < 60 && Math.abs(velocity) < 10) {\r\n            // Eyes are half open and NOT moving much -> Drowsy/Droopy\r\n            isDrowsy = true\r\n        }\r\n\r\n        // Microsleep overrides drowsy\r\n        if (isMicrosleep) {\r\n            isDrowsy = true\r\n        }\r\n\r\n        return { isBlink, isMicrosleep, isDrowsy, confidence }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 514, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/hazard-guard.ts"],"sourcesContent":["import { HazardDetection, BoundingBox } from \"@/lib/types\"\r\n\r\n// Configuration Constants\r\nconst CONFIG = {\r\n    // Region of Interest (ROI) - Static Trapezoid for highway driving\r\n    // (Assuming camera mounted at dash height, center-aligned)\r\n    ROI_TOP_Y: 0.45,    // Horizon line approx\r\n    ROI_BOTTOM_Y: 1.0,  // Bottom of frame\r\n    ROI_LEFT_X_TOP: 0.40, // Narrow at horizon\r\n    ROI_RIGHT_X_TOP: 0.60,\r\n    ROI_LEFT_X_BOTTOM: 0.0, // Full width at bottom\r\n    ROI_RIGHT_X_BOTTOM: 1.0,\r\n\r\n    // Temporal Persistence\r\n    CONFIRMATION_FRAMES_CRITICAL: 1, // Persons/Cars = immediate (if confidence high)\r\n    CONFIRMATION_FRAMES_MEDIUM: 3,   // Potholes/Debris = wait 3 frames to reject noise\r\n    TRACK_IOU_THRESHOLD: 0.3,        // Loose matching for tracking\r\n    MAX_DROPOUT_FRAMES: 2,           // Keep track alive for 2 frames if detection missed\r\n\r\n    // Size Heuristics\r\n    MIN_RELATIVE_WIDTH: 0.02, // Objects smaller than 2% of screen width are likely noise/too far\r\n    MAX_DISTANCE_Z: 150,      // Meters (Approximate)\r\n\r\n    // Logic Thresholds\r\n    EGO_LANE_CENTER_X: 0.5,\r\n    EGO_LANE_WIDTH_AT_BOTTOM: 0.6, // +/- 0.3 from center\r\n    // WRONG_WAY_VELOCITY_THRESHOLD: 0.005, // Normalized units per frame (approx) - Removed, now using isApproaching\r\n}\r\n\r\ninterface TrackedHazard {\r\n    id: string\r\n    firstSeen: number\r\n    lastSeen: number\r\n    hitCounter: number\r\n    missCounter: number\r\n    objectClass: string\r\n    box: BoundingBox\r\n    confidenceHistory: number[]\r\n    confirmed: boolean\r\n\r\n    // Motion State\r\n    velocityX: number\r\n    velocityY: number\r\n    expansionRate: number\r\n    isApproaching: boolean\r\n}\r\n\r\n/**\r\n * HazardGuard: Safety-Critical Post-Processing Filter\r\n * \r\n * Responsibilities:\r\n * 1. Reject detections outside the drivable road correlation (ROI).\r\n * 2. Track objects over time to suppress single-frame flickering (noise).\r\n * 3. Enforce size/depth constraints to ignore background objects.\r\n * 4. Filter generic vehicles unless they exhibit hazardous motion (Wrong Way).\r\n */\r\nexport class HazardGuard {\r\n    private tracks: Map<string, TrackedHazard> = new Map()\r\n    private nextTrackId = 1\r\n    private frameCount = 0\r\n\r\n    constructor() { }\r\n\r\n    public process(detections: HazardDetection[], frameWidth: number, frameHeight: number): HazardDetection[] {\r\n        this.frameCount++\r\n        const now = Date.now()\r\n\r\n        // 1. ROI & Geomtric Filtering\r\n        const validDetections = detections.filter(d => this.isValidCandidate(d))\r\n\r\n        // 2. Temporal Tracking (Sort-Pro-Lite logic)\r\n        // Predict/Associate\r\n        const matched = this.associateTracks(validDetections)\r\n\r\n        // Update Tracks\r\n        const activeTracks: HazardDetection[] = []\r\n\r\n        // A. Handle Matches\r\n        matched.matches.forEach(match => {\r\n            const track = this.tracks.get(match.trackId)!\r\n            const det = validDetections[match.detIndex]\r\n\r\n            this.updateTrack(track, det, now)\r\n\r\n            if (this.isConfirmed(track)) {\r\n                // LOGIC FILTER: Only output if it's a confirmed threat\r\n                const threatLevel = this.assessThreat(track);\r\n\r\n                if (threatLevel !== 'safe') {\r\n                    // If it was generic vehicle but now detected as wrong way, upgrade it\r\n                    let finalClass = track.objectClass;\r\n                    let finalSeverity = det.severity;\r\n\r\n                    if (threatLevel === 'wrong_way') {\r\n                        finalClass = 'wrong_way_vehicle';\r\n                        finalSeverity = 'critical';\r\n                    }\r\n\r\n                    activeTracks.push({\r\n                        ...det,\r\n                        id: `trk_${match.trackId}`,\r\n                        objectClass: finalClass as any,\r\n                        severity: finalSeverity\r\n                    })\r\n                }\r\n            }\r\n        })\r\n\r\n        // B. Handle Unmatched Detections (New Tracks)\r\n        matched.unmatchedDetections.forEach(detIndex => {\r\n            const det = validDetections[detIndex]\r\n            const newTrack = this.createTrack(det, now)\r\n\r\n            // Critical hazards might be confirmed immediately if confidence is super high\r\n            if (this.isConfirmed(newTrack)) {\r\n                // New track doesn't have velocity history yet.\r\n                // If it's explicitly generic 'vehicle', we assume safe for 1st frame to avoid flash.\r\n                // Unless explicitly 'wrong_way_vehicle'.\r\n                const threatLevel = this.assessThreat(newTrack);\r\n\r\n                if (threatLevel !== 'safe') {\r\n                    activeTracks.push({\r\n                        ...det,\r\n                        id: `trk_${newTrack.id}`\r\n                    })\r\n                }\r\n            }\r\n        })\r\n\r\n        // C. Handle Unmatched Tracks (Misses)\r\n        matched.unmatchedTracks.forEach(trackId => {\r\n            const track = this.tracks.get(trackId)!\r\n            track.missCounter++\r\n\r\n            // If confirmed and only missed briefly, keep outputting it (ghost)? \r\n            // For safety, we usually stop outputting immediately but keep memory for re-association.\r\n            // So we do NOT push to activeTracks here unless we want \"coasting\".\r\n            // Let's NOT coast for safety (avoid predicting hazards that moved).\r\n\r\n            if (track.missCounter > CONFIG.MAX_DROPOUT_FRAMES) {\r\n                this.tracks.delete(trackId)\r\n            }\r\n        })\r\n\r\n        return activeTracks\r\n    }\r\n\r\n    // --- 1. Geometric & Logic Filtering ---\r\n\r\n    private isValidCandidate(d: HazardDetection): boolean {\r\n        const box = d.bbox\r\n        const cls = d.objectClass\r\n\r\n        // 1. Size Check (Too small = likely far background or noise)\r\n        if (box.width < CONFIG.MIN_RELATIVE_WIDTH) return false\r\n\r\n        // 2. ROI Check (Drivable Corridor)\r\n        const bottomCenterX = box.x + box.width / 2\r\n        const bottomCenterY = box.y + box.height\r\n\r\n        if (!this.isInTrapezoid(bottomCenterX, bottomCenterY)) {\r\n            // EXCEPTION: Large animals entering from side might be valid even if just outside \r\n            // But strict ROI for now.\r\n            return false\r\n        }\r\n\r\n        // 3. Logic Filter: Traffic Rules\r\n        // We ALLOW generic vehicles here so we can track them to check velocity.\r\n        // Filtering happens in 'assessThreat'.\r\n        return true\r\n    }\r\n\r\n    private assessThreat(track: TrackedHazard): 'safe' | 'hazard' | 'wrong_way' {\r\n        const cls = track.objectClass;\r\n\r\n        // 1. Explicit Hazards are always hazards\r\n        if (['pothole', 'debris', 'fallen_tree', 'pedestrian', 'cow', 'animal', 'wrong_way_vehicle'].some(c => cls.includes(c))) {\r\n            return 'hazard';\r\n        }\r\n\r\n        // 2. Generic Vehicles -> Check Motion\r\n        if (this.isVehicle(cls)) {\r\n            // If explicitly labelled wrong way, trust it (if model is trusted)\r\n            if (cls === 'wrong_way_vehicle') return 'wrong_way';\r\n\r\n            // Motion Logic for generic 'vehicle' / 'car'\r\n            if (track.isApproaching) {\r\n                // Check Lane Position (Center of box relative to screen)\r\n                const centerX = track.box.x + track.box.width / 2;\r\n\r\n                // Is it in Ego Lane? (Center usually 0.5)\r\n                const distFromCenter = Math.abs(centerX - CONFIG.EGO_LANE_CENTER_X);\r\n\r\n                // Rough check: is it within the central lane corridor?\r\n                if (distFromCenter < 0.20) {\r\n                    // APPROACHING in CENTER LANE -> WRONG WAY\r\n                    return 'wrong_way';\r\n                }\r\n            }\r\n\r\n            // Otherwise, it's normal traffic (moving away or adjacent)\r\n            return 'safe';\r\n        }\r\n\r\n        // Default safe\r\n        return 'safe';\r\n    }\r\n\r\n    private isVehicle(cls: string): boolean {\r\n        return ['vehicle', 'wrong_way_vehicle', 'broken_vehicle', 'car', 'truck', 'bus', 'motorcycle'].includes(cls);\r\n    }\r\n\r\n    private isInTrapezoid(x: number, y: number): boolean {\r\n        // Check Y bounds\r\n        if (y < CONFIG.ROI_TOP_Y || y > CONFIG.ROI_BOTTOM_Y) return false\r\n\r\n        // Linearly interpolate X bounds based on Y\r\n        const progress = (y - CONFIG.ROI_TOP_Y) / (CONFIG.ROI_BOTTOM_Y - CONFIG.ROI_TOP_Y)\r\n\r\n        // Perspective correction: trapezoid widens at bottom\r\n        const minX = CONFIG.ROI_LEFT_X_TOP + (CONFIG.ROI_LEFT_X_BOTTOM - CONFIG.ROI_LEFT_X_TOP) * progress\r\n        const maxX = CONFIG.ROI_RIGHT_X_TOP + (CONFIG.ROI_RIGHT_X_BOTTOM - CONFIG.ROI_RIGHT_X_TOP) * progress\r\n\r\n        return x >= minX && x <= maxX\r\n    }\r\n\r\n    // --- 2. Temporal Tracking ---\r\n\r\n    private associateTracks(detections: HazardDetection[]) {\r\n        const matches: { trackId: string, detIndex: number }[] = []\r\n        const unmatchedDetections: number[] = []\r\n        const unmatchedTracks = new Set(this.tracks.keys())\r\n\r\n        // Greedy IOU matching\r\n        // O(N*M) is fine for N,M < 20 (typical road scene)\r\n\r\n        // Sort detections by confidence high->low\r\n        const sortedIndices = detections.map((_, i) => i).sort((a, b) => detections[b].confidence - detections[a].confidence)\r\n\r\n        for (const i of sortedIndices) {\r\n            const det = detections[i]\r\n            let bestIoU = -1\r\n            let bestTrackId = null\r\n\r\n            for (const trackId of unmatchedTracks) {\r\n                const track = this.tracks.get(trackId)!\r\n                const iou = this.computeIoU(det.bbox, track.box)\r\n                if (iou > CONFIG.TRACK_IOU_THRESHOLD && iou > bestIoU) {\r\n                    bestIoU = iou\r\n                    bestTrackId = trackId\r\n                }\r\n            }\r\n\r\n            if (bestTrackId) {\r\n                matches.push({ trackId: bestTrackId, detIndex: i })\r\n                unmatchedTracks.delete(bestTrackId)\r\n            } else {\r\n                unmatchedDetections.push(i)\r\n            }\r\n        }\r\n\r\n        return { matches, unmatchedDetections, unmatchedTracks: Array.from(unmatchedTracks) }\r\n    }\r\n\r\n    private updateTrack(track: TrackedHazard, det: HazardDetection, now: number) {\r\n        const prev = track.box;\r\n        const curr = det.bbox;\r\n\r\n        // Velocity Calculation (Simple Diff)\r\n        // Moving Down (+Y) = Approaching (usually) or Moving away slower than ego? \r\n        // In dashcam: Object getting bigger + Center Y moving down = APPROACHING\r\n\r\n        const newVelocityY = curr.y - prev.y;\r\n        const newExpansion = curr.width - prev.width;\r\n\r\n        // Smooth Velocity\r\n        track.velocityY = track.velocityY * 0.7 + newVelocityY * 0.3;\r\n        track.expansionRate = track.expansionRate * 0.7 + newExpansion * 0.3;\r\n\r\n        // Logic: Approaching if Y is increasing (moving down screen) AND Width is increasing\r\n        track.isApproaching = (track.velocityY > 0.001) && (track.expansionRate > 0.001);\r\n\r\n        track.hitCounter++\r\n        track.missCounter = 0\r\n        track.lastSeen = now\r\n        track.box = det.bbox // Update box\r\n        track.confidenceHistory.push(det.confidence)\r\n        if (track.confidenceHistory.length > 5) track.confidenceHistory.shift()\r\n    }\r\n\r\n    private createTrack(det: HazardDetection, now: number): TrackedHazard {\r\n        const id = (this.nextTrackId++).toString()\r\n        const track = {\r\n            id,\r\n            firstSeen: now,\r\n            lastSeen: now,\r\n            hitCounter: 1,\r\n            missCounter: 0,\r\n            objectClass: det.objectClass,\r\n            box: det.bbox,\r\n            confidenceHistory: [det.confidence],\r\n            confirmed: false,\r\n            velocityX: 0,\r\n            velocityY: 0,\r\n            expansionRate: 0,\r\n            isApproaching: false\r\n        }\r\n        this.tracks.set(id, track)\r\n        return track\r\n    }\r\n\r\n    private isConfirmed(track: TrackedHazard): boolean {\r\n        // Already confirmed?\r\n        if (track.confirmed) return true\r\n\r\n        const meanConf = track.confidenceHistory.reduce((a, b) => a + b, 0) / track.confidenceHistory.length\r\n\r\n        // CRITICAL: Person, Car, Truck, Cow - Confirm Fast\r\n        // We define 'critical' class set here or derive from severity\r\n        // Assuming 'objectClass' maps to existing categories\r\n        const criticalClasses = ['person', 'car', 'truck', 'bus', 'motorcycle', 'cow', 'pedestrian', 'animal_large']\r\n        const isCritical = criticalClasses.some(c => track.objectClass.includes(c))\r\n\r\n        if (isCritical) {\r\n            if (meanConf > 0.6) {\r\n                track.confirmed = true\r\n                return true\r\n            }\r\n            // If lower confidence, wait 1 more frame\r\n            if (track.hitCounter >= 2) {\r\n                track.confirmed = true\r\n                return true\r\n            }\r\n        } else {\r\n            // STANDARD: Potholes, Debris, Cones - Wait for persistence\r\n            // These are noisy. Wait for 3 frames.\r\n            if (track.hitCounter >= CONFIG.CONFIRMATION_FRAMES_MEDIUM) {\r\n                track.confirmed = true\r\n                return true\r\n            }\r\n        }\r\n\r\n        return false\r\n    }\r\n\r\n    private computeIoU(b1: BoundingBox, b2: BoundingBox): number {\r\n        const x1 = Math.max(b1.x, b2.x)\r\n        const y1 = Math.max(b1.y, b2.y)\r\n        const x2 = Math.min(b1.x + b1.width, b2.x + b2.width)\r\n        const y2 = Math.min(b1.y + b1.height, b2.y + b2.height)\r\n\r\n        if (x2 < x1 || y2 < y1) return 0\r\n\r\n        const intersection = (x2 - x1) * (y2 - y1)\r\n        const area1 = b1.width * b1.height\r\n        const area2 = b2.width * b2.height\r\n\r\n        return intersection / (area1 + area2 - intersection)\r\n    }\r\n}\r\n\r\nexport const hazardGuard = new HazardGuard()\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 824, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/detection.ts"],"sourcesContent":["// lib/detection.ts\nimport * as tf from \"@tensorflow/tfjs\"\nimport {\n  getFaceMeshModel,\n  ensureFaceMeshLoaded,\n  runFaceMesh,\n  getObjectDetector,\n  loadModels,\n} from \"./models\"\n\nimport type {\n  DrowsinessMetrics,\n  HazardDetection,\n  HazardObjectClass,\n  BoundingBox\n} from \"@/lib/types\"\n\nimport { alertSound } from './sounds';\nimport { BiometricEyeEngine } from \"./biometric-eye-model\"\n\n// --- Global State ---\n\nlet tfReady: Promise<void> | null = null;\n\nfunction ensureTFReady() {\n  if (!tfReady) {\n    tfReady = tf.ready();\n  }\n  return tfReady;\n}\n\n// Instantiate the engine permanently so calibration persists\nconst eyeEngine = new BiometricEyeEngine();\n\n// Tracking state for UI counters\nlet blinkCount = 0;\nlet wasBlinking = false;\nlet lastBlinkTime = 0;\n\n// Track alert state\nlet lastAlertTime = 0;\nconst ALERT_COOLDOWN = 10000;\nlet currentAlert: 'hazard' | 'drowsiness' | null = null;\nlet lastAlertType: 'hazard' | 'drowsiness' | null = null;\n\n// Reset tracking when no face is detected for a while\nlet noFaceCounter = 0;\nconst MAX_NO_FACE_FRAMES = 10;\n\n// Debug state\nconst debug = {\n  frameCount: 0\n};\n\n// --- Helper Functions ---\n\nexport function triggerAlert(type: 'hazard' | 'drowsiness') {\n  const now = Date.now();\n\n  if (type === lastAlertType && (now - lastAlertTime) < ALERT_COOLDOWN) {\n    return;\n  }\n\n  if (type !== currentAlert) {\n    alertSound.play();\n  }\n\n  currentAlert = type;\n  lastAlertType = type;\n  lastAlertTime = now;\n\n  setTimeout(() => {\n    if (currentAlert === type) {\n      currentAlert = null;\n    }\n  }, 5000);\n}\n\nexport function getCurrentAlert() {\n  return currentAlert;\n}\n\n// --- Main Drowsiness Detection ---\n\nexport async function runRealDrowsinessDetection(\n  videoEl: HTMLVideoElement | null\n): Promise<DrowsinessMetrics | null> {\n  if (!videoEl || videoEl.readyState < 2) return null\n\n  await ensureTFReady()\n  await ensureFaceMeshLoaded()\n\n  const model = getFaceMeshModel()\n  if (!model) return null\n\n  try {\n    const outputs = await runFaceMesh(videoEl)\n    if (!outputs || outputs.length < 2) return null\n\n    const [landmarksTensor, confidenceTensor] = outputs\n\n    // Process Tensors\n    const landmarksData = await landmarksTensor.array();\n    const confidenceData = await confidenceTensor.arraySync();\n\n    landmarksTensor.dispose();\n    confidenceTensor.dispose();\n\n    const landmarksArray = Array.isArray(landmarksData[0])\n      ? (landmarksData as number[][])[0]\n      : landmarksData as number[]\n\n    // Check validity\n    if (!landmarksArray || landmarksArray.length < 468 * 3) {\n      noFaceCounter++;\n      if (noFaceCounter > MAX_NO_FACE_FRAMES) {\n        // Optionally reset engine filters? eyeEngine.reset() if we implemented it\n        // For now, the engine handles time gaps natively\n      }\n      return null;\n    }\n    noFaceCounter = 0;\n\n    // Convert to Point[] {x, y, z}\n    // We only need 2D for the current engine, but z might be useful later\n    // landmarksArray comes as [x,y,z, x,y,z, ...] normalized 0-1 (usually)\n    // IMPORTANT: FaceMesh usually outputs normalized coordinates.\n    // The engine expects raw pixels OR consistent units. \n    // If we pass normalized, aspect ratio matters. \n    // The engine calculates EAR (ratio), so scale cancels out mostly.\n    // However, for velocity, we need consistent time.\n\n    const points: { x: number, y: number, z: number }[] = [];\n    for (let i = 0; i < landmarksArray.length; i += 3) {\n      points.push({\n        x: (landmarksArray[i] as number),\n        y: (landmarksArray[i + 1] as number),\n        z: (landmarksArray[i + 2] as number)\n      });\n    }\n\n    // --- ENGINE PROCESSING ---\n    const eyeState = eyeEngine.processFrame(points);\n    if (!eyeState) return null;\n\n    // --- Post-Processing & State Tracking ---\n\n    // Blink Counting (Rising Edge of isBlink)\n    // But engine.isBlink might be true for multiple frames.\n    // We want to count 'events'.\n    const now = Date.now();\n    if (eyeState.isBlink && !wasBlinking) {\n      blinkCount++;\n      wasBlinking = true;\n      lastBlinkTime = now;\n    } else if (!eyeState.isBlink) {\n      wasBlinking = false;\n    }\n\n    // Calculate Frequency\n    // Simple window: blinks in last minute? \n    // For now we just return a placeholder or accumulated\n    const blinkFrequency = 12; // Placeholder or calculate properly\n\n    // Drowsiness Decision\n    // Use the engine's rigorous classification\n    // We remove the explicit >30 check because normal blinks drop below 30 but shouldn't trigger \"Not Alert\" status\n    // unless the engine detects microsleep or drowsiness patterns.\n    const isAlert = !eyeState.isDrowsy && !eyeState.isMicrosleep;\n\n    // Debug Log\n    if (debug.frameCount++ % 30 === 0) {\n      console.log(\"Biometric Eye State:\", {\n        openness: eyeState.opennessPercent.toFixed(1) + \"%\",\n        raw: eyeState.rawOpennessMetric.toFixed(3),\n        isBlink: eyeState.isBlink,\n        isMicrosleep: eyeState.isMicrosleep,\n        state: isAlert ? \"ALERT\" : \"DROWSY\"\n      });\n    }\n\n    return {\n      // Core Requirement: \"Continuous percentage (0-100)\"\n      alertnessScore: Math.round(eyeState.opennessPercent),\n\n      // Pass the raw EAR equivalent for legacy UI graphs if needed\n      // (normalized to 0-1 range approx for UI)\n      eyeAspectRatio: eyeState.rawOpennessMetric,\n\n      blinkCount,\n      blinkFrequency: 0, // detailed freq not implemented yet in new engine\n      isAlert,\n\n      // Placeholders\n      headTilt: null,\n      lookingAway: false,\n      yawning: false,\n      lastUpdated: now,\n    }\n\n  } catch (err) {\n    console.warn(\"FaceMesh detection failed:\", err)\n    return null\n  }\n}\n\n// ----------------- Hazard Detection -----------------\n\nimport { hazardGuard } from \"./hazard-guard\";\n\nconst HAZARD_MIN_CONFIDENCE = 0.20 // Lowered further for \"hard\" classes\n\nconst COCO_TO_HAZARD_CLASS: Record<string, HazardObjectClass> = {\n  person: \"pedestrian\",\n  bicycle: \"cyclist\",\n  car: \"vehicle\",\n  motorcycle: \"vehicle\",\n  airplane: \"other\",\n  bus: \"vehicle\",\n  train: \"vehicle\",\n  truck: \"vehicle\",\n  boat: \"other\",\n  // Aggressive Mapping for \"Fallen Trees\" / \"Road Obstacles\"\n  bench: \"fallen_tree\",  // Large horizontal object\n  chair: \"fallen_tree\",\n  couch: \"fallen_tree\",\n  bed: \"fallen_tree\",\n  diningtable: \"fallen_tree\",\n  pottedplant: \"fallen_tree\", // Bush/Small tree\n\n  // Aggressive Mapping for \"Potholes/Debris\"\n  // Using small low objects as proxies\n  backpack: \"pothole\", // Dark patches often look like bags\n  handbag: \"pothole\",\n  suitcase: \"debris\",\n  umbrella: \"debris\",\n  bottle: \"pothole\",\n  cup: \"pothole\",\n  bowl: \"pothole\",\n\n  // Animals\n  bird: \"animal\",\n  cat: \"animal\",\n  dog: \"dog\",\n  horse: \"animal_large\",\n  sheep: \"animal_large\",\n  cow: \"cow\",\n  elephant: \"animal_large\",\n  bear: \"bear\",\n  zebra: \"animal_large\",\n  giraffe: \"animal_large\",\n\n  // Misc Debris\n  traffic_light: \"other\", // could be hazard if red?\n  fire_hydrant: \"road_barrier\",\n  stop_sign: \"road_barrier\",\n  parking_meter: \"road_barrier\",\n  tie: \"other\",\n  frisbee: \"debris\",\n  skis: \"debris\",\n  snowboard: \"debris\",\n  sports_ball: \"debris\",\n  kite: \"debris\",\n  baseball_bat: \"debris\",\n  baseball_glove: \"debris\",\n  skateboard: \"debris\",\n  surfboard: \"debris\",\n  tennis_racket: \"debris\",\n  wine_glass: \"debris\",\n  fork: \"debris\",\n  knife: \"debris\",\n  spoon: \"debris\",\n  banana: \"debris\",\n  apple: \"debris\",\n  sandwich: \"debris\",\n  orange: \"debris\",\n  broccoli: \"debris\",\n  carrot: \"debris\",\n  hot_dog: \"debris\",\n  pizza: \"debris\",\n  donut: \"debris\",\n  cake: \"debris\",\n  toilet: \"debris\",\n  tv: \"debris\",\n  laptop: \"debris\",\n  mouse: \"debris\",\n  remote: \"debris\",\n  keyboard: \"debris\",\n  cell_phone: \"debris\",\n  microwave: \"debris\",\n  oven: \"debris\",\n  toaster: \"debris\",\n  sink: \"debris\",\n  refrigerator: \"debris\",\n  book: \"debris\",\n  clock: \"debris\",\n  vase: \"debris\",\n  scissors: \"debris\",\n  teddy_bear: \"debris\",\n  hair_drier: \"debris\",\n  toothbrush: \"debris\"\n}\n\nfunction mapToHazardClass(cls: string): HazardObjectClass {\n  // COCO classes use underscores or spaces depending on version, normalize\n  const normalized = cls.toLowerCase().replace(\" \", \"_\");\n  return COCO_TO_HAZARD_CLASS[normalized] ?? \"other\"\n}\n\nexport async function runRealHazardDetection(\n  videoEl: HTMLVideoElement | null\n): Promise<HazardDetection[]> {\n  if (!videoEl) return []\n  // await ensureTFReady(); // MediaPipe doesn't depend on global TF readiness same way? but we keep for FaceMesh\n  await loadModels()\n\n\n  const detector = getObjectDetector()\n  if (!detector) return []\n\n  try {\n    // MediaPipe requires timestamp\n    const now = Date.now()\n    const result = detector.detectForVideo(videoEl, now)\n\n    if (!result || !result.detections) return []\n\n    const rawHazards: HazardDetection[] = []\n\n    for (let i = 0; i < result.detections.length; i++) {\n      const det = result.detections[i];\n      const category = det.categories[0];\n\n      if (!category || category.score < HAZARD_MIN_CONFIDENCE) continue\n\n      const mappedClass = mapToHazardClass(category.categoryName?.toLowerCase() || 'unknown');\n\n      // Filter out 'other' immediately\n      if (mappedClass === 'other') continue;\n\n      // MediaPipe BBox is { originX, originY, width, height, angle } (pixels)\n      // We need to normalize to 0-1\n      const bbox = det.boundingBox;\n      if (!bbox) continue;\n\n      rawHazards.push({\n        id: `${now}-${i}`,\n        objectClass: mappedClass,\n        confidence: category.score,\n        // Severity Logic\n        severity: (mappedClass === 'pedestrian' || mappedClass === 'cow' || mappedClass === 'wrong_way_vehicle')\n          ? \"critical\" : \"high\",\n        bbox: {\n          x: bbox.originX / videoEl.videoWidth,\n          y: bbox.originY / videoEl.videoHeight,\n          width: bbox.width / videoEl.videoWidth,\n          height: bbox.height / videoEl.videoHeight\n        },\n        timestamp: now,\n      })\n    }\n\n    // --- PIPELINE STEP 2: HAZARD GUARD ---\n    const filteredHazards = hazardGuard.process(rawHazards, videoEl.videoWidth, videoEl.videoHeight);\n\n    return filteredHazards;\n  } catch (err) {\n    console.error(\"Hazard detection failed:\", err)\n    return []\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1133, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from \"@supabase/ssr\"\n\nexport function createClient() {\n  return createBrowserClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!)\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,iMAAmB;AAC5B"}},
    {"offset": {"line": 1147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/supabase/analytics.ts"],"sourcesContent":["import { createClient } from \"./client\"\r\nimport type { HazardDetection } from \"@/lib/types\"\r\n\r\nconst supabase = createClient()\r\n\r\nasync function getUserId(): Promise<string | null> {\r\n  try {\r\n    const { data, error } = await supabase.auth.getUser()\r\n    if (error) {\r\n      // Suppress \"Auth session missing!\" error which is expected for anon users\r\n      if (!error.message.includes(\"Auth session missing\")) {\r\n        console.error(\"Supabase getUser error\", error)\r\n      }\r\n      return null\r\n    }\r\n    return data.user?.id ?? null\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function logDrowsinessEvent(args: {\r\n  alertnessScore: number\r\n  ear: number\r\n  blinkFrequency: number\r\n  triggeredAlert: boolean\r\n  sessionId: string | null\r\n}) {\r\n  const userId = await getUserId()\r\n  if (!userId) return\r\n\r\n  const { error } = await supabase.from(\"drowsiness_events\").insert({\r\n    user_id: userId,\r\n    organization_id: null,\r\n    alertness_score: args.alertnessScore,\r\n    eye_aspect_ratio: args.ear,\r\n    blink_frequency: args.blinkFrequency,\r\n    triggered_alert: args.triggeredAlert,\r\n    alert_type: null,\r\n    emergency_contact: null,\r\n    session_id: args.sessionId,\r\n  })\r\n\r\n  if (error) console.error(\"logDrowsinessEvent error\", error)\r\n}\r\n\r\nexport async function logHazardEvents(hazards: HazardDetection[], sessionId: string | null) {\r\n  if (!hazards.length) return\r\n\r\n  const userId = await getUserId()\r\n  if (!userId) return\r\n\r\n  const rows = hazards.map((h) => ({\r\n    user_id: userId,\r\n    organization_id: null,\r\n    object_class: h.objectClass,\r\n    confidence: h.confidence,\r\n    severity_level: h.severity,\r\n    bbox: h.bbox,\r\n    frame_source: \"webcam\",\r\n    frame_url: null,\r\n    location_lat: null,\r\n    location_lng: null,\r\n    highway_name: null,\r\n    session_id: sessionId,\r\n  }))\r\n\r\n  const { error } = await supabase.from(\"hazard_detections\").insert(rows)\r\n  if (error) console.error(\"logHazardEvents error\", error)\r\n}\r\n\r\n// ---------------- VASE session lifecycle ----------------\r\n\r\nexport async function startVaseSession(): Promise<string | null> {\r\n  const userId = await getUserId()\r\n  if (!userId) return null\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"vase_sessions\")\r\n    .insert({\r\n      user_id: userId,\r\n      organization_id: null,\r\n      start_time: new Date().toISOString(),\r\n      total_alerts: 0,\r\n      hazards_detected: 0,\r\n      emergency_contact_notified: false,\r\n    })\r\n    .select(\"id\")\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"startVaseSession error\", error)\r\n    return null\r\n  }\r\n\r\n  return data?.id ?? null\r\n}\r\n\r\nexport async function endVaseSession(args: {\r\n  sessionId: string\r\n  startTime: Date | null\r\n  totalAlerts: number\r\n  averageAlertness: number | null\r\n  hazardsDetected: number\r\n  emergencyContactNotified: boolean\r\n}) {\r\n  if (!args.sessionId) return\r\n\r\n  const end = new Date()\r\n  const durationSeconds = args.startTime ? Math.round((end.getTime() - args.startTime.getTime()) / 1000) : null\r\n\r\n  const { error } = await supabase\r\n    .from(\"vase_sessions\")\r\n    .update({\r\n      end_time: end.toISOString(),\r\n      duration_seconds: durationSeconds,\r\n      total_alerts: args.totalAlerts,\r\n      average_alertness: args.averageAlertness,\r\n      hazards_detected: args.hazardsDetected,\r\n      emergency_contact_notified: args.emergencyContactNotified,\r\n    })\r\n    .eq(\"id\", args.sessionId)\r\n\r\n  if (error) console.error(\"endVaseSession error\", error)\r\n}\r\n\r\n// Log a high-level VASE alert into the alerts table so it appears in Recent Alerts.\r\nexport async function logVaseAlert(args: {\r\n  sessionId: string | null\r\n  severity: \"critical\" | \"high\" | \"medium\" | \"low\"\r\n  title: string\r\n  description: string | null\r\n}) {\r\n  try {\r\n    if (!supabase) {\r\n      console.warn('Supabase client not initialized');\r\n      return;\r\n    }\r\n\r\n    // Only log in production or if explicitly enabled in development\r\n    if (process.env.NODE_ENV === 'development' && !process.env.NEXT_PUBLIC_ENABLE_ANALYTICS_LOGGING) {\r\n      console.log('VASE Alert (not logged in development):', args.title);\r\n      return;\r\n    }\r\n\r\n    const { error } = await supabase\r\n      .from(\"alerts\")\r\n      .insert({\r\n        detection_id: null,\r\n        camera_id: null,\r\n        organization_id: null,\r\n        severity: args.severity,\r\n        status: \"active\",\r\n        title: args.title,\r\n        description: args.description,\r\n        session_id: args.sessionId,\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    if (error) {\r\n      console.error('Failed to log VASE alert:', {\r\n        error,\r\n        alertData: args,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n    } else {\r\n      console.log('VASE alert logged successfully:', args.title);\r\n    }\r\n  } catch (err) {\r\n    console.error('Unexpected error in logVaseAlert:', {\r\n      error: err,\r\n      alertData: args,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  }\r\n}\r\n\r\n\r\n// ---------------- Emergency Contact Persistence ----------------\r\n\r\nexport async function saveEmergencyContact(email: string) {\r\n  const userId = await getUserId();\r\n  if (!userId) {\r\n    console.warn(\"Cannot save contact: No user logged in\");\r\n    return null;\r\n  }\r\n\r\n  // Upsert into emergency_contacts table\r\n  // Assuming table structure matches interface roughly or user provided it\r\n  // We try to update if exists for this user, or insert.\r\n  // Since we don't have exact PK knowledge, we assume user_id is unique or we use a query to find existing.\r\n\r\n  // Strategy: Delete old, Insert new (simplest for single contact enforcement)\r\n  // Or better: UPSERT based on user_id if that's a constraint.\r\n\r\n  // Let's try explicit upsert logic if we had a constraint, but here we'll just try to INSERT and handle error?\r\n  // User said \"hook it wuth supabase databse we are using before\".\r\n\r\n  // We will look for an existing contact first.\r\n  const { data: existing } = await supabase\r\n    .from(\"emergency_contacts\")\r\n    .select(\"id\")\r\n    .eq(\"user_id\", userId)\r\n    .limit(1)\r\n    .single();\r\n\r\n  let error;\r\n\r\n  if (existing) {\r\n    const res = await supabase\r\n      .from(\"emergency_contacts\")\r\n      .update({\r\n        name: \"VASE Emergency Contact\",\r\n        phone: email, // MAPPING EMAIL TO PHONE COLUMN (Schema adaptation)\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .eq(\"id\", existing.id);\r\n    error = res.error;\r\n  } else {\r\n    const res = await supabase\r\n      .from(\"emergency_contacts\")\r\n      .insert({\r\n        user_id: userId,\r\n        name: \"VASE Emergency Contact\",\r\n        phone: email, // MAPPING EMAIL TO PHONE COLUMN\r\n        is_primary: true,\r\n        notify_on_hazard: true,\r\n        notify_on_drowsiness: true\r\n      });\r\n    error = res.error;\r\n  }\r\n\r\n  if (error) {\r\n    console.error(\"saveEmergencyContact error details:\", JSON.stringify(error, null, 2));\r\n    throw new Error(`Supabase Error: ${error.message || JSON.stringify(error)}`);\r\n  }\r\n  return true;\r\n}\r\n\r\nexport async function getEmergencyContact() {\r\n  const userId = await getUserId();\r\n  if (!userId) return null;\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"emergency_contacts\")\r\n    .select(\"*\")\r\n    .eq(\"user_id\", userId)\r\n    .limit(1)\r\n    .single();\r\n\r\n  if (error) {\r\n    // Ignore \"Row not found\" errors\r\n    if (error.code !== 'PGRST116') {\r\n      console.error(\"getEmergencyContact error\", error);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  // Retrieve email from phone column\r\n  return (data as any).phone || null;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1347, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB"}},
    {"offset": {"line": 1362, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 dark:hover:text-foreground',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost:\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 dark:hover:text-foreground',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9',\n        'icon-sm': 'size-8',\n        'icon-lg': 'size-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAE9B,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1421, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/alert-notification.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { AlertTriangle } from 'lucide-react';\n\ntype AlertType = 'hazard' | 'drowsiness' | null;\n\ninterface AlertNotificationProps {\n  type: AlertType;\n  message: string;\n  onClose: () => void;\n}\n\nexport function AlertNotification({ type, message, onClose }: AlertNotificationProps) {\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      onClose();\n    }, 5000); // Auto-close after 5 seconds\n\n    return () => clearTimeout(timer);\n  }, [onClose]);\n\n  if (!type) return null;\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ x: '100%', opacity: 0 }}\n        animate={{ x: 0, opacity: 1 }}\n        exit={{ x: '100%', opacity: 0 }}\n        transition={{ type: 'spring', damping: 25, stiffness: 300 }}\n        className=\"fixed bottom-6 right-6 z-50 max-w-sm w-full bg-red-600 text-white p-4 rounded-lg shadow-lg flex items-start space-x-3\"\n      >\n        <AlertTriangle className=\"h-6 w-6 text-white flex-shrink-0 mt-0.5\" />\n        <div className=\"flex-1\">\n          <h3 className=\"font-medium\">\n            {type === 'hazard' ? 'Hazard Detected!' : 'Drowsiness Detected!'}\n          </h3>\n          <p className=\"text-sm opacity-90\">{message}</p>\n        </div>\n        <button\n          onClick={onClose}\n          className=\"text-white opacity-70 hover:opacity-100 transition-opacity\"\n          aria-label=\"Close alert\"\n        >\n          \n        </button>\n      </motion.div>\n    </AnimatePresence>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;;;;;AAUO,SAAS,kBAAkB,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAA0B;IAClF,IAAA,kNAAS,EAAC;QACR,MAAM,QAAQ,WAAW;YACvB;QACF,GAAG,OAAO,6BAA6B;QAEvC,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;KAAQ;IAEZ,IAAI,CAAC,MAAM,OAAO;IAElB,qBACE,8OAAC,4MAAe;kBACd,cAAA,8OAAC,oMAAM,CAAC,GAAG;YACT,SAAS;gBAAE,GAAG;gBAAQ,SAAS;YAAE;YACjC,SAAS;gBAAE,GAAG;gBAAG,SAAS;YAAE;YAC5B,MAAM;gBAAE,GAAG;gBAAQ,SAAS;YAAE;YAC9B,YAAY;gBAAE,MAAM;gBAAU,SAAS;gBAAI,WAAW;YAAI;YAC1D,WAAU;;8BAEV,8OAAC,yOAAa;oBAAC,WAAU;;;;;;8BACzB,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCACX,SAAS,WAAW,qBAAqB;;;;;;sCAE5C,8OAAC;4BAAE,WAAU;sCAAsB;;;;;;;;;;;;8BAErC,8OAAC;oBACC,SAAS;oBACT,WAAU;oBACV,cAAW;8BACZ;;;;;;;;;;;;;;;;;AAMT"}},
    {"offset": {"line": 1523, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1625, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/switch.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as SwitchPrimitive from '@radix-ui/react-switch'\n\nimport { cn } from '@/lib/utils'\n\nfunction Switch({\n  className,\n  ...props\n}: React.ComponentProps<typeof SwitchPrimitive.Root>) {\n  return (\n    <SwitchPrimitive.Root\n      data-slot=\"switch\"\n      className={cn(\n        'peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    >\n      <SwitchPrimitive.Thumb\n        data-slot=\"switch-thumb\"\n        className={\n          'bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0'\n        }\n      />\n    </SwitchPrimitive.Root>\n  )\n}\n\nexport { Switch }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,OAAO,EACd,SAAS,EACT,GAAG,OAC+C;IAClD,qBACE,8OAAC,0KAAoB;QACnB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,6WACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,2KAAqB;YACpB,aAAU;YACV,WACE;;;;;;;;;;;AAKV"}},
    {"offset": {"line": 1660, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/label.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as LabelPrimitive from '@radix-ui/react-label'\n\nimport { cn } from '@/lib/utils'\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        'flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,8OAAC,yKAAmB;QAClB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,uNACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1687, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/input.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Input({ className, type, ...props }: React.ComponentProps<'input'>) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',\n        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,8OAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1712, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/badge.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst badgeVariants = cva(\n  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',\n  {\n    variants: {\n      variant: {\n        default:\n          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',\n        secondary:\n          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',\n        destructive:\n          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n    },\n  },\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'span'> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'span'\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,uKAAG,EACvB,kZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,wKAAI,GAAG;IAE9B,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1758, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/progress.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as ProgressPrimitive from '@radix-ui/react-progress'\n\nimport { cn } from '@/lib/utils'\n\nfunction Progress({\n  className,\n  value,\n  ...props\n}: React.ComponentProps<typeof ProgressPrimitive.Root>) {\n  return (\n    <ProgressPrimitive.Root\n      data-slot=\"progress\"\n      className={cn(\n        'bg-primary/20 relative h-2 w-full overflow-hidden rounded-full',\n        className,\n      )}\n      {...props}\n    >\n      <ProgressPrimitive.Indicator\n        data-slot=\"progress-indicator\"\n        className=\"bg-primary h-full w-full flex-1 transition-all\"\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n      />\n    </ProgressPrimitive.Root>\n  )\n}\n\nexport { Progress }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,EAChB,SAAS,EACT,KAAK,EACL,GAAG,OACiD;IACpD,qBACE,8OAAC,4KAAsB;QACrB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,iLAA2B;YAC1B,aAAU;YACV,WAAU;YACV,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;AAIlE"}},
    {"offset": {"line": 1796, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/dialog.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as DialogPrimitive from '@radix-ui/react-dialog'\nimport { XIcon } from 'lucide-react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Dialog({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Root>) {\n  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />\n}\n\nfunction DialogTrigger({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\n  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />\n}\n\nfunction DialogPortal({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\n  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />\n}\n\nfunction DialogClose({\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Close>) {\n  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />\n}\n\nfunction DialogOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\n  return (\n    <DialogPrimitive.Overlay\n      data-slot=\"dialog-overlay\"\n      className={cn(\n        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DialogContent({\n  className,\n  children,\n  showCloseButton = true,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Content> & {\n  showCloseButton?: boolean\n}) {\n  return (\n    <DialogPortal data-slot=\"dialog-portal\">\n      <DialogOverlay />\n      <DialogPrimitive.Content\n        data-slot=\"dialog-content\"\n        className={cn(\n          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg',\n          className,\n        )}\n        {...props}\n      >\n        {children}\n        {showCloseButton && (\n          <DialogPrimitive.Close\n            data-slot=\"dialog-close\"\n            className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\"\n          >\n            <XIcon />\n            <span className=\"sr-only\">Close</span>\n          </DialogPrimitive.Close>\n        )}\n      </DialogPrimitive.Content>\n    </DialogPortal>\n  )\n}\n\nfunction DialogHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"dialog-header\"\n      className={cn('flex flex-col gap-2 text-center sm:text-left', className)}\n      {...props}\n    />\n  )\n}\n\nfunction DialogFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"dialog-footer\"\n      className={cn(\n        'flex flex-col-reverse gap-2 sm:flex-row sm:justify-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DialogTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Title>) {\n  return (\n    <DialogPrimitive.Title\n      data-slot=\"dialog-title\"\n      className={cn('text-lg leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction DialogDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof DialogPrimitive.Description>) {\n  return (\n    <DialogPrimitive.Description\n      data-slot=\"dialog-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogOverlay,\n  DialogPortal,\n  DialogTitle,\n  DialogTrigger,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAGA;AACA;AAEA;AANA;;;;;AAQA,SAAS,OAAO,EACd,GAAG,OAC+C;IAClD,qBAAO,8OAAC,0KAAoB;QAAC,aAAU;QAAU,GAAG,KAAK;;;;;;AAC3D;AAEA,SAAS,cAAc,EACrB,GAAG,OACkD;IACrD,qBAAO,8OAAC,6KAAuB;QAAC,aAAU;QAAkB,GAAG,KAAK;;;;;;AACtE;AAEA,SAAS,aAAa,EACpB,GAAG,OACiD;IACpD,qBAAO,8OAAC,4KAAsB;QAAC,aAAU;QAAiB,GAAG,KAAK;;;;;;AACpE;AAEA,SAAS,YAAY,EACnB,GAAG,OACgD;IACnD,qBAAO,8OAAC,2KAAqB;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AAClE;AAEA,SAAS,cAAc,EACrB,SAAS,EACT,GAAG,OACkD;IACrD,qBACE,8OAAC,6KAAuB;QACtB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,0JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,cAAc,EACrB,SAAS,EACT,QAAQ,EACR,kBAAkB,IAAI,EACtB,GAAG,OAGJ;IACC,qBACE,8OAAC;QAAa,aAAU;;0BACtB,8OAAC;;;;;0BACD,8OAAC,6KAAuB;gBACtB,aAAU;gBACV,WAAW,IAAA,kHAAE,EACX,+WACA;gBAED,GAAG,KAAK;;oBAER;oBACA,iCACC,8OAAC,2KAAqB;wBACpB,aAAU;wBACV,WAAU;;0CAEV,8OAAC,yMAAK;;;;;0CACN,8OAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;;;;;;;;;;;;;AAMtC;AAEA,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,gDAAgD;QAC7D,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,0DACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,8OAAC,2KAAqB;QACpB,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACsD;IACzD,qBACE,8OAAC,iLAA2B;QAC1B,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1978, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/vision-ai-logo.tsx"],"sourcesContent":["\"use client\"\n\nimport { motion } from \"framer-motion\"\nimport { cn } from \"@/lib/utils\"\n\ninterface VisionAILogoProps {\n  className?: string\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\"\n  animate?: boolean\n  showText?: boolean\n}\n\nexport function VisionAILogo({ className, size = \"md\", animate = false, showText = true }: VisionAILogoProps) {\n  const sizes = {\n    sm: { icon: 24, text: \"text-lg\" },\n    md: { icon: 32, text: \"text-xl\" },\n    lg: { icon: 48, text: \"text-2xl\" },\n    xl: { icon: 64, text: \"text-3xl\" },\n  }\n\n  const { icon: iconSize, text: textSize } = sizes[size]\n\n  const EyeIcon = (\n    <svg\n      width={iconSize}\n      height={iconSize}\n      viewBox=\"0 0 64 64\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className=\"relative\"\n    >\n      {/* Outer eye shape */}\n      <motion.path\n        d=\"M32 12C18 12 6 32 6 32C6 32 18 52 32 52C46 52 58 32 58 32C58 32 46 12 32 12Z\"\n        stroke=\"url(#eyeGradient)\"\n        strokeWidth=\"3\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n        initial={animate ? { pathLength: 0 } : { pathLength: 1 }}\n        animate={{ pathLength: 1 }}\n        transition={{ duration: 1.5, ease: \"easeInOut\" }}\n      />\n      {/* Iris */}\n      <motion.circle\n        cx=\"32\"\n        cy=\"32\"\n        r=\"12\"\n        stroke=\"url(#irisGradient)\"\n        strokeWidth=\"2.5\"\n        fill=\"none\"\n        initial={animate ? { scale: 0 } : { scale: 1 }}\n        animate={{ scale: 1 }}\n        transition={{ duration: 0.5, delay: animate ? 0.8 : 0 }}\n      />\n      {/* Pupil */}\n      <motion.circle\n        cx=\"32\"\n        cy=\"32\"\n        r=\"5\"\n        fill=\"url(#pupilGradient)\"\n        initial={animate ? { scale: 0 } : { scale: 1 }}\n        animate={animate ? { scale: [0, 1.2, 1] } : { scale: 1 }}\n        transition={{ duration: 0.6, delay: animate ? 1 : 0 }}\n      />\n      {/* Light reflection */}\n      <motion.circle\n        cx=\"36\"\n        cy=\"28\"\n        r=\"2\"\n        fill=\"white\"\n        opacity={0.8}\n        initial={animate ? { opacity: 0 } : { opacity: 0.8 }}\n        animate={{ opacity: 0.8 }}\n        transition={{ duration: 0.3, delay: animate ? 1.3 : 0 }}\n      />\n      {/* AI scan lines */}\n      <motion.g\n        initial={animate ? { opacity: 0 } : { opacity: 1 }}\n        animate={{ opacity: 1 }}\n        transition={{ duration: 0.5, delay: animate ? 1.5 : 0 }}\n      >\n        <line x1=\"20\" y1=\"32\" x2=\"26\" y2=\"32\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n        <line x1=\"38\" y1=\"32\" x2=\"44\" y2=\"32\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n        <line x1=\"32\" y1=\"20\" x2=\"32\" y2=\"26\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n        <line x1=\"32\" y1=\"38\" x2=\"32\" y2=\"44\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n      </motion.g>\n      <defs>\n        <linearGradient id=\"eyeGradient\" x1=\"6\" y1=\"32\" x2=\"58\" y2=\"32\" gradientUnits=\"userSpaceOnUse\">\n          <stop stopColor=\"#4f46e5\" />\n          <stop offset=\"0.5\" stopColor=\"#06b6d4\" />\n          <stop offset=\"1\" stopColor=\"#22c55e\" />\n        </linearGradient>\n        <linearGradient id=\"irisGradient\" x1=\"20\" y1=\"32\" x2=\"44\" y2=\"32\" gradientUnits=\"userSpaceOnUse\">\n          <stop stopColor=\"#4f46e5\" />\n          <stop offset=\"1\" stopColor=\"#06b6d4\" />\n        </linearGradient>\n        <radialGradient id=\"pupilGradient\" cx=\"32\" cy=\"32\" r=\"5\" gradientUnits=\"userSpaceOnUse\">\n          <stop stopColor=\"#1e1b4b\" />\n          <stop offset=\"1\" stopColor=\"#4f46e5\" />\n        </radialGradient>\n        <linearGradient id=\"scanGradient\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\" gradientUnits=\"objectBoundingBox\">\n          <stop stopColor=\"#22c55e\" />\n          <stop offset=\"1\" stopColor=\"#06b6d4\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  )\n\n  return (\n    <div className={cn(\"flex items-center gap-2\", className)}>\n      <div className=\"relative\">\n        {EyeIcon}\n        {animate && (\n          <motion.div\n            className=\"absolute inset-0 blur-xl bg-primary/30 rounded-full\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: [0, 0.5, 0.3] }}\n            transition={{ duration: 2, delay: 1 }}\n          />\n        )}\n      </div>\n      {showText && (\n        <motion.span\n          className={cn(\"font-bold tracking-tight\", textSize)}\n          initial={animate ? { opacity: 0, x: -10 } : { opacity: 1 }}\n          animate={{ opacity: 1, x: 0 }}\n          transition={{ duration: 0.5, delay: animate ? 0.5 : 0 }}\n        >\n          Vision-AI\n        </motion.span>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2392, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/dvse/engine.ts"],"sourcesContent":["// Vision-AI Safety Engine (VASE) - Core Engine Logic\n\nimport type { DVSERiskAssessment, DrowsinessMetrics, HazardDetection, SafetyStatus, AlertnessWindow } from \"@/lib/types\"\n\n// Configuration constants\nconst CONFIG = {\n  ALERTNESS_THRESHOLD: 50, // Below this triggers alert\n  HAZARD_CONFIDENCE_THRESHOLD: 0.5, // Minimum confidence for hazard alerts\n  RISK_WEIGHTS: {\n    drowsiness: 0.6, // Drowsiness contributes 60% to risk\n    hazard: 0.4, // Hazard contributes 40% to risk\n  },\n  ALERTNESS_WINDOW_SIZE: 20, // Rolling window for smoothing (10 seconds at 2 fps)\n  CRITICAL_HAZARDS: [\"cow\", \"buffalo\", \"elephant\", \"wrong_way_vehicle\", \"pedestrian\", \"broken_vehicle\"],\n  HIGH_RISK_THRESHOLD: 70,\n  CAUTION_THRESHOLD: 40,\n}\n\n// Create rolling window for smoothed alertness\nexport function createAlertnessWindow(size: number = CONFIG.ALERTNESS_WINDOW_SIZE): AlertnessWindow {\n  return {\n    samples: [],\n    windowSize: size,\n    average: 100, // Start optimistic\n  }\n}\n\n// Update rolling window with new alertness sample\nexport function updateAlertnessWindow(window: AlertnessWindow, newSample: number): AlertnessWindow {\n  const newSamples = [...window.samples, newSample]\n  if (newSamples.length > window.windowSize) {\n    newSamples.shift()\n  }\n  const average = newSamples.reduce((a, b) => a + b, 0) / newSamples.length\n  return {\n    ...window,\n    samples: newSamples,\n    average,\n  }\n}\n\n// Calculate Eye Aspect Ratio (EAR) from landmarks\nexport function calculateEAR(eyePoints: { x: number; y: number }[]): number {\n  if (eyePoints.length < 6) return 0.3 // Default open\n\n  // Vertical distances\n  const v1 = Math.sqrt(Math.pow(eyePoints[1].x - eyePoints[5].x, 2) + Math.pow(eyePoints[1].y - eyePoints[5].y, 2))\n  const v2 = Math.sqrt(Math.pow(eyePoints[2].x - eyePoints[4].x, 2) + Math.pow(eyePoints[2].y - eyePoints[4].y, 2))\n\n  // Horizontal distance\n  const h = Math.sqrt(Math.pow(eyePoints[0].x - eyePoints[3].x, 2) + Math.pow(eyePoints[0].y - eyePoints[3].y, 2))\n\n  if (h === 0) return 0.3\n  return (v1 + v2) / (2.0 * h)\n}\n\n// Convert EAR to alertness score (0-100)\nexport function earToAlertness(ear: number): number {\n  // EAR typically ranges from 0.15 (closed) to 0.35 (open)\n  const minEAR = 0.15\n  const maxEAR = 0.35\n  const normalized = Math.max(0, Math.min(1, (ear - minEAR) / (maxEAR - minEAR)))\n  return Math.round(normalized * 100)\n}\n\n// Get hazard severity based on class and confidence\nexport function getHazardSeverity(objectClass: string, confidence: number): \"critical\" | \"high\" | \"medium\" | \"low\" {\n  const isCriticalClass = CONFIG.CRITICAL_HAZARDS.includes(objectClass)\n\n  if (isCriticalClass && confidence > 0.8) return \"critical\"\n  if (isCriticalClass && confidence > 0.6) return \"high\"\n  if (confidence > 0.8) return \"high\"\n  if (confidence > 0.6) return \"medium\"\n  return \"low\"\n}\n\n// Calculate hazard risk score from detections\nexport function calculateHazardRisk(hazards: HazardDetection[]): number {\n  if (hazards.length === 0) return 0\n\n  let maxRisk = 0\n  for (const hazard of hazards) {\n    let risk = hazard.confidence * 100\n\n    // Boost risk for critical hazards\n    if (CONFIG.CRITICAL_HAZARDS.includes(hazard.objectClass)) {\n      risk = Math.min(100, risk * 1.3)\n    }\n\n    // Severity multiplier\n    const severityMultiplier = {\n      critical: 1.0,\n      high: 0.8,\n      medium: 0.5,\n      low: 0.3,\n    }\n    risk *= severityMultiplier[hazard.severity]\n\n    maxRisk = Math.max(maxRisk, risk)\n  }\n\n  return Math.round(maxRisk)\n}\n\n// Main VASE risk assessment function\nexport function assessRisk(\n  drowsiness: DrowsinessMetrics | null,\n  hazards: HazardDetection[],\n  smoothedAlertness: number,\n): DVSERiskAssessment {\n  // Calculate individual risks\n  const alertnessRisk = drowsiness ? Math.max(0, 100 - smoothedAlertness) : 0\n  const hazardRisk = calculateHazardRisk(hazards)\n\n  // Combined risk score (weighted)\n  const riskScore = Math.round(alertnessRisk * CONFIG.RISK_WEIGHTS.drowsiness + hazardRisk * CONFIG.RISK_WEIGHTS.hazard)\n\n  // Determine overall status\n  let overallStatus: SafetyStatus = \"safe\"\n  if (riskScore >= CONFIG.HIGH_RISK_THRESHOLD) {\n    overallStatus = \"high-risk\"\n  } else if (riskScore >= CONFIG.CAUTION_THRESHOLD) {\n    overallStatus = \"caution\"\n  }\n\n  // Determine if alert should trigger\n  const shouldAlert =\n    smoothedAlertness < CONFIG.ALERTNESS_THRESHOLD ||\n    hazards.some((h) => h.severity === \"critical\" || h.severity === \"high\")\n\n  // Generate alert message\n  let alertMessage: string | null = null\n  if (shouldAlert) {\n    if (smoothedAlertness < CONFIG.ALERTNESS_THRESHOLD && hazards.length > 0) {\n      alertMessage = `DANGER: Drowsy driving detected + ${hazards[0].objectClass} on road!`\n    } else if (smoothedAlertness < CONFIG.ALERTNESS_THRESHOLD) {\n      alertMessage = \"ALERT: Drowsiness detected - Please take a break!\"\n    } else if (hazards.length > 0) {\n      const criticalHazard = hazards.find((h) => h.severity === \"critical\")\n      if (criticalHazard) {\n        alertMessage = `DANGER: ${criticalHazard.objectClass.replace(\"_\", \" \")} detected ahead!`\n      } else {\n        alertMessage = `WARNING: ${hazards[0].objectClass.replace(\"_\", \" \")} detected on road`\n      }\n    }\n  }\n\n  return {\n    overallStatus,\n    riskScore,\n    alertnessRisk,\n    hazardRisk,\n    timestamp: Date.now(),\n    shouldAlert,\n    alertMessage,\n  }\n}\n\n// Get status color for UI\nexport function getStatusColor(status: SafetyStatus): string {\n  switch (status) {\n    case \"safe\":\n      return \"text-success\"\n    case \"caution\":\n      return \"text-warning\"\n    case \"high-risk\":\n      return \"text-destructive\"\n  }\n}\n\nexport function getStatusBgColor(status: SafetyStatus): string {\n  switch (status) {\n    case \"safe\":\n      return \"bg-success\"\n    case \"caution\":\n      return \"bg-warning\"\n    case \"high-risk\":\n      return \"bg-destructive\"\n  }\n}\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;;;;;;;;;;;;;;;;;AAIrD,0BAA0B;AAC1B,MAAM,SAAS;IACb,qBAAqB;IACrB,6BAA6B;IAC7B,cAAc;QACZ,YAAY;QACZ,QAAQ;IACV;IACA,uBAAuB;IACvB,kBAAkB;QAAC;QAAO;QAAW;QAAY;QAAqB;QAAc;KAAiB;IACrG,qBAAqB;IACrB,mBAAmB;AACrB;AAGO,SAAS,sBAAsB,OAAe,OAAO,qBAAqB;IAC/E,OAAO;QACL,SAAS,EAAE;QACX,YAAY;QACZ,SAAS;IACX;AACF;AAGO,SAAS,sBAAsB,MAAuB,EAAE,SAAiB;IAC9E,MAAM,aAAa;WAAI,OAAO,OAAO;QAAE;KAAU;IACjD,IAAI,WAAW,MAAM,GAAG,OAAO,UAAU,EAAE;QACzC,WAAW,KAAK;IAClB;IACA,MAAM,UAAU,WAAW,MAAM,CAAC,CAAC,GAAG,IAAM,IAAI,GAAG,KAAK,WAAW,MAAM;IACzE,OAAO;QACL,GAAG,MAAM;QACT,SAAS;QACT;IACF;AACF;AAGO,SAAS,aAAa,SAAqC;IAChE,IAAI,UAAU,MAAM,GAAG,GAAG,OAAO,IAAI,eAAe;;IAEpD,qBAAqB;IACrB,MAAM,KAAK,KAAK,IAAI,CAAC,KAAK,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,KAAK,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE;IAC9G,MAAM,KAAK,KAAK,IAAI,CAAC,KAAK,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,KAAK,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE;IAE9G,sBAAsB;IACtB,MAAM,IAAI,KAAK,IAAI,CAAC,KAAK,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,KAAK,GAAG,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,EAAE,CAAC,CAAC,EAAE;IAE7G,IAAI,MAAM,GAAG,OAAO;IACpB,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC;AAC7B;AAGO,SAAS,eAAe,GAAW;IACxC,yDAAyD;IACzD,MAAM,SAAS;IACf,MAAM,SAAS;IACf,MAAM,aAAa,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,CAAC,MAAM,MAAM,IAAI,CAAC,SAAS,MAAM;IAC5E,OAAO,KAAK,KAAK,CAAC,aAAa;AACjC;AAGO,SAAS,kBAAkB,WAAmB,EAAE,UAAkB;IACvE,MAAM,kBAAkB,OAAO,gBAAgB,CAAC,QAAQ,CAAC;IAEzD,IAAI,mBAAmB,aAAa,KAAK,OAAO;IAChD,IAAI,mBAAmB,aAAa,KAAK,OAAO;IAChD,IAAI,aAAa,KAAK,OAAO;IAC7B,IAAI,aAAa,KAAK,OAAO;IAC7B,OAAO;AACT;AAGO,SAAS,oBAAoB,OAA0B;IAC5D,IAAI,QAAQ,MAAM,KAAK,GAAG,OAAO;IAEjC,IAAI,UAAU;IACd,KAAK,MAAM,UAAU,QAAS;QAC5B,IAAI,OAAO,OAAO,UAAU,GAAG;QAE/B,kCAAkC;QAClC,IAAI,OAAO,gBAAgB,CAAC,QAAQ,CAAC,OAAO,WAAW,GAAG;YACxD,OAAO,KAAK,GAAG,CAAC,KAAK,OAAO;QAC9B;QAEA,sBAAsB;QACtB,MAAM,qBAAqB;YACzB,UAAU;YACV,MAAM;YACN,QAAQ;YACR,KAAK;QACP;QACA,QAAQ,kBAAkB,CAAC,OAAO,QAAQ,CAAC;QAE3C,UAAU,KAAK,GAAG,CAAC,SAAS;IAC9B;IAEA,OAAO,KAAK,KAAK,CAAC;AACpB;AAGO,SAAS,WACd,UAAoC,EACpC,OAA0B,EAC1B,iBAAyB;IAEzB,6BAA6B;IAC7B,MAAM,gBAAgB,aAAa,KAAK,GAAG,CAAC,GAAG,MAAM,qBAAqB;IAC1E,MAAM,aAAa,oBAAoB;IAEvC,iCAAiC;IACjC,MAAM,YAAY,KAAK,KAAK,CAAC,gBAAgB,OAAO,YAAY,CAAC,UAAU,GAAG,aAAa,OAAO,YAAY,CAAC,MAAM;IAErH,2BAA2B;IAC3B,IAAI,gBAA8B;IAClC,IAAI,aAAa,OAAO,mBAAmB,EAAE;QAC3C,gBAAgB;IAClB,OAAO,IAAI,aAAa,OAAO,iBAAiB,EAAE;QAChD,gBAAgB;IAClB;IAEA,oCAAoC;IACpC,MAAM,cACJ,oBAAoB,OAAO,mBAAmB,IAC9C,QAAQ,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK,cAAc,EAAE,QAAQ,KAAK;IAElE,yBAAyB;IACzB,IAAI,eAA8B;IAClC,IAAI,aAAa;QACf,IAAI,oBAAoB,OAAO,mBAAmB,IAAI,QAAQ,MAAM,GAAG,GAAG;YACxE,eAAe,CAAC,kCAAkC,EAAE,OAAO,CAAC,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC;QACvF,OAAO,IAAI,oBAAoB,OAAO,mBAAmB,EAAE;YACzD,eAAe;QACjB,OAAO,IAAI,QAAQ,MAAM,GAAG,GAAG;YAC7B,MAAM,iBAAiB,QAAQ,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK;YAC1D,IAAI,gBAAgB;gBAClB,eAAe,CAAC,QAAQ,EAAE,eAAe,WAAW,CAAC,OAAO,CAAC,KAAK,KAAK,gBAAgB,CAAC;YAC1F,OAAO;gBACL,eAAe,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,KAAK,iBAAiB,CAAC;YACxF;QACF;IACF;IAEA,OAAO;QACL;QACA;QACA;QACA;QACA,WAAW,KAAK,GAAG;QACnB;QACA;IACF;AACF;AAGO,SAAS,eAAe,MAAoB;IACjD,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;IACX;AACF;AAEO,SAAS,iBAAiB,MAAoB;IACnD,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;IACX;AACF"}},
    {"offset": {"line": 2567, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/app/dualvision/page.tsx"],"sourcesContent":["\"use client\"\n\nimport { loadModels } from \"@/lib/models\"\nimport { runRealDrowsinessDetection, runRealHazardDetection, getCurrentAlert, triggerAlert } from \"@/lib/detection\"\nimport { logDrowsinessEvent, logHazardEvents, startVaseSession, endVaseSession, logVaseAlert, saveEmergencyContact, getEmergencyContact } from \"@/lib/supabase/analytics\"\nimport { useState, useRef, useCallback, useEffect } from \"react\"\nimport { motion } from \"framer-motion\"\nimport { Button } from \"@/components/ui/button\"\nimport { AlertNotification } from \"@/components/ui/alert-notification\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Switch } from \"@/components/ui/switch\"\nimport { Label } from \"@/components/ui/label\"\nimport { Input } from \"@/components/ui/input\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Progress } from \"@/components/ui/progress\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\"\nimport {\n  Eye,\n  Video,\n  VideoOff,\n  Volume2,\n  VolumeX,\n  AlertTriangle,\n  ArrowLeft,\n  Shield,\n  Bell,\n  Camera,\n  Gauge,\n} from \"lucide-react\"\nimport Link from \"next/link\"\nimport { VisionAILogo } from \"@/components/ui/vision-ai-logo\"\nimport type { DVSERiskAssessment, DrowsinessMetrics, HazardDetection, SafetyStatus, AlertnessWindow } from \"@/lib/types\"\nimport {\n  assessRisk,\n  createAlertnessWindow,\n  updateAlertnessWindow,\n  getStatusColor,\n} from \"@/lib/dvse/engine\"\n\n// Hazard class labels\nconst hazardLabels: Record<string, string> = {\n  cow: \"Cow\",\n  dog: \"Dog\",\n  buffalo: \"Buffalo\",\n  pothole: \"Pothole\",\n  debris: \"Debris\",\n  pedestrian: \"Pedestrian\",\n  broken_vehicle: \"Broken Vehicle\",\n  fallen_tree: \"Fallen Tree\",\n  vehicle: \"Vehicle\",\n  animal: \"Animal\",\n  animal_large: \"Large Animal\",\n  bear: \"Bear\",\n  cat: \"Cat\",\n  horse: \"Horse\"\n}\n\nexport default function DualVisionDemo() {\n  // Camera refs\n  const frontVideoRef = useRef<HTMLVideoElement>(null)\n  const rearVideoRef = useRef<HTMLVideoElement>(null)\n  const frontCanvasRef = useRef<HTMLCanvasElement>(null)\n  const rearCanvasRef = useRef<HTMLCanvasElement>(null)\n\n  // State\n  const [frontCameraActive, setFrontCameraActive] = useState(false)\n  const [rearCameraActive, setRearCameraActive] = useState(false)\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [alert, setAlert] = useState<{ type: 'hazard' | 'drowsiness' | null, message: string }>({ type: null, message: '' })\n  const [soundEnabled, setSoundEnabled] = useState(true)\n  const [emergencyContact, setEmergencyContact] = useState(\"\")\n\n  // VASE State\n  const [drowsiness, setDrowsiness] = useState<DrowsinessMetrics | null>(null)\n  const [hazards, setHazards] = useState<HazardDetection[]>([])\n  const [riskAssessment, setRiskAssessment] = useState<DVSERiskAssessment>({\n    overallStatus: \"safe\",\n    riskScore: 0,\n    alertnessRisk: 0,\n    hazardRisk: 0,\n    timestamp: Date.now(),\n    shouldAlert: false,\n    alertMessage: null,\n  })\n  const [alertnessWindow, setAlertnessWindow] = useState<AlertnessWindow>(() => createAlertnessWindow())\n  const [alertHistory, setAlertHistory] = useState<{ time: Date; message: string; status: SafetyStatus }[]>([])\n\n  const audioRef = useRef<HTMLAudioElement | null>(null)\n  const sessionStartRef = useRef<Date | null>(null)\n  const sessionIdRef = useRef<string | null>(null)\n  const alertCountRef = useRef(0)\n  const hazardCountRef = useRef(0)\n  const alertnessSumRef = useRef(0)\n  const alertnessSamplesRef = useRef(0)\n  const lastAlertTime = useRef(0)\n\n  // Load persistence\n  useEffect(() => {\n    getEmergencyContact().then(email => {\n      if (email) setEmergencyContact(email);\n    });\n  }, []);\n\n  const handleSaveContact = async () => {\n    if (!emergencyContact || !emergencyContact.includes(\"@\")) {\n      window.alert(\"Please enter a valid email.\");\n      return;\n    }\n    try {\n      await saveEmergencyContact(emergencyContact);\n      window.alert(`Emergency contact saved to Supabase: ${emergencyContact}`);\n    } catch (e) {\n      console.error(e);\n      window.alert(\"Failed to save contact. See console.\");\n    }\n  };\n\n  // Startup Guide State\n  const [showGuide, setShowGuide] = useState(false)\n\n  // Show guide on mount once\n  useEffect(() => {\n    setShowGuide(true)\n  }, [])\n\n  // ================= CAMERA DEVICE HELPER =================\n  async function getCameraDevices() {\n    const devices = await navigator.mediaDevices.enumerateDevices()\n    const cams = devices.filter(d => d.kind === \"videoinput\")\n\n    // FRONT CAMERA  Laptop webcam\n    const frontCam =\n      cams.find(c => c.label.toLowerCase().includes(\"integrated\")) ||\n      cams[0]\n\n    // REAR CAMERA  Phone webcam (DroidCam / Iriun)\n    const rearCam = cams.find(c =>\n      c.label.toLowerCase().includes(\"iriun\") ||\n      c.label.toLowerCase().includes(\"droid\")\n    )\n\n    return { frontCam, rearCam }\n  }\n\n  // Main detection loop\n  const runDetection = useCallback(async () => {\n    // Drowsiness (front)\n    let newDrowsiness = null\n    if (frontCameraActive && frontVideoRef.current) {\n      try {\n        const dr = await runRealDrowsinessDetection(frontVideoRef.current)\n        if (dr) {\n          newDrowsiness = dr\n          setDrowsiness(dr)\n          const newWindow = updateAlertnessWindow(alertnessWindow, dr.alertnessScore)\n          setAlertnessWindow(newWindow)\n        }\n      } catch (err) {\n        console.error(\"Real drowsiness detection error:\", err)\n      }\n    } else {\n      newDrowsiness = drowsiness\n    }\n\n    // Hazards (rear)\n    let newHazards: HazardDetection[] = []\n    if (rearCameraActive && rearVideoRef.current) {\n      try {\n        newHazards = await runRealHazardDetection(rearVideoRef.current)\n        setHazards(newHazards)\n      } catch (err) {\n        console.error(\"Real hazard detection error:\", err)\n        newHazards = []\n      }\n    } else {\n      newHazards = []\n      setHazards([])\n    }\n\n    // Access Risk\n    const smoothed = alertnessWindow.average\n    const assessment = assessRisk(newDrowsiness, newHazards, smoothed)\n    setRiskAssessment(assessment)\n\n    // accumulate stats\n    if (newDrowsiness) {\n      alertnessSumRef.current += newDrowsiness.alertnessScore\n      alertnessSamplesRef.current += 1\n    }\n    hazardCountRef.current += newHazards.length\n\n    // Log per-tick\n    if (newDrowsiness) {\n      logDrowsinessEvent({\n        alertnessScore: newDrowsiness.alertnessScore,\n        ear: newDrowsiness.eyeAspectRatio,\n        blinkFrequency: newDrowsiness.blinkFrequency,\n        triggeredAlert: assessment.shouldAlert,\n        sessionId: sessionIdRef.current,\n      })\n    }\n\n    if (newHazards.length > 0) {\n      logHazardEvents(newHazards, sessionIdRef.current)\n    }\n\n    // Handle Alerts\n    if (assessment.shouldAlert) {\n      alertCountRef.current += 1\n\n      // Determine Alert Type\n      let alertType: 'hazard' | 'drowsiness' | null = null;\n      let detailedMessage = \"\";\n\n      if (assessment.overallStatus === 'high-risk' || assessment.hazardRisk > 50) {\n        alertType = 'hazard';\n        // Filter to distinct hazard labels\n        const distinctHazards = Array.from(new Set(newHazards.map(h => hazardLabels[h.objectClass] || h.objectClass)));\n        detailedMessage = `HAZARD: ${distinctHazards.join(\", \")}`;\n      } else if (newDrowsiness && newDrowsiness.alertnessScore < 60) {\n        alertType = 'drowsiness';\n        detailedMessage = `DROWSINESS: Alertness ${newDrowsiness.alertnessScore}%`;\n      }\n\n      if (alertType) {\n        // DEBOUNCE LOGIC: Only update if different or enough time passed\n        // This prevents \"boomerang\" flickering\n        const now = Date.now();\n        if (alert.type !== alertType || alert.message !== detailedMessage || (now - lastAlertTime.current) > 2000) {\n          triggerAlert(alertType);\n          setAlert({\n            type: alertType,\n            message: detailedMessage\n          });\n          lastAlertTime.current = now;\n\n          // Verify we don't spam history\n          const lastHistory = alertHistory[alertHistory.length - 1];\n          if (!lastHistory || lastHistory.message !== detailedMessage || (now - lastHistory.time.getTime()) > 5000) {\n            setAlertHistory((prev) => [\n              ...prev.slice(-9),\n              { time: new Date(), message: detailedMessage, status: assessment.overallStatus },\n            ])\n          }\n        }\n\n        // Auto-send email logic (Backend API)\n        const highSeverityHazards = [\"cow\", \"buffalo\", \"deer\", \"bear\", \"fallen_tree\", \"pothole\", \"wrong_way_vehicle\"];\n        const hasCritical = newHazards.some(h => highSeverityHazards.includes(h.objectClass));\n\n        // Triggers email if drowsiness drops below 50 (User Request)\n        const criticalDrowsiness = newDrowsiness && newDrowsiness.alertnessScore < 50;\n\n        if ((hasCritical || criticalDrowsiness) && emergencyContact) {\n          // Rate Limit: Only send 1 email per 60 seconds to avoid spamming user\n          const lastEmail = localStorage.getItem('last_emergency_email');\n          const now = Date.now();\n\n          if (!lastEmail || (now - parseInt(lastEmail)) > 60000) {\n            console.log(\"Triggering Emergency Email to:\", emergencyContact);\n            localStorage.setItem('last_emergency_email', now.toString());\n\n            fetch('/api/email-alert', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                to: emergencyContact,\n                subject: `URGENT: Vision-AI ${alertType?.toUpperCase()} Alert`,\n                message: `Vision-AI detected a critical safety event.\\n\\nType: ${alertType}\\nDetails: ${detailedMessage}\\nTime: ${new Date().toLocaleString()}\\n\\nPlease check on the driver immediately.`\n              })\n            }).catch(err => console.error(\"Failed to send email:\", err));\n          }\n        }\n      }\n    } else {\n      // Clear alert if safe for > 2 seconds (Debounce clearing)\n      // This prevents the alert from disappearing instantly if detection flickers for 1 frame\n      if (alert.type) {\n        const now = Date.now();\n        if ((now - lastAlertTime.current) > 2000) {\n          setAlert({ type: null, message: '' });\n        }\n      }\n    }\n\n    // draw boxes\n    drawDetections(newHazards)\n  }, [frontCameraActive, rearCameraActive, alertnessWindow, drowsiness, alert, soundEnabled, emergencyContact, alertHistory])\n\n  // Draw bounding boxes on rear camera canvas\n  const drawDetections = (detections: HazardDetection[]) => {\n    const canvas = rearCanvasRef.current\n    const video = rearVideoRef.current\n    if (!canvas || !video) return\n\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n\n    canvas.width = video.videoWidth || 640\n    canvas.height = video.videoHeight || 480\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n    detections.forEach((det) => {\n      const x = det.bbox.x * canvas.width\n      const y = det.bbox.y * canvas.height\n      const w = det.bbox.width * canvas.width\n      const h = det.bbox.height * canvas.height\n\n      // Color based on severity\n      const colors = {\n        critical: \"#ef4444\",\n        high: \"#f59e0b\",\n        medium: \"#06b6d4\",\n        low: \"#22c55e\",\n      } as const\n      ctx.strokeStyle = colors[det.severity]\n      ctx.lineWidth = 3\n      ctx.strokeRect(x, y, w, h)\n\n      // Label\n      const label = `${hazardLabels[det.objectClass] || det.objectClass} ${Math.round(det.confidence * 100)}%`\n      ctx.fillStyle = ctx.strokeStyle\n      const textWidth = ctx.measureText(label).width\n      ctx.fillRect(x, y - 24, textWidth + 12, 24)\n      ctx.fillStyle = \"#fff\"\n      ctx.font = \"14px sans-serif\"\n      ctx.fillText(label, x + 6, y - 7)\n    })\n  }\n\n  // ================= FRONT CAMERA (Laptop Webcam) =================\n  const toggleFrontCamera = async () => {\n    if (frontCameraActive) {\n      // Stop front camera\n      const stream = frontVideoRef.current?.srcObject as MediaStream\n      stream?.getTracks().forEach(track => track.stop())\n      if (frontVideoRef.current) frontVideoRef.current.srcObject = null\n      setFrontCameraActive(false)\n      return\n    }\n\n    try {\n      const { frontCam } = await getCameraDevices()\n\n      if (!frontCam) {\n        console.error(\"No front (laptop) camera found\")\n        return\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          deviceId: frontCam.deviceId,\n          width: 640,\n          height: 480,\n        },\n      })\n\n      if (frontVideoRef.current) {\n        frontVideoRef.current.srcObject = stream\n        await frontVideoRef.current.play()\n        setFrontCameraActive(true)\n        if (!sessionStartRef.current) sessionStartRef.current = new Date()\n      }\n    } catch (err) {\n      console.error(\"Front camera access failed:\", err)\n    }\n  }\n\n\n  // ================= REAR CAMERA (Phone Webcam) =================\n  const toggleRearCamera = async () => {\n    if (rearCameraActive) {\n      // Stop rear camera\n      const stream = rearVideoRef.current?.srcObject as MediaStream\n      stream?.getTracks().forEach(track => track.stop())\n      if (rearVideoRef.current) rearVideoRef.current.srcObject = null\n      setRearCameraActive(false)\n      return\n    }\n\n    try {\n      const { rearCam } = await getCameraDevices()\n\n      if (!rearCam) {\n        console.error(\"No phone (rear) camera found. Is DroidCam/Iriun running?\")\n        return\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          deviceId: rearCam.deviceId,\n          width: 1280,\n          height: 720,\n        },\n      })\n\n      if (rearVideoRef.current) {\n        rearVideoRef.current.srcObject = stream\n        await rearVideoRef.current.play()\n        setRearCameraActive(true)\n        setHazards([]) // Clear old hazards\n        if (!sessionStartRef.current) sessionStartRef.current = new Date()\n      }\n    } catch (err) {\n      console.error(\"Rear camera access failed:\", err)\n    }\n  }\n\n\n  // Toggle processing\n  const toggleProcessing = () => {\n    if (!isProcessing) {\n      // starting a new VASE session\n      startVaseSession().then((id) => {\n        sessionIdRef.current = id\n        alertCountRef.current = 0\n        hazardCountRef.current = 0\n        alertnessSumRef.current = 0\n        alertnessSamplesRef.current = 0\n      })\n    } else {\n      // stopping session: finalize stats\n      if (sessionIdRef.current) {\n        const averageAlertness =\n          alertnessSamplesRef.current > 0 ? alertnessSumRef.current / alertnessSamplesRef.current : null\n\n        endVaseSession({\n          sessionId: sessionIdRef.current,\n          startTime: sessionStartRef.current,\n          totalAlerts: alertCountRef.current,\n          averageAlertness,\n          hazardsDetected: hazardCountRef.current,\n          emergencyContactNotified: false,\n        })\n      }\n      sessionIdRef.current = null\n    }\n    setIsProcessing(!isProcessing)\n  }\n\n  // Run detection loop when processing\n  useEffect(() => {\n    if (!isProcessing) return\n\n    let active = true\n\n    const loop = async () => {\n      while (active && isProcessing) {\n        await runDetection() // wait for model to finish\n        await new Promise((r) => setTimeout(r, 500)) // pause 500ms\n      }\n    }\n\n    loop()\n\n    return () => {\n      active = false\n    }\n  }, [isProcessing, runDetection])\n\n  useEffect(() => {\n    // Listen for alert changes\n    const checkAlert = () => {\n      const currentAlert = getCurrentAlert();\n      if (currentAlert) {\n        setAlert({\n          type: currentAlert,\n          message: currentAlert === 'hazard'\n            ? 'Potential hazard detected.'\n            : 'Drowsiness detected.'\n        });\n      } else {\n        setAlert({ type: null, message: '' });\n      }\n    };\n\n    const alertInterval = setInterval(checkAlert, 1000);\n    return () => clearInterval(alertInterval);\n  }, []);\n\n  // Load TensorFlow models on client mount only\n  useEffect(() => {\n    if (typeof window === \"undefined\") return // prevent SSR failures\n\n    let mounted = true\n      ; (async () => {\n        try {\n          console.log(\"Loading TFJS models...\")\n          await loadModels()\n          if (mounted) console.log(\"Models ready \")\n        } catch (err) {\n          console.error(\"Error loading models:\", err)\n        }\n      })()\n\n    return () => {\n      mounted = false\n    }\n  }, [])\n\n  // Get status display\n  const getStatusDisplay = (status: SafetyStatus) => {\n    switch (status) {\n      case \"safe\":\n        return { label: \"SAFE\", bg: \"bg-success\", text: \"text-success\" }\n      case \"caution\":\n        return { label: \"CAUTION\", bg: \"bg-warning\", text: \"text-warning\" }\n      case \"high-risk\":\n        return { label: \"HIGH RISK\", bg: \"bg-destructive\", text: \"text-destructive\" }\n    }\n  }\n\n  const statusDisplay = getStatusDisplay(riskAssessment.overallStatus)\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Startup Guide Dialog */}\n      <Dialog open={showGuide} onOpenChange={setShowGuide}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Welcome to VASE (Vision-AI Safety Engine)</DialogTitle>\n            <DialogDescription className=\"pt-2 space-y-2\" asChild>\n              <div className=\"text-muted-foreground text-sm pt-2 space-y-2\">\n                <p>\n                  To utilize the <strong>Dual-Vision</strong> capabilities effectively, please ensure:\n                </p>\n                <ul className=\"list-disc pl-5 space-y-1\">\n                  <li>\n                    <strong>Front Camera:</strong> To monitor driver drowsiness.\n                  </li>\n                  <li>\n                    <strong>Rear Camera:</strong> Connect an external webcam/dashcam or use your phone to monitor the road ahead.\n                  </li>\n                </ul>\n                <p className=\"text-xs text-muted-foreground mt-2\">\n                  This setup allows VASE to detect both internal driver state and external road hazards simultaneously.\n                </p>\n              </div>\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter className=\"sm:justify-start gap-2\">\n            <Button type=\"button\" onClick={() => setShowGuide(false)}>\n              I Understand\n            </Button>\n            <Button type=\"button\" variant=\"secondary\" onClick={() => setShowGuide(false)}>\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Audio for alerts */}\n      <audio ref={audioRef} preload=\"auto\">\n        <source\n          src=\"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleU9PT46xvqF0Q0VBetjD2aJtOUJdxN7j4Z2CUUpBfbG8rH1LS0ttyuLx8qqIU0tBfaq6rnlKSEtzz+j2+qqJVEpAf6m5r3pJR0p40O3++q2MVUY8g6y5r31KSEp40vD//7GOVkY7hK66sH5KSUl41PL//7KQWEI4h6+7sYBLSkh41vT//7WSWUE2iLC8soFMS0h41/X//7iTW0E1irC8s4JNTEh52Pb//7qUXEAzjLG9tIROTUd52ff//7yVXkAyi7K+tYVPTkd52vj//76XX0Axi7O/toZQT0Z63Pn//8CYYEA\"\n          type=\"audio/wav\"\n        />\n      </audio>\n\n      {/* Alert Notifications */}\n      <AlertNotification\n        type={alert.type}\n        message={alert.message}\n        onClose={() => setAlert({ type: null, message: '' })}\n      />\n\n      {/* Header */}\n      <header className=\"border-b border-border bg-card/50 backdrop-blur sticky top-0 z-40\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-4\">\n              <Link\n                href=\"/\"\n                className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors\"\n              >\n                <ArrowLeft className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\">Back</span>\n              </Link>\n              <VisionAILogo size=\"sm\" />\n            </div>\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              <Shield className=\"h-3 w-3\" />\n              Vision-AI Safety Engine (VASE)\n            </Badge>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Risk Assessment Banner */}\n        <motion.div\n          className={`mb-6 p-4 rounded-xl border ${riskAssessment.overallStatus === \"high-risk\"\n            ? \"border-destructive bg-destructive/10\"\n            : riskAssessment.overallStatus === \"caution\"\n              ? \"border-warning bg-warning/10\"\n              : \"border-success bg-success/10\"\n            }`}\n          animate={riskAssessment.shouldAlert ? { scale: [1, 1.02, 1] } : {}}\n          transition={{ duration: 0.5, repeat: riskAssessment.shouldAlert ? Number.POSITIVE_INFINITY : 0 }}\n        >\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className={`h-16 w-16 rounded-full flex items-center justify-center ${statusDisplay.bg}`}>\n                <Shield className=\"h-8 w-8 text-white\" />\n              </div>\n              <div>\n                <div className={`text-2xl font-bold ${statusDisplay.text}`}>{statusDisplay.label}</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Risk Score: {riskAssessment.riskScore}% | Alertness Risk: {Math.round(riskAssessment.alertnessRisk)}% | Hazard\n                  Risk: {riskAssessment.hazardRisk}%\n                </div>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button onClick={toggleProcessing} variant={isProcessing ? \"destructive\" : \"default\"} size=\"lg\">\n                {isProcessing ? \"Stop VASE\" : \"Start VASE\"}\n              </Button>\n            </div>\n          </div>\n        </motion.div>\n\n        <div className=\"grid lg:grid-cols-2 gap-6\">\n          {/* Front Camera - Drowsiness */}\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Eye className=\"h-5 w-5 text-primary\" />\n                  <div>\n                    <CardTitle>Front Camera</CardTitle>\n                    <CardDescription>Driver Alertness Monitoring</CardDescription>\n                  </div>\n                </div>\n                <Button onClick={toggleFrontCamera} variant={frontCameraActive ? \"destructive\" : \"outline\"} size=\"sm\">\n                  {frontCameraActive ? <VideoOff className=\"h-4 w-4\" /> : <Video className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"relative aspect-video bg-secondary/30\">\n                <video ref={frontVideoRef} autoPlay playsInline muted className=\"w-full h-full object-cover\" />\n                <canvas ref={frontCanvasRef} className=\"absolute inset-0 w-full h-full pointer-events-none\" />\n\n                {!frontCameraActive && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <Eye className=\"h-12 w-12 text-muted-foreground/30 mx-auto mb-2\" />\n                      <p className=\"text-sm text-muted-foreground\">Front camera for drowsiness detection</p>\n                    </div>\n                  </div>\n                )}\n\n                {/* Drowsiness Overlay */}\n                {frontCameraActive && drowsiness && (\n                  <div className=\"absolute bottom-4 left-4 right-4 bg-background/80 backdrop-blur rounded-lg p-3\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-sm font-medium\">Alertness</span>\n                      <span className={`text-lg font-bold ${getStatusColor(riskAssessment.overallStatus)}`}>\n                        {Math.round(alertnessWindow.average)}%\n                      </span>\n                    </div>\n                    <Progress value={alertnessWindow.average} className=\"h-2\" />\n                    <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                      <span>EAR: {drowsiness.eyeAspectRatio.toFixed(3)}</span>\n                      <span> {drowsiness.blinkFrequency}</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Rear Camera - Hazards */}\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <AlertTriangle className=\"h-5 w-5 text-warning\" />\n                  <div>\n                    <CardTitle>Rear Camera</CardTitle>\n                    <CardDescription>Road Hazard Detection</CardDescription>\n                  </div>\n                </div>\n                <Button onClick={toggleRearCamera} variant={rearCameraActive ? \"destructive\" : \"outline\"} size=\"sm\">\n                  {rearCameraActive ? <VideoOff className=\"h-4 w-4\" /> : <Camera className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"relative aspect-video bg-secondary/30\">\n                <video ref={rearVideoRef} autoPlay playsInline muted className=\"w-full h-full object-cover\" />\n                <canvas ref={rearCanvasRef} className=\"absolute inset-0 w-full h-full pointer-events-none\" />\n\n                {!rearCameraActive && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <Camera className=\"h-12 w-12 text-muted-foreground/30 mx-auto mb-2\" />\n                      <p className=\"text-sm text-muted-foreground\">Rear camera for hazard detection</p>\n                    </div>\n                  </div>\n                )}\n\n                {/* Hazard Overlay */}\n                {rearCameraActive && hazards.length > 0 && (\n                  <div className=\"absolute top-4 right-4\">\n                    <Badge variant=\"destructive\" className=\"animate-pulse\">\n                      {hazards.length} Hazard{hazards.length > 1 ? \"s\" : \"\"} Detected\n                    </Badge>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Bottom Row */}\n        <div className=\"grid lg:grid-cols-3 gap-6 mt-6\">\n          {/* Risk Meter */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Gauge className=\"h-5 w-5\" />\n                Unified Risk Meter\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"relative h-32 flex items-end justify-center\">\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className={`text-5xl font-bold ${getStatusColor(riskAssessment.overallStatus)}`}>\n                      {riskAssessment.riskScore}%\n                    </div>\n                  </div>\n                </div>\n                <div className=\"h-4 rounded-full bg-gradient-to-r from-success via-warning to-destructive overflow-hidden\">\n                  <motion.div\n                    className=\"h-full bg-foreground/20\"\n                    style={{ marginLeft: `${riskAssessment.riskScore}%` }}\n                    animate={{ marginLeft: `${riskAssessment.riskScore}%` }}\n                  />\n                </div>\n                <div className=\"flex justify-between text-xs text-muted-foreground\">\n                  <span>Safe</span>\n                  <span>Caution</span>\n                  <span>High Risk</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Current Detections */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Active Hazards\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {hazards.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Shield className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\n                  <p className=\"text-sm\">No hazards detected</p>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {hazards.map((hazard) => (\n                    <div key={hazard.id} className=\"p-3 rounded-lg bg-warning/10 border border-warning/20\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"font-medium\">{hazardLabels[hazard.objectClass] || hazard.objectClass}</span>\n                        <Badge\n                          variant={hazard.severity === \"critical\" ? \"destructive\" : \"secondary\"}\n                          className=\"text-xs\"\n                        >\n                          {hazard.severity}\n                        </Badge>\n                      </div>\n                      <div className=\"text-sm text-muted-foreground mt-1\">\n                        Confidence: {Math.round(hazard.confidence * 100)}%\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Settings & Alert History */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Bell className=\"h-5 w-5\" />\n                Settings & Alerts\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"flex items-center gap-2\">\n                  {soundEnabled ? <Volume2 className=\"h-4 w-4\" /> : <VolumeX className=\"h-4 w-4\" />}\n                  <Label htmlFor=\"sound\">Alert Sound</Label>\n                </div>\n                <Switch id=\"sound\" checked={soundEnabled} onCheckedChange={setSoundEnabled} />\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"emergency\" className=\"flex items-center gap-2\">\n                    <Bell className=\"h-4 w-4\" />\n                    Emergency Contact Email\n                  </Label>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      id=\"emergency\"\n                      type=\"email\"\n                      placeholder=\"emergency@example.com\"\n                      value={emergencyContact}\n                      onChange={(e) => setEmergencyContact(e.target.value)}\n                    />\n                    <Button\n                      variant=\"outline\"\n                      onClick={handleSaveContact}\n                    >\n                      Save\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    Alerts from Critical Hazards or Drowsiness will prompt an email draft.\n                  </p>\n                </div>\n              </div>\n\n              {alertHistory.length > 0 && (\n                <div className=\"pt-4 border-t border-border\">\n                  <div className=\"text-sm font-medium mb-2\">Recent Alerts</div>\n                  <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                    {alertHistory.slice(-5).map((alert, i) => (\n                      <div key={i} className=\"text-xs text-muted-foreground flex justify-between\">\n                        <span className=\"truncate flex-1 mr-2\">{alert.message}</span>\n                        <span className=\"whitespace-nowrap\">{alert.time.toLocaleTimeString()}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}