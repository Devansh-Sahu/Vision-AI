{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/models.ts"],"sourcesContent":["// lib/models.ts\r\n// Self-hosted TFJS FaceMesh + COCO-SSD loader\r\n\r\nimport * as tf from \"@tensorflow/tfjs\"\r\n\r\nlet objectDetector: any | null = null\r\nlet faceMeshModel: tf.GraphModel | null = null\r\nlet modelsLoaded = false\r\n\r\nlet objectLoadingPromise: Promise<void> | null = null\r\nlet faceMeshLoadingPromise: Promise<void> | null = null\r\n\r\n// -------------------------------\r\n// Load rear camera (hazard) model\r\n// -------------------------------\r\nexport async function loadModels() {\r\n  if (modelsLoaded) return\r\n  if (typeof window === \"undefined\") return\r\n  if (objectLoadingPromise) return objectLoadingPromise\r\n\r\n  objectLoadingPromise = (async () => {\r\n    try {\r\n      const coco = await import(\"@tensorflow-models/coco-ssd\")\r\n      \r\n\r\n      objectDetector = await coco.load({ base: \"lite_mobilenet_v2\" })\r\n      console.log(\"COCO-SSD loaded\")\r\n\r\n      modelsLoaded = true\r\n    } catch (err) {\r\n      console.error(\"Error loading COCO-SSD:\", err)\r\n    }\r\n  })()\r\n\r\n  return objectLoadingPromise\r\n}\r\n\r\nexport function getObjectDetector() {\r\n  return objectDetector\r\n}\r\n\r\n// ----------------------------------------\r\n// Load FaceMesh graph model (self-hosted)\r\n// ----------------------------------------\r\nexport async function ensureFaceMeshLoaded() {\r\n  if (faceMeshModel) return\r\n  if (typeof window === \"undefined\") return\r\n  if (faceMeshLoadingPromise) return faceMeshLoadingPromise\r\n\r\n  faceMeshLoadingPromise = (async () => {\r\n    try {\r\n\r\n\r\n      faceMeshModel = await tf.loadGraphModel(\r\n        \"/models/facemesh/model.json\",\r\n        { fromTFHub: false }\r\n      )\r\n\r\n      console.log(\"FaceMesh model loaded (local)\")\r\n    } catch (err) {\r\n      console.error(\"Failed to load FaceMesh:\", err)\r\n      faceMeshModel = null\r\n    }\r\n  })()\r\n\r\n  return faceMeshLoadingPromise\r\n}\r\n\r\nexport function getFaceMeshModel() {\r\n  return faceMeshModel\r\n}\r\n\r\n// -----------------------------------------------\r\n// Run FaceMesh inference and return raw tensors\r\n// -----------------------------------------------\r\nexport async function runFaceMesh(video: HTMLVideoElement) {\r\n  if (!faceMeshModel) return null\r\n\r\n  try {\r\n    const input = tf.tidy(() => {\r\n      return tf.browser.fromPixels(video)\r\n        .resizeBilinear([192, 192])\r\n        .expandDims(0)\r\n        .toFloat()\r\n        .div(127.5)\r\n        .sub(1) // Normalize to [-1, 1]\r\n    })\r\n\r\n    // Get model output using the correct output names from the model\r\n    // Using execute() instead of executeAsync() since we don't have dynamic output shapes\r\n    const outputs = faceMeshModel.execute(input, [\r\n      'Identity_2', // output_mesh (landmarks)\r\n      'Identity_1', // output_faceflag (confidence)\r\n      'Identity'    // output_contours\r\n    ]) as tf.Tensor[]\r\n    \r\n    // Clean up input tensor\r\n    input.dispose()\r\n\r\n    try {\r\n      // Convert to arrays for debugging\r\n      const [landmarksData, faceFlagData] = await Promise.all([\r\n        outputs[0].array() as Promise<number[][]>,\r\n        outputs[1].array() as Promise<number[][]>\r\n      ])\r\n\r\n      // Clean up output tensors\r\n      outputs.forEach(t => t.dispose())\r\n\r\n      // Check for valid output\r\n      if (!landmarksData?.[0] || !faceFlagData?.[0]) {\r\n        console.warn('No face detected or invalid output format')\r\n        return null\r\n      }\r\n\r\n      // Return the raw tensors for further processing\r\n      // Convert to tensors with proper shapes\r\n      const landmarksTensor = tf.tensor2d(landmarksData, [landmarksData.length, landmarksData[0].length])\r\n      const confidenceTensor = tf.tensor1d(faceFlagData[0])\r\n\r\n      return [landmarksTensor, confidenceTensor]\r\n    } catch (error) {\r\n      console.error('Error processing face mesh output:', error)\r\n      // Ensure cleanup on error\r\n      for (const t of outputs) {\r\n        try {\r\n          t.dispose()\r\n        } catch (e) {\r\n          console.warn('Error disposing tensor:', e)\r\n        }\r\n      }\r\n      return null\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in runFaceMesh:', error)\r\n    return null\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;AAChB,8CAA8C;;;;;;;;;;;;;AAE9C;AAAA;AAAA;AAAA;AAAA;;AAEA,IAAI,iBAA6B;AACjC,IAAI,gBAAsC;AAC1C,IAAI,eAAe;AAEnB,IAAI,uBAA6C;AACjD,IAAI,yBAA+C;AAK5C,eAAe;IACpB,IAAI,cAAc;IAClB,wCAAmC;;;AAkBrC;AAEO,SAAS;IACd,OAAO;AACT;AAKO,eAAe;IACpB,IAAI,eAAe;IACnB,wCAAmC;;;AAoBrC;AAEO,SAAS;IACd,OAAO;AACT;AAKO,eAAe,YAAY,KAAuB;IACvD,IAAI,CAAC,eAAe,OAAO;IAE3B,IAAI;QACF,MAAM,QAAQ,uKAAO,CAAC;YACpB,OAAO,oNAAU,CAAC,UAAU,CAAC,OAC1B,cAAc,CAAC;gBAAC;gBAAK;aAAI,EACzB,UAAU,CAAC,GACX,OAAO,GACP,GAAG,CAAC,OACJ,GAAG,CAAC,GAAG,uBAAuB;;QACnC;QAEA,iEAAiE;QACjE,sFAAsF;QACtF,MAAM,UAAU,cAAc,OAAO,CAAC,OAAO;YAC3C;YACA;YACA,WAAc,kBAAkB;SACjC;QAED,wBAAwB;QACxB,MAAM,OAAO;QAEb,IAAI;YACF,kCAAkC;YAClC,MAAM,CAAC,eAAe,aAAa,GAAG,MAAM,QAAQ,GAAG,CAAC;gBACtD,OAAO,CAAC,EAAE,CAAC,KAAK;gBAChB,OAAO,CAAC,EAAE,CAAC,KAAK;aACjB;YAED,0BAA0B;YAC1B,QAAQ,OAAO,CAAC,CAAA,IAAK,EAAE,OAAO;YAE9B,yBAAyB;YACzB,IAAI,CAAC,eAAe,CAAC,EAAE,IAAI,CAAC,cAAc,CAAC,EAAE,EAAE;gBAC7C,QAAQ,IAAI,CAAC;gBACb,OAAO;YACT;YAEA,gDAAgD;YAChD,wCAAwC;YACxC,MAAM,kBAAkB,mLAAW,CAAC,eAAe;gBAAC,cAAc,MAAM;gBAAE,aAAa,CAAC,EAAE,CAAC,MAAM;aAAC;YAClG,MAAM,mBAAmB,mLAAW,CAAC,YAAY,CAAC,EAAE;YAEpD,OAAO;gBAAC;gBAAiB;aAAiB;QAC5C,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,sCAAsC;YACpD,0BAA0B;YAC1B,KAAK,MAAM,KAAK,QAAS;gBACvB,IAAI;oBACF,EAAE,OAAO;gBACX,EAAE,OAAO,GAAG;oBACV,QAAQ,IAAI,CAAC,2BAA2B;gBAC1C;YACF;YACA,OAAO;QACT;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO;IACT;AACF"}},
    {"offset": {"line": 171, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/detection.ts"],"sourcesContent":["// lib/detection.ts\nlet tfReady: Promise<void> | null = null;\n\nfunction ensureTFReady() {\n  if (!tfReady) {\n    tfReady = tf.ready(); // <-- AUTO selects cpu / webgl / wasm\n  }\n  return tfReady;\n}\n\n\nimport {\n  getFaceMeshModel,\n  ensureFaceMeshLoaded,\n  runFaceMesh,\n  getObjectDetector,\n  loadModels,\n} from \"./models\"\n\nimport type {\n  DrowsinessMetrics,\n  HazardDetection,\n  HazardObjectClass,\n  BoundingBox\n} from \"@/lib/types\"\n\nimport * as tf from \"@tensorflow/tfjs\"\n\n// FaceMesh landmark indexes for eyes\nconst LEFT_EYE = [33, 160, 158, 133, 153, 144]\nconst RIGHT_EYE = [263, 387, 385, 362, 380, 373]\n\n// EAR (Eye Aspect Ratio) calculation\ntype Point = [number, number];\n\nfunction getEAR(eyePoints: Point[]): number {\n  try {\n    // Ensure we have valid points\n    if (!eyePoints || eyePoints.length !== 6) {\n      console.warn('Invalid eye points:', eyePoints);\n      return 0;\n    }\n\n    // Get the eye points (using MediaPipe's 6-point model)\n    const [p1, p2, p3, p4, p5, p6] = eyePoints;\n    \n    // Calculate vertical distances\n    const v1 = distance(p2, p6);  // Vertical distance 1\n    const v2 = distance(p3, p5);  // Vertical distance 2\n    \n    // Calculate horizontal distance (between eye corners)\n    const h = distance(p1, p4);\n    \n    // Avoid division by zero\n    if (h === 0) return 0;\n    \n    // Calculate EAR\n    const ear = (v1 + v2) / (2 * h);\n    \n    // Log detailed EAR calculation every 30 frames\n    if (debug.frameCount % 30 === 0) {\n      console.log('Eye Points:', eyePoints.map(p => ({\n        x: p[0].toFixed(2),\n        y: p[1].toFixed(2)\n      })));\n      \n      console.log('EAR Calculation:', {\n        v1: v1.toFixed(4),\n        v2: v2.toFixed(4),\n        h: h.toFixed(4),\n        ear: ear.toFixed(4),\n        normalized: (ear * 2.5).toFixed(4)  // Show what it would be with scaling\n      });\n    }\n    \n    // Return scaled EAR for better thresholding\n    return Math.max(0, Math.min(1, ear * 2.5));\n  } catch (error) {\n    console.error('Error in EAR calculation:', error);\n    return 0;\n  }\n}\n\n// Calculate distance between two points\nfunction distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2[0] - p1[0], 2) + Math.pow(p2[1] - p1[1], 2));\n}\n\n// Moving average for EAR values to smooth detection\nclass MovingAverage {\n  private values: number[] = [];\n  private size: number;\n  \n  constructor(size: number = 5) {\n    this.size = size;\n  }\n  \n  add(value: number): number {\n    this.values.push(value);\n    if (this.values.length > this.size) {\n      this.values.shift();\n    }\n    return this.average();\n  }\n  \n  average(): number {\n    if (this.values.length === 0) return 0;\n    return this.values.reduce((a, b) => a + b, 0) / this.values.length;\n  }\n  \n  reset() {\n    this.values = [];\n  }\n}\n\n// Track eye state with more responsive settings\nlet leftEARHistory = new MovingAverage(3);  // Smaller window for more responsiveness\nlet rightEARHistory = new MovingAverage(3);\nlet consecutiveLowEARCounter = 0;\nlet blinkStartTime = 0;\ntype EyeState = 'open' | 'closing' | 'closed';\nlet eyeState: EyeState = 'open';\n// Adjusted thresholds based on scaled EAR values\n// These values work with the scaled EAR (multiplied by 2.5)\nconst EYE_CLOSED_THRESHOLD = 0.25;  // Below this is considered closed\nconst EYE_OPEN_THRESHOLD = 0.30;    // Above this is considered open\nlet blinkCount = 0;\nlet lastBlinkTime = Date.now();\nlet lastFaceTime = Date.now();\n\n// Reset tracking when no face is detected for a while\nlet noFaceCounter = 0;\nconst MAX_NO_FACE_FRAMES = 5;  // Shorter timeout for faster reset\n\n// Debug state\nconst debug = {\n  lastLeftEAR: 0,\n  lastRightEAR: 0,\n  lastAvgEAR: 0,\n  lastBlinkState: 'open',\n  lastUpdate: 0,\n  frameCount: 0\n};\n\nexport async function runRealDrowsinessDetection(\n  videoEl: HTMLVideoElement | null\n): Promise<DrowsinessMetrics | null> {\n  if (!videoEl || videoEl.readyState < 2) return null\n  \n  await ensureTFReady()\n  await ensureFaceMeshLoaded()\n  \n  const model = getFaceMeshModel()\n  if (!model) return null\n\n  try {\n    const outputs = await runFaceMesh(videoEl)\n    if (!outputs || outputs.length < 2) return null\n\n    // Get landmarks and confidence from outputs\n    const [landmarksTensor, confidenceTensor] = outputs\n    \n    try {\n      // Debug tensor shapes and data types\n      console.debug('Tensor inspection:', {\n        landmarks: {\n          shape: landmarksTensor.shape,\n          dtype: landmarksTensor.dtype,\n          size: landmarksTensor.size,\n          rank: landmarksTensor.rank,\n          isDisposed: landmarksTensor.isDisposed\n        },\n        confidence: {\n          shape: confidenceTensor.shape,\n          dtype: confidenceTensor.dtype,\n          size: confidenceTensor.size,\n          rank: confidenceTensor.rank,\n          isDisposed: confidenceTensor.isDisposed\n        }\n      });\n      \n      // Get raw arrays from tensors\n      const landmarksData = await landmarksTensor.array();\n      const confidenceData = await confidenceTensor.arraySync(); // Use sync for immediate evaluation\n      \n      // Debug raw data structure\n      const deepInspect = (obj: any, depth = 2): any => {\n        if (depth === 0 || obj === null || typeof obj !== 'object') {\n          if (Array.isArray(obj)) return `Array[${obj.length}]`;\n          if (typeof obj === 'number') return obj.toExponential(2);\n          return obj;\n        }\n        const result: any = {};\n        for (const key in obj) {\n          if (Array.isArray(obj[key])) {\n            result[key] = `Array[${obj[key].length}]`;\n            if (obj[key].length > 0) {\n              result[`${key}_first`] = deepInspect(obj[key][0], depth - 1);\n            }\n          } else if (typeof obj[key] === 'object') {\n            result[key] = deepInspect(obj[key], depth - 1);\n          } else {\n            result[key] = obj[key];\n          }\n        }\n        return result;\n      };\n      \n      console.debug('Raw data structure:', {\n        landmarksType: Array.isArray(landmarksData) ? `Array[${landmarksData.length}]` : typeof landmarksData,\n        confidenceType: Array.isArray(confidenceData) ? `Array[${confidenceData.length}]` : typeof confidenceData,\n        confidenceSample: deepInspect(confidenceData)\n      });\n      \n      // Clean up tensors immediately after use\n      landmarksTensor.dispose();\n      confidenceTensor.dispose();\n\n      // Flatten the landmarks data if it's nested\n      const landmarksArray = Array.isArray(landmarksData[0]) \n        ? (landmarksData as number[][])[0] \n        : landmarksData as number[]\n        \n      // Process confidence score - since we're getting very low values but good landmarks,\n      // we'll be more permissive with the confidence threshold\n      let confidenceScore = 0.8; // Default to high confidence since we have landmarks\n      \n      // Only use the model's confidence score if it's reasonably high\n      try {\n        if (Array.isArray(confidenceData)) {\n          const flatArray = confidenceData.flat(Infinity);\n          if (flatArray.length > 0) {\n            const modelConfidence = Math.abs(Number(flatArray[0]));\n            // Only use model's confidence if it's above a threshold\n            if (modelConfidence > 0.1) {\n              confidenceScore = modelConfidence;\n            }\n          }\n        }\n      } catch (e) {\n        console.debug('Using default confidence score due to error:', e);\n      }\n\n      // Debug logging\n      if (debug.frameCount++ % 10 === 0) {\n        console.log('Face detection results:', {\n          frame: debug.frameCount,\n          landmarksLength: landmarksArray?.length,\n          confidenceScore,\n          confidenceDataType: typeof confidenceData,\n          confidenceDataShape: Array.isArray(confidenceData) ? \n            `[${confidenceData.length}${Array.isArray(confidenceData[0]) ? 'x' + confidenceData[0].length : ''}]` : 'scalar'\n        });\n      }\n\n      // Check for valid face detection\n      // We're being very permissive with confidence scores since the model seems to work well\n      // even with low confidence values\n      if (!landmarksArray || landmarksArray.length < 1404) {\n        console.debug('Invalid landmarks data, skipping frame');\n        noFaceCounter++;\n        if (noFaceCounter > MAX_NO_FACE_FRAMES) {\n          // Reset tracking if no face is detected for a while\n          leftEARHistory.reset();\n          rightEARHistory.reset();\n          blinkCount = 0;\n          eyeState = 'open';\n        }\n        return null;\n      }\n      \n      // Reset no-face counter when we have valid landmarks\n      noFaceCounter = 0;\n      \n      // If we have valid landmarks but low confidence, log it but continue\n      if (confidenceScore < 0.1) {\n        console.debug('Low confidence score but proceeding with detection:', confidenceScore);\n      }\n      \n      // Convert flat array of [x1,y1,z1, x2,y2,z2, ...] to array of {x,y} points\n      const landmarkPoints: {x: number, y: number}[] = [];\n      for (let i = 0; i < landmarksArray.length; i += 3) {\n        landmarkPoints.push({\n          x: (landmarksArray[i] as number) * (videoEl?.videoWidth || 1),\n          y: (landmarksArray[i + 1] as number) * (videoEl?.videoHeight || 1)\n        });\n      }\n\n      // Extract eye coordinates - each point is now {x, y}\n      const leftEyePoints = LEFT_EYE.map(i => {\n        const point = landmarkPoints[i] || {x: 0, y: 0};\n        return [point.x, point.y];\n      }) as Point[];\n      \n      const rightEyePoints = RIGHT_EYE.map(i => {\n        const point = landmarkPoints[i] || {x: 0, y: 0};\n        return [point.x, point.y];\n      }) as Point[];\n\n      // Calculate EAR for both eyes with validation\n      const leftEAR = Math.max(0, getEAR(leftEyePoints));\n      const rightEAR = Math.max(0, getEAR(rightEyePoints));\n      \n      // Update moving averages with validation\n      const avgLeftEAR = Math.max(0.1, leftEARHistory.add(leftEAR));\n      const avgRightEAR = Math.max(0.1, rightEARHistory.add(rightEAR));\n      let avgEAR = (avgLeftEAR + avgRightEAR) / 2;\n      \n      // Log EAR values and state every 30 frames\n      if (debug.frameCount % 30 === 0) {\n        console.log('Eye State:', {\n          frame: debug.frameCount,\n          leftEAR: leftEAR.toFixed(4),\n          rightEAR: rightEAR.toFixed(4),\n          avgLeftEAR: avgLeftEAR.toFixed(4),\n          avgRightEAR: avgRightEAR.toFixed(4),\n          avgEAR: avgEAR.toFixed(4),\n          currentState: eyeState,\n          isBlinking: avgEAR < EYE_CLOSED_THRESHOLD,\n          thresholds: {\n            closed: EYE_CLOSED_THRESHOLD,\n            open: EYE_OPEN_THRESHOLD\n          }\n        });\n      }\n      \n      // Update debug info with EAR values\n      debug.lastLeftEAR = leftEAR;\n      debug.lastRightEAR = rightEAR;\n      debug.frameCount++;\n      \n      // Log EAR values every 30 frames\n      if (debug.frameCount % 30 === 0) {\n        console.debug('EAR Values:', {\n          frame: debug.frameCount,\n          leftEAR: leftEAR.toFixed(4),\n          rightEAR: rightEAR.toFixed(4),\n          avgLeftEAR: avgLeftEAR.toFixed(4),\n          avgRightEAR: avgRightEAR.toFixed(4),\n          avgEAR: avgEAR.toFixed(4)\n        });\n      }\n      \n      // Ensure EAR is within reasonable bounds\n      avgEAR = Math.max(0.1, Math.min(0.4, avgEAR));\n      debug.lastAvgEAR = avgEAR;\n      \n      // Detect blinks and update state with hysteresis\n      const isBlinking = avgEAR < EYE_CLOSED_THRESHOLD;\n      const now = Date.now();\n      \n      // Use different thresholds for closing vs opening eyes to prevent flickering\n      const eyeOpenThreshold = EYE_CLOSED_THRESHOLD * 1.3; // 30% higher threshold for opening\n      \n      if (isBlinking && eyeState === 'open') {\n        // Start of a potential blink\n        eyeState = 'closing';\n        blinkStartTime = now;\n        console.debug('Blink started:', { \n          frame: debug.frameCount,\n          avgEAR: avgEAR.toFixed(4),\n          time: now \n        });\n      } \n      // Consider eyes fully closed after a short delay\n      else if (eyeState === 'closing' && now - blinkStartTime > 50) {\n        eyeState = 'closed';\n      }\n      // Reopen eyes when EAR rises above the higher threshold\n      else if (!isBlinking && (eyeState === 'closed' || eyeState === 'closing') && avgEAR > eyeOpenThreshold) {\n        if (eyeState === 'closed') {\n          const blinkDuration = now - blinkStartTime;\n          if (blinkDuration > 50 && blinkDuration < 500) { // Valid blink duration (50-500ms)\n            blinkCount++;\n            console.debug('Blink completed:', { \n              frame: debug.frameCount,\n              duration: blinkDuration,\n              count: blinkCount \n            });\n          }\n        }\n        eyeState = 'open';\n      }\n      \n      // Calculate blink rate (blinks per minute)\n      const timeSinceLastBlink = now - lastBlinkTime;\n      const recentBlinks = blinkCount - (blinkCount > 0 ? 1 : 0); // Exclude current blink if any\n      const blinkRate = recentBlinks > 0 ? (recentBlinks / (timeSinceLastBlink / 60000)) : 0;\n      \n      // Calculate base score based on EAR (0-100)\n      const normalizedEAR = (avgEAR - 0.1) * 3.33; // Normalize 0.1-0.4 to 0-100\n      const baseScore = Math.min(100, Math.max(0, normalizedEAR * 100));\n      \n      // Apply penalties and bonuses\n      const blinkPenalty = blinkRate > 20 ? 20 : 0; // Penalize excessive blinking\n      const timePenalty = timeSinceLastBlink > 5000 ? 20 : 0; // Penalize no blinks for 5+ seconds\n      const varianceBonus = Math.abs(avgLeftEAR - avgRightEAR) < 0.05 ? 10 : 0; // Reward symmetric blinking\n      \n      // Calculate final score with bounds\n      let alertnessScore = Math.max(0, Math.min(100, \n        baseScore - blinkPenalty - timePenalty + varianceBonus\n      ));\n      \n      // Detect drowsiness patterns\n      const isDrowsy = avgEAR < 0.2 || \n                      blinkRate < 2 || \n                      timeSinceLastBlink > 3000 || \n                      Math.abs(avgLeftEAR - avgRightEAR) > 0.1;\n      \n      // Debug logging every 30 frames\n      if (debug.frameCount % 30 === 0) {\n        console.debug('Drowsiness Detection:', {\n          frame: debug.frameCount,\n          leftEAR: leftEAR.toFixed(3),\n          rightEAR: rightEAR.toFixed(3),\n          avgEAR: avgEAR.toFixed(3),\n          blinkRate: blinkRate.toFixed(1),\n          timeSinceLastBlink,\n          isBlinking,\n          eyeState,\n          alertnessScore: Math.round(alertnessScore),\n          isDrowsy,\n          penalties: { blinkPenalty, timePenalty },\n          varianceBonus\n        });\n      }\n      \n      return {\n        alertnessScore: Math.round(alertnessScore),\n        eyeAspectRatio: parseFloat(avgEAR.toFixed(3)),\n        blinkCount,\n        blinkFrequency: parseFloat(blinkRate.toFixed(1)),\n        isAlert: !isDrowsy && alertnessScore > 40,\n        headTilt: null,\n        lookingAway: false,\n        yawning: false,\n        lastUpdated: Date.now(),\n      }\n    } catch (error) {\n      console.error('Error processing face detection:', error)\n      return null\n    }\n  } catch (err) {\n    console.warn(\"FaceMesh detection failed:\", err)\n    return null\n  }\n}\n\n// ----------------- Hazard Detection (unchanged) -----------------\n\nconst HAZARD_MIN_CONFIDENCE = 0.5\n\nconst COCO_TO_HAZARD_CLASS: Record<string, HazardObjectClass> = {\n  person: \"pedestrian\",\n  dog: \"dog\",\n  cow: \"cow\",\n  car: \"wrong_way_vehicle\",\n  truck: \"wrong_way_vehicle\",\n  bus: \"wrong_way_vehicle\",\n  motorcycle: \"wrong_way_vehicle\",\n  bicycle: \"cyclist\",\n  bench: \"road_barrier\",\n  chair: \"road_barrier\",\n}\n\nfunction normalizeBBox(\n  bboxPixels: [number, number, number, number],\n  frameWidth: number,\n  frameHeight: number\n): BoundingBox {\n  const [x, y, w, h] = bboxPixels\n\n  return {\n    x: x / frameWidth,\n    y: y / frameHeight,\n    width: w / frameWidth,\n    height: h / frameHeight,\n  }\n}\n\nfunction mapToHazardClass(cls: string): HazardObjectClass {\n  return COCO_TO_HAZARD_CLASS[cls] ?? \"other\"\n}\n\nexport async function runRealHazardDetection(\n  videoEl: HTMLVideoElement | null\n): Promise<HazardDetection[]> {\n  if (!videoEl) return []\n  await ensureTFReady();\n  await loadModels()\n  \n\n  const detector = getObjectDetector()\n  if (!detector) return []\n\n  try {\n    const predictions = await detector.detect(videoEl)\n    const now = Date.now()\n    const hazards: HazardDetection[] = []\n\n    for (let i = 0; i < predictions.length; i++) {\n      const p = predictions[i]\n      if (!p || p.score < HAZARD_MIN_CONFIDENCE) continue\n\n      hazards.push({\n        id: `${now}-${i}`,\n        objectClass: mapToHazardClass(p.class),\n        confidence: p.score,\n        severity: p.score > 0.8 ? \"critical\" : \"high\",\n        bbox: normalizeBBox(\n          p.bbox,\n          videoEl.videoWidth,\n          videoEl.videoHeight\n        ),\n        timestamp: now,\n      })\n    }\n\n    return hazards\n  } catch (err) {\n    console.error(\"Hazard detection failed:\", err)\n    return []\n  }\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;;;AAWnB;AAeA;AAAA;AAzBA,IAAI,UAAgC;AAEpC,SAAS;IACP,IAAI,CAAC,SAAS;QACZ,UAAU,wKAAQ,IAAI,sCAAsC;IAC9D;IACA,OAAO;AACT;;;AAoBA,qCAAqC;AACrC,MAAM,WAAW;IAAC;IAAI;IAAK;IAAK;IAAK;IAAK;CAAI;AAC9C,MAAM,YAAY;IAAC;IAAK;IAAK;IAAK;IAAK;IAAK;CAAI;AAKhD,SAAS,OAAO,SAAkB;IAChC,IAAI;QACF,8BAA8B;QAC9B,IAAI,CAAC,aAAa,UAAU,MAAM,KAAK,GAAG;YACxC,QAAQ,IAAI,CAAC,uBAAuB;YACpC,OAAO;QACT;QAEA,uDAAuD;QACvD,MAAM,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,GAAG;QAEjC,+BAA+B;QAC/B,MAAM,KAAK,SAAS,IAAI,KAAM,sBAAsB;QACpD,MAAM,KAAK,SAAS,IAAI,KAAM,sBAAsB;QAEpD,sDAAsD;QACtD,MAAM,IAAI,SAAS,IAAI;QAEvB,yBAAyB;QACzB,IAAI,MAAM,GAAG,OAAO;QAEpB,gBAAgB;QAChB,MAAM,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC;QAE9B,+CAA+C;QAC/C,IAAI,MAAM,UAAU,GAAG,OAAO,GAAG;YAC/B,QAAQ,GAAG,CAAC,eAAe,UAAU,GAAG,CAAC,CAAA,IAAK,CAAC;oBAC7C,GAAG,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC;oBAChB,GAAG,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC;gBAClB,CAAC;YAED,QAAQ,GAAG,CAAC,oBAAoB;gBAC9B,IAAI,GAAG,OAAO,CAAC;gBACf,IAAI,GAAG,OAAO,CAAC;gBACf,GAAG,EAAE,OAAO,CAAC;gBACb,KAAK,IAAI,OAAO,CAAC;gBACjB,YAAY,CAAC,MAAM,GAAG,EAAE,OAAO,CAAC,GAAI,qCAAqC;YAC3E;QACF;QAEA,4CAA4C;QAC5C,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,MAAM;IACvC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;IACT;AACF;AAEA,wCAAwC;AACxC,SAAS,SAAS,EAAS,EAAE,EAAS;IACpC,OAAO,KAAK,IAAI,CAAC,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE,KAAK,KAAK,GAAG,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,CAAC,EAAE,EAAE;AACxE;AAEA,oDAAoD;AACpD,MAAM;IACI,SAAmB,EAAE,CAAC;IACtB,KAAa;IAErB,YAAY,OAAe,CAAC,CAAE;QAC5B,IAAI,CAAC,IAAI,GAAG;IACd;IAEA,IAAI,KAAa,EAAU;QACzB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QACjB,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,EAAE;YAClC,IAAI,CAAC,MAAM,CAAC,KAAK;QACnB;QACA,OAAO,IAAI,CAAC,OAAO;IACrB;IAEA,UAAkB;QAChB,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,KAAK,GAAG,OAAO;QACrC,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,IAAM,IAAI,GAAG,KAAK,IAAI,CAAC,MAAM,CAAC,MAAM;IACpE;IAEA,QAAQ;QACN,IAAI,CAAC,MAAM,GAAG,EAAE;IAClB;AACF;AAEA,gDAAgD;AAChD,IAAI,iBAAiB,IAAI,cAAc,IAAK,yCAAyC;AACrF,IAAI,kBAAkB,IAAI,cAAc;AACxC,IAAI,2BAA2B;AAC/B,IAAI,iBAAiB;AAErB,IAAI,WAAqB;AACzB,iDAAiD;AACjD,4DAA4D;AAC5D,MAAM,uBAAuB,MAAO,kCAAkC;AACtE,MAAM,qBAAqB,MAAS,gCAAgC;AACpE,IAAI,aAAa;AACjB,IAAI,gBAAgB,KAAK,GAAG;AAC5B,IAAI,eAAe,KAAK,GAAG;AAE3B,sDAAsD;AACtD,IAAI,gBAAgB;AACpB,MAAM,qBAAqB,GAAI,mCAAmC;AAElE,cAAc;AACd,MAAM,QAAQ;IACZ,aAAa;IACb,cAAc;IACd,YAAY;IACZ,gBAAgB;IAChB,YAAY;IACZ,YAAY;AACd;AAEO,eAAe,2BACpB,OAAgC;IAEhC,IAAI,CAAC,WAAW,QAAQ,UAAU,GAAG,GAAG,OAAO;IAE/C,MAAM;IACN,MAAM,IAAA,qIAAoB;IAE1B,MAAM,QAAQ,IAAA,iIAAgB;IAC9B,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,4HAAW,EAAC;QAClC,IAAI,CAAC,WAAW,QAAQ,MAAM,GAAG,GAAG,OAAO;QAE3C,4CAA4C;QAC5C,MAAM,CAAC,iBAAiB,iBAAiB,GAAG;QAE5C,IAAI;YACF,qCAAqC;YACrC,QAAQ,KAAK,CAAC,sBAAsB;gBAClC,WAAW;oBACT,OAAO,gBAAgB,KAAK;oBAC5B,OAAO,gBAAgB,KAAK;oBAC5B,MAAM,gBAAgB,IAAI;oBAC1B,MAAM,gBAAgB,IAAI;oBAC1B,YAAY,gBAAgB,UAAU;gBACxC;gBACA,YAAY;oBACV,OAAO,iBAAiB,KAAK;oBAC7B,OAAO,iBAAiB,KAAK;oBAC7B,MAAM,iBAAiB,IAAI;oBAC3B,MAAM,iBAAiB,IAAI;oBAC3B,YAAY,iBAAiB,UAAU;gBACzC;YACF;YAEA,8BAA8B;YAC9B,MAAM,gBAAgB,MAAM,gBAAgB,KAAK;YACjD,MAAM,iBAAiB,MAAM,iBAAiB,SAAS,IAAI,oCAAoC;YAE/F,2BAA2B;YAC3B,MAAM,cAAc,CAAC,KAAU,QAAQ,CAAC;gBACtC,IAAI,UAAU,KAAK,QAAQ,QAAQ,OAAO,QAAQ,UAAU;oBAC1D,IAAI,MAAM,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;oBACrD,IAAI,OAAO,QAAQ,UAAU,OAAO,IAAI,aAAa,CAAC;oBACtD,OAAO;gBACT;gBACA,MAAM,SAAc,CAAC;gBACrB,IAAK,MAAM,OAAO,IAAK;oBACrB,IAAI,MAAM,OAAO,CAAC,GAAG,CAAC,IAAI,GAAG;wBAC3B,MAAM,CAAC,IAAI,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;wBACzC,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,GAAG;4BACvB,MAAM,CAAC,GAAG,IAAI,MAAM,CAAC,CAAC,GAAG,YAAY,GAAG,CAAC,IAAI,CAAC,EAAE,EAAE,QAAQ;wBAC5D;oBACF,OAAO,IAAI,OAAO,GAAG,CAAC,IAAI,KAAK,UAAU;wBACvC,MAAM,CAAC,IAAI,GAAG,YAAY,GAAG,CAAC,IAAI,EAAE,QAAQ;oBAC9C,OAAO;wBACL,MAAM,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI;oBACxB;gBACF;gBACA,OAAO;YACT;YAEA,QAAQ,KAAK,CAAC,uBAAuB;gBACnC,eAAe,MAAM,OAAO,CAAC,iBAAiB,CAAC,MAAM,EAAE,cAAc,MAAM,CAAC,CAAC,CAAC,GAAG,OAAO;gBACxF,gBAAgB,MAAM,OAAO,CAAC,kBAAkB,CAAC,MAAM,EAAE,eAAe,MAAM,CAAC,CAAC,CAAC,GAAG,OAAO;gBAC3F,kBAAkB,YAAY;YAChC;YAEA,yCAAyC;YACzC,gBAAgB,OAAO;YACvB,iBAAiB,OAAO;YAExB,4CAA4C;YAC5C,MAAM,iBAAiB,MAAM,OAAO,CAAC,aAAa,CAAC,EAAE,IACjD,AAAC,aAA4B,CAAC,EAAE,GAChC;YAEJ,qFAAqF;YACrF,yDAAyD;YACzD,IAAI,kBAAkB,KAAK,qDAAqD;YAEhF,gEAAgE;YAChE,IAAI;gBACF,IAAI,MAAM,OAAO,CAAC,iBAAiB;oBACjC,MAAM,YAAY,eAAe,IAAI,CAAC;oBACtC,IAAI,UAAU,MAAM,GAAG,GAAG;wBACxB,MAAM,kBAAkB,KAAK,GAAG,CAAC,OAAO,SAAS,CAAC,EAAE;wBACpD,wDAAwD;wBACxD,IAAI,kBAAkB,KAAK;4BACzB,kBAAkB;wBACpB;oBACF;gBACF;YACF,EAAE,OAAO,GAAG;gBACV,QAAQ,KAAK,CAAC,gDAAgD;YAChE;YAEA,gBAAgB;YAChB,IAAI,MAAM,UAAU,KAAK,OAAO,GAAG;gBACjC,QAAQ,GAAG,CAAC,2BAA2B;oBACrC,OAAO,MAAM,UAAU;oBACvB,iBAAiB,gBAAgB;oBACjC;oBACA,oBAAoB,OAAO;oBAC3B,qBAAqB,MAAM,OAAO,CAAC,kBACjC,CAAC,CAAC,EAAE,eAAe,MAAM,GAAG,MAAM,OAAO,CAAC,cAAc,CAAC,EAAE,IAAI,MAAM,cAAc,CAAC,EAAE,CAAC,MAAM,GAAG,GAAG,CAAC,CAAC,GAAG;gBAC5G;YACF;YAEA,iCAAiC;YACjC,wFAAwF;YACxF,kCAAkC;YAClC,IAAI,CAAC,kBAAkB,eAAe,MAAM,GAAG,MAAM;gBACnD,QAAQ,KAAK,CAAC;gBACd;gBACA,IAAI,gBAAgB,oBAAoB;oBACtC,oDAAoD;oBACpD,eAAe,KAAK;oBACpB,gBAAgB,KAAK;oBACrB,aAAa;oBACb,WAAW;gBACb;gBACA,OAAO;YACT;YAEA,qDAAqD;YACrD,gBAAgB;YAEhB,qEAAqE;YACrE,IAAI,kBAAkB,KAAK;gBACzB,QAAQ,KAAK,CAAC,uDAAuD;YACvE;YAEA,2EAA2E;YAC3E,MAAM,iBAA2C,EAAE;YACnD,IAAK,IAAI,IAAI,GAAG,IAAI,eAAe,MAAM,EAAE,KAAK,EAAG;gBACjD,eAAe,IAAI,CAAC;oBAClB,GAAG,AAAC,cAAc,CAAC,EAAE,GAAc,CAAC,SAAS,cAAc,CAAC;oBAC5D,GAAG,AAAC,cAAc,CAAC,IAAI,EAAE,GAAc,CAAC,SAAS,eAAe,CAAC;gBACnE;YACF;YAEA,qDAAqD;YACrD,MAAM,gBAAgB,SAAS,GAAG,CAAC,CAAA;gBACjC,MAAM,QAAQ,cAAc,CAAC,EAAE,IAAI;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBAC9C,OAAO;oBAAC,MAAM,CAAC;oBAAE,MAAM,CAAC;iBAAC;YAC3B;YAEA,MAAM,iBAAiB,UAAU,GAAG,CAAC,CAAA;gBACnC,MAAM,QAAQ,cAAc,CAAC,EAAE,IAAI;oBAAC,GAAG;oBAAG,GAAG;gBAAC;gBAC9C,OAAO;oBAAC,MAAM,CAAC;oBAAE,MAAM,CAAC;iBAAC;YAC3B;YAEA,8CAA8C;YAC9C,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG,OAAO;YACnC,MAAM,WAAW,KAAK,GAAG,CAAC,GAAG,OAAO;YAEpC,yCAAyC;YACzC,MAAM,aAAa,KAAK,GAAG,CAAC,KAAK,eAAe,GAAG,CAAC;YACpD,MAAM,cAAc,KAAK,GAAG,CAAC,KAAK,gBAAgB,GAAG,CAAC;YACtD,IAAI,SAAS,CAAC,aAAa,WAAW,IAAI;YAE1C,2CAA2C;YAC3C,IAAI,MAAM,UAAU,GAAG,OAAO,GAAG;gBAC/B,QAAQ,GAAG,CAAC,cAAc;oBACxB,OAAO,MAAM,UAAU;oBACvB,SAAS,QAAQ,OAAO,CAAC;oBACzB,UAAU,SAAS,OAAO,CAAC;oBAC3B,YAAY,WAAW,OAAO,CAAC;oBAC/B,aAAa,YAAY,OAAO,CAAC;oBACjC,QAAQ,OAAO,OAAO,CAAC;oBACvB,cAAc;oBACd,YAAY,SAAS;oBACrB,YAAY;wBACV,QAAQ;wBACR,MAAM;oBACR;gBACF;YACF;YAEA,oCAAoC;YACpC,MAAM,WAAW,GAAG;YACpB,MAAM,YAAY,GAAG;YACrB,MAAM,UAAU;YAEhB,iCAAiC;YACjC,IAAI,MAAM,UAAU,GAAG,OAAO,GAAG;gBAC/B,QAAQ,KAAK,CAAC,eAAe;oBAC3B,OAAO,MAAM,UAAU;oBACvB,SAAS,QAAQ,OAAO,CAAC;oBACzB,UAAU,SAAS,OAAO,CAAC;oBAC3B,YAAY,WAAW,OAAO,CAAC;oBAC/B,aAAa,YAAY,OAAO,CAAC;oBACjC,QAAQ,OAAO,OAAO,CAAC;gBACzB;YACF;YAEA,yCAAyC;YACzC,SAAS,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,KAAK;YACrC,MAAM,UAAU,GAAG;YAEnB,iDAAiD;YACjD,MAAM,aAAa,SAAS;YAC5B,MAAM,MAAM,KAAK,GAAG;YAEpB,6EAA6E;YAC7E,MAAM,mBAAmB,uBAAuB,KAAK,mCAAmC;YAExF,IAAI,cAAc,aAAa,QAAQ;gBACrC,6BAA6B;gBAC7B,WAAW;gBACX,iBAAiB;gBACjB,QAAQ,KAAK,CAAC,kBAAkB;oBAC9B,OAAO,MAAM,UAAU;oBACvB,QAAQ,OAAO,OAAO,CAAC;oBACvB,MAAM;gBACR;YACF,OAEK,IAAI,aAAa,aAAa,MAAM,iBAAiB,IAAI;gBAC5D,WAAW;YACb,OAEK,IAAI,CAAC,cAAc,CAAC,aAAa,YAAY,aAAa,SAAS,KAAK,SAAS,kBAAkB;gBACtG,IAAI,aAAa,UAAU;oBACzB,MAAM,gBAAgB,MAAM;oBAC5B,IAAI,gBAAgB,MAAM,gBAAgB,KAAK;wBAC7C;wBACA,QAAQ,KAAK,CAAC,oBAAoB;4BAChC,OAAO,MAAM,UAAU;4BACvB,UAAU;4BACV,OAAO;wBACT;oBACF;gBACF;gBACA,WAAW;YACb;YAEA,2CAA2C;YAC3C,MAAM,qBAAqB,MAAM;YACjC,MAAM,eAAe,aAAa,CAAC,aAAa,IAAI,IAAI,CAAC,GAAG,+BAA+B;YAC3F,MAAM,YAAY,eAAe,IAAK,eAAe,CAAC,qBAAqB,KAAK,IAAK;YAErF,4CAA4C;YAC5C,MAAM,gBAAgB,CAAC,SAAS,GAAG,IAAI,MAAM,6BAA6B;YAC1E,MAAM,YAAY,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,GAAG,gBAAgB;YAE5D,8BAA8B;YAC9B,MAAM,eAAe,YAAY,KAAK,KAAK,GAAG,8BAA8B;YAC5E,MAAM,cAAc,qBAAqB,OAAO,KAAK,GAAG,oCAAoC;YAC5F,MAAM,gBAAgB,KAAK,GAAG,CAAC,aAAa,eAAe,OAAO,KAAK,GAAG,4BAA4B;YAEtG,oCAAoC;YACpC,IAAI,iBAAiB,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,KACxC,YAAY,eAAe,cAAc;YAG3C,6BAA6B;YAC7B,MAAM,WAAW,SAAS,OACV,YAAY,KACZ,qBAAqB,QACrB,KAAK,GAAG,CAAC,aAAa,eAAe;YAErD,gCAAgC;YAChC,IAAI,MAAM,UAAU,GAAG,OAAO,GAAG;gBAC/B,QAAQ,KAAK,CAAC,yBAAyB;oBACrC,OAAO,MAAM,UAAU;oBACvB,SAAS,QAAQ,OAAO,CAAC;oBACzB,UAAU,SAAS,OAAO,CAAC;oBAC3B,QAAQ,OAAO,OAAO,CAAC;oBACvB,WAAW,UAAU,OAAO,CAAC;oBAC7B;oBACA;oBACA;oBACA,gBAAgB,KAAK,KAAK,CAAC;oBAC3B;oBACA,WAAW;wBAAE;wBAAc;oBAAY;oBACvC;gBACF;YACF;YAEA,OAAO;gBACL,gBAAgB,KAAK,KAAK,CAAC;gBAC3B,gBAAgB,WAAW,OAAO,OAAO,CAAC;gBAC1C;gBACA,gBAAgB,WAAW,UAAU,OAAO,CAAC;gBAC7C,SAAS,CAAC,YAAY,iBAAiB;gBACvC,UAAU;gBACV,aAAa;gBACb,SAAS;gBACT,aAAa,KAAK,GAAG;YACvB;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,oCAAoC;YAClD,OAAO;QACT;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,IAAI,CAAC,8BAA8B;QAC3C,OAAO;IACT;AACF;AAEA,mEAAmE;AAEnE,MAAM,wBAAwB;AAE9B,MAAM,uBAA0D;IAC9D,QAAQ;IACR,KAAK;IACL,KAAK;IACL,KAAK;IACL,OAAO;IACP,KAAK;IACL,YAAY;IACZ,SAAS;IACT,OAAO;IACP,OAAO;AACT;AAEA,SAAS,cACP,UAA4C,EAC5C,UAAkB,EAClB,WAAmB;IAEnB,MAAM,CAAC,GAAG,GAAG,GAAG,EAAE,GAAG;IAErB,OAAO;QACL,GAAG,IAAI;QACP,GAAG,IAAI;QACP,OAAO,IAAI;QACX,QAAQ,IAAI;IACd;AACF;AAEA,SAAS,iBAAiB,GAAW;IACnC,OAAO,oBAAoB,CAAC,IAAI,IAAI;AACtC;AAEO,eAAe,uBACpB,OAAgC;IAEhC,IAAI,CAAC,SAAS,OAAO,EAAE;IACvB,MAAM;IACN,MAAM,IAAA,2HAAU;IAGhB,MAAM,WAAW,IAAA,kIAAiB;IAClC,IAAI,CAAC,UAAU,OAAO,EAAE;IAExB,IAAI;QACF,MAAM,cAAc,MAAM,SAAS,MAAM,CAAC;QAC1C,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,UAA6B,EAAE;QAErC,IAAK,IAAI,IAAI,GAAG,IAAI,YAAY,MAAM,EAAE,IAAK;YAC3C,MAAM,IAAI,WAAW,CAAC,EAAE;YACxB,IAAI,CAAC,KAAK,EAAE,KAAK,GAAG,uBAAuB;YAE3C,QAAQ,IAAI,CAAC;gBACX,IAAI,GAAG,IAAI,CAAC,EAAE,GAAG;gBACjB,aAAa,iBAAiB,EAAE,KAAK;gBACrC,YAAY,EAAE,KAAK;gBACnB,UAAU,EAAE,KAAK,GAAG,MAAM,aAAa;gBACvC,MAAM,cACJ,EAAE,IAAI,EACN,QAAQ,UAAU,EAClB,QAAQ,WAAW;gBAErB,WAAW;YACb;QACF;QAEA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 624, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from \"@supabase/ssr\"\n\nexport function createClient() {\n  return createBrowserClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!)\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,iMAAmB;AAC5B"}},
    {"offset": {"line": 638, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/supabase/analytics.ts"],"sourcesContent":["import { createClient } from \"./client\"\r\nimport type { HazardDetection } from \"@/lib/types\"\r\n\r\nconst supabase = createClient()\r\n\r\nasync function getUserId(): Promise<string | null> {\r\n  const { data, error } = await supabase.auth.getUser()\r\n  if (error) {\r\n    console.error(\"Supabase getUser error\", error)\r\n    return null\r\n  }\r\n  return data.user?.id ?? null\r\n}\r\n\r\nexport async function logDrowsinessEvent(args: {\r\n  alertnessScore: number\r\n  ear: number\r\n  blinkFrequency: number\r\n  triggeredAlert: boolean\r\n  sessionId: string | null\r\n}) {\r\n  const userId = await getUserId()\r\n  if (!userId) return\r\n\r\n  const { error } = await supabase.from(\"drowsiness_events\").insert({\r\n    user_id: userId,\r\n    organization_id: null,\r\n    alertness_score: args.alertnessScore,\r\n    eye_aspect_ratio: args.ear,\r\n    blink_frequency: args.blinkFrequency,\r\n    triggered_alert: args.triggeredAlert,\r\n    alert_type: null,\r\n    emergency_contact: null,\r\n    session_id: args.sessionId,\r\n  })\r\n\r\n  if (error) console.error(\"logDrowsinessEvent error\", error)\r\n}\r\n\r\nexport async function logHazardEvents(hazards: HazardDetection[], sessionId: string | null) {\r\n  if (!hazards.length) return\r\n\r\n  const userId = await getUserId()\r\n  if (!userId) return\r\n\r\n  const rows = hazards.map((h) => ({\r\n    user_id: userId,\r\n    organization_id: null,\r\n    object_class: h.objectClass,\r\n    confidence: h.confidence,\r\n    severity_level: h.severity,\r\n    bbox: h.bbox,\r\n    frame_source: \"webcam\",\r\n    frame_url: null,\r\n    location_lat: null,\r\n    location_lng: null,\r\n    highway_name: null,\r\n    session_id: sessionId,\r\n  }))\r\n\r\n  const { error } = await supabase.from(\"hazard_detections\").insert(rows)\r\n  if (error) console.error(\"logHazardEvents error\", error)\r\n}\r\n\r\n// ---------------- VASE session lifecycle ----------------\r\n\r\nexport async function startVaseSession(): Promise<string | null> {\r\n  const userId = await getUserId()\r\n  if (!userId) return null\r\n\r\n  const { data, error } = await supabase\r\n    .from(\"vase_sessions\")\r\n    .insert({\r\n      user_id: userId,\r\n      organization_id: null,\r\n      start_time: new Date().toISOString(),\r\n      total_alerts: 0,\r\n      hazards_detected: 0,\r\n      emergency_contact_notified: false,\r\n    })\r\n    .select(\"id\")\r\n    .single()\r\n\r\n  if (error) {\r\n    console.error(\"startVaseSession error\", error)\r\n    return null\r\n  }\r\n\r\n  return data?.id ?? null\r\n}\r\n\r\nexport async function endVaseSession(args: {\r\n  sessionId: string\r\n  startTime: Date | null\r\n  totalAlerts: number\r\n  averageAlertness: number | null\r\n  hazardsDetected: number\r\n  emergencyContactNotified: boolean\r\n}) {\r\n  if (!args.sessionId) return\r\n\r\n  const end = new Date()\r\n  const durationSeconds = args.startTime ? Math.round((end.getTime() - args.startTime.getTime()) / 1000) : null\r\n\r\n  const { error } = await supabase\r\n    .from(\"vase_sessions\")\r\n    .update({\r\n      end_time: end.toISOString(),\r\n      duration_seconds: durationSeconds,\r\n      total_alerts: args.totalAlerts,\r\n      average_alertness: args.averageAlertness,\r\n      hazards_detected: args.hazardsDetected,\r\n      emergency_contact_notified: args.emergencyContactNotified,\r\n    })\r\n    .eq(\"id\", args.sessionId)\r\n\r\n  if (error) console.error(\"endVaseSession error\", error)\r\n}\r\n\r\n// Log a high-level VASE alert into the alerts table so it appears in Recent Alerts.\r\nexport async function logVaseAlert(args: {\r\n  sessionId: string | null\r\n  severity: \"critical\" | \"high\" | \"medium\" | \"low\"\r\n  title: string\r\n  description: string | null\r\n}) {\r\n  const { error } = await supabase.from(\"alerts\").insert({\r\n    detection_id: null,\r\n    camera_id: null,\r\n    organization_id: null,\r\n    severity: args.severity,\r\n    status: \"active\",\r\n    title: args.title,\r\n    description: args.description,\r\n  })\r\n\r\n  if (error) console.error(\"logVaseAlert error\", error)\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 745, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,sKAAO,EAAC,IAAA,6IAAI,EAAC;AACtB"}},
    {"offset": {"line": 760, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive:\n          'bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50',\n        secondary:\n          'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost:\n          'hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-9 px-4 py-2 has-[>svg]:px-3',\n        sm: 'h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5',\n        lg: 'h-10 rounded-md px-6 has-[>svg]:px-4',\n        icon: 'size-9',\n        'icon-sm': 'size-8',\n        'icon-lg': 'size-10',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  },\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'button'> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : 'button'\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAE9B,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 819, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Card({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card\"\n      className={cn(\n        'bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardHeader({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-header\"\n      className={cn(\n        '@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardTitle({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-title\"\n      className={cn('leading-none font-semibold', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardDescription({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-description\"\n      className={cn('text-muted-foreground text-sm', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardAction({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-action\"\n      className={cn(\n        'col-start-2 row-span-2 row-start-1 self-start justify-self-end',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction CardContent({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-content\"\n      className={cn('px-6', className)}\n      {...props}\n    />\n  )\n}\n\nfunction CardFooter({ className, ...props }: React.ComponentProps<'div'>) {\n  return (\n    <div\n      data-slot=\"card-footer\"\n      className={cn('flex items-center px-6 [.border-t]:pt-6', className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardAction,\n  CardDescription,\n  CardContent,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAEA;;;AAEA,SAAS,KAAK,EAAE,SAAS,EAAE,GAAG,OAAoC;IAChE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,qFACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,4JACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,UAAU,EAAE,SAAS,EAAE,GAAG,OAAoC;IACrE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,gBAAgB,EAAE,SAAS,EAAE,GAAG,OAAoC;IAC3E,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,kEACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,YAAY,EAAE,SAAS,EAAE,GAAG,OAAoC;IACvE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,QAAQ;QACrB,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,WAAW,EAAE,SAAS,EAAE,GAAG,OAAoC;IACtE,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,2CAA2C;QACxD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 921, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/switch.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as SwitchPrimitive from '@radix-ui/react-switch'\n\nimport { cn } from '@/lib/utils'\n\nfunction Switch({\n  className,\n  ...props\n}: React.ComponentProps<typeof SwitchPrimitive.Root>) {\n  return (\n    <SwitchPrimitive.Root\n      data-slot=\"switch\"\n      className={cn(\n        'peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    >\n      <SwitchPrimitive.Thumb\n        data-slot=\"switch-thumb\"\n        className={\n          'bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0'\n        }\n      />\n    </SwitchPrimitive.Root>\n  )\n}\n\nexport { Switch }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,OAAO,EACd,SAAS,EACT,GAAG,OAC+C;IAClD,qBACE,8OAAC,0KAAoB;QACnB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,6WACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,2KAAqB;YACpB,aAAU;YACV,WACE;;;;;;;;;;;AAKV"}},
    {"offset": {"line": 956, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/label.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as LabelPrimitive from '@radix-ui/react-label'\n\nimport { cn } from '@/lib/utils'\n\nfunction Label({\n  className,\n  ...props\n}: React.ComponentProps<typeof LabelPrimitive.Root>) {\n  return (\n    <LabelPrimitive.Root\n      data-slot=\"label\"\n      className={cn(\n        'flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,MAAM,EACb,SAAS,EACT,GAAG,OAC8C;IACjD,qBACE,8OAAC,yKAAmB;QAClB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,uNACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 983, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/input.tsx"],"sourcesContent":["import * as React from 'react'\n\nimport { cn } from '@/lib/utils'\n\nfunction Input({ className, type, ...props }: React.ComponentProps<'input'>) {\n  return (\n    <input\n      type={type}\n      data-slot=\"input\"\n      className={cn(\n        'file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm',\n        'focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]',\n        'aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive',\n        className,\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAEA;;;AAEA,SAAS,MAAM,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAsC;IACzE,qBACE,8OAAC;QACC,MAAM;QACN,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,8bACA,iFACA,0GACA;QAED,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1008, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/badge.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst badgeVariants = cva(\n  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',\n  {\n    variants: {\n      variant: {\n        default:\n          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',\n        secondary:\n          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',\n        destructive:\n          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n    },\n  },\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'span'> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'span'\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,uKAAG,EACvB,kZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,wKAAI,GAAG;IAE9B,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 1054, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/progress.tsx"],"sourcesContent":["'use client'\n\nimport * as React from 'react'\nimport * as ProgressPrimitive from '@radix-ui/react-progress'\n\nimport { cn } from '@/lib/utils'\n\nfunction Progress({\n  className,\n  value,\n  ...props\n}: React.ComponentProps<typeof ProgressPrimitive.Root>) {\n  return (\n    <ProgressPrimitive.Root\n      data-slot=\"progress\"\n      className={cn(\n        'bg-primary/20 relative h-2 w-full overflow-hidden rounded-full',\n        className,\n      )}\n      {...props}\n    >\n      <ProgressPrimitive.Indicator\n        data-slot=\"progress-indicator\"\n        className=\"bg-primary h-full w-full flex-1 transition-all\"\n        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n      />\n    </ProgressPrimitive.Root>\n  )\n}\n\nexport { Progress }\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,SAAS,EAChB,SAAS,EACT,KAAK,EACL,GAAG,OACiD;IACpD,qBACE,8OAAC,4KAAsB;QACrB,aAAU;QACV,WAAW,IAAA,kHAAE,EACX,kEACA;QAED,GAAG,KAAK;kBAET,cAAA,8OAAC,iLAA2B;YAC1B,aAAU;YACV,WAAU;YACV,OAAO;gBAAE,WAAW,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,EAAE,CAAC;YAAC;;;;;;;;;;;AAIlE"}},
    {"offset": {"line": 1092, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/components/ui/vision-ai-logo.tsx"],"sourcesContent":["\"use client\"\n\nimport { motion } from \"framer-motion\"\nimport { cn } from \"@/lib/utils\"\n\ninterface VisionAILogoProps {\n  className?: string\n  size?: \"sm\" | \"md\" | \"lg\" | \"xl\"\n  animate?: boolean\n  showText?: boolean\n}\n\nexport function VisionAILogo({ className, size = \"md\", animate = false, showText = true }: VisionAILogoProps) {\n  const sizes = {\n    sm: { icon: 24, text: \"text-lg\" },\n    md: { icon: 32, text: \"text-xl\" },\n    lg: { icon: 48, text: \"text-2xl\" },\n    xl: { icon: 64, text: \"text-3xl\" },\n  }\n\n  const { icon: iconSize, text: textSize } = sizes[size]\n\n  const EyeIcon = (\n    <svg\n      width={iconSize}\n      height={iconSize}\n      viewBox=\"0 0 64 64\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className=\"relative\"\n    >\n      {/* Outer eye shape */}\n      <motion.path\n        d=\"M32 12C18 12 6 32 6 32C6 32 18 52 32 52C46 52 58 32 58 32C58 32 46 12 32 12Z\"\n        stroke=\"url(#eyeGradient)\"\n        strokeWidth=\"3\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        fill=\"none\"\n        initial={animate ? { pathLength: 0 } : { pathLength: 1 }}\n        animate={{ pathLength: 1 }}\n        transition={{ duration: 1.5, ease: \"easeInOut\" }}\n      />\n      {/* Iris */}\n      <motion.circle\n        cx=\"32\"\n        cy=\"32\"\n        r=\"12\"\n        stroke=\"url(#irisGradient)\"\n        strokeWidth=\"2.5\"\n        fill=\"none\"\n        initial={animate ? { scale: 0 } : { scale: 1 }}\n        animate={{ scale: 1 }}\n        transition={{ duration: 0.5, delay: animate ? 0.8 : 0 }}\n      />\n      {/* Pupil */}\n      <motion.circle\n        cx=\"32\"\n        cy=\"32\"\n        r=\"5\"\n        fill=\"url(#pupilGradient)\"\n        initial={animate ? { scale: 0 } : { scale: 1 }}\n        animate={animate ? { scale: [0, 1.2, 1] } : { scale: 1 }}\n        transition={{ duration: 0.6, delay: animate ? 1 : 0 }}\n      />\n      {/* Light reflection */}\n      <motion.circle\n        cx=\"36\"\n        cy=\"28\"\n        r=\"2\"\n        fill=\"white\"\n        opacity={0.8}\n        initial={animate ? { opacity: 0 } : { opacity: 0.8 }}\n        animate={{ opacity: 0.8 }}\n        transition={{ duration: 0.3, delay: animate ? 1.3 : 0 }}\n      />\n      {/* AI scan lines */}\n      <motion.g\n        initial={animate ? { opacity: 0 } : { opacity: 1 }}\n        animate={{ opacity: 1 }}\n        transition={{ duration: 0.5, delay: animate ? 1.5 : 0 }}\n      >\n        <line x1=\"20\" y1=\"32\" x2=\"26\" y2=\"32\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n        <line x1=\"38\" y1=\"32\" x2=\"44\" y2=\"32\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n        <line x1=\"32\" y1=\"20\" x2=\"32\" y2=\"26\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n        <line x1=\"32\" y1=\"38\" x2=\"32\" y2=\"44\" stroke=\"url(#scanGradient)\" strokeWidth=\"1.5\" opacity=\"0.6\" />\n      </motion.g>\n      <defs>\n        <linearGradient id=\"eyeGradient\" x1=\"6\" y1=\"32\" x2=\"58\" y2=\"32\" gradientUnits=\"userSpaceOnUse\">\n          <stop stopColor=\"#4f46e5\" />\n          <stop offset=\"0.5\" stopColor=\"#06b6d4\" />\n          <stop offset=\"1\" stopColor=\"#22c55e\" />\n        </linearGradient>\n        <linearGradient id=\"irisGradient\" x1=\"20\" y1=\"32\" x2=\"44\" y2=\"32\" gradientUnits=\"userSpaceOnUse\">\n          <stop stopColor=\"#4f46e5\" />\n          <stop offset=\"1\" stopColor=\"#06b6d4\" />\n        </linearGradient>\n        <radialGradient id=\"pupilGradient\" cx=\"32\" cy=\"32\" r=\"5\" gradientUnits=\"userSpaceOnUse\">\n          <stop stopColor=\"#1e1b4b\" />\n          <stop offset=\"1\" stopColor=\"#4f46e5\" />\n        </radialGradient>\n        <linearGradient id=\"scanGradient\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"0\" gradientUnits=\"objectBoundingBox\">\n          <stop stopColor=\"#22c55e\" />\n          <stop offset=\"1\" stopColor=\"#06b6d4\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  )\n\n  return (\n    <div className={cn(\"flex items-center gap-2\", className)}>\n      <div className=\"relative\">\n        {EyeIcon}\n        {animate && (\n          <motion.div\n            className=\"absolute inset-0 blur-xl bg-primary/30 rounded-full\"\n            initial={{ opacity: 0 }}\n            animate={{ opacity: [0, 0.5, 0.3] }}\n            transition={{ duration: 2, delay: 1 }}\n          />\n        )}\n      </div>\n      {showText && (\n        <motion.span\n          className={cn(\"font-bold tracking-tight\", textSize)}\n          initial={animate ? { opacity: 0, x: -10 } : { opacity: 1 }}\n          animate={{ opacity: 1, x: 0 }}\n          transition={{ duration: 0.5, delay: animate ? 0.5 : 0 }}\n        >\n          Vision-AI\n        </motion.span>\n      )}\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1506, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/lib/dvse/engine.ts"],"sourcesContent":["// Vision-AI Safety Engine (VASE) - Core Engine Logic\n\nimport type { DVSERiskAssessment, DrowsinessMetrics, HazardDetection, SafetyStatus, AlertnessWindow } from \"@/lib/types\"\n\n// Configuration constants\nconst CONFIG = {\n  ALERTNESS_THRESHOLD: 50, // Below this triggers alert\n  HAZARD_CONFIDENCE_THRESHOLD: 0.5, // Minimum confidence for hazard alerts\n  RISK_WEIGHTS: {\n    drowsiness: 0.6, // Drowsiness contributes 60% to risk\n    hazard: 0.4, // Hazard contributes 40% to risk\n  },\n  ALERTNESS_WINDOW_SIZE: 20, // Rolling window for smoothing (10 seconds at 2 fps)\n  CRITICAL_HAZARDS: [\"cow\", \"buffalo\", \"elephant\", \"wrong_way_vehicle\", \"pedestrian\", \"broken_vehicle\"],\n  HIGH_RISK_THRESHOLD: 70,\n  CAUTION_THRESHOLD: 40,\n}\n\n// Create rolling window for smoothed alertness\nexport function createAlertnessWindow(size: number = CONFIG.ALERTNESS_WINDOW_SIZE): AlertnessWindow {\n  return {\n    samples: [],\n    windowSize: size,\n    average: 100, // Start optimistic\n  }\n}\n\n// Update rolling window with new alertness sample\nexport function updateAlertnessWindow(window: AlertnessWindow, newSample: number): AlertnessWindow {\n  const newSamples = [...window.samples, newSample]\n  if (newSamples.length > window.windowSize) {\n    newSamples.shift()\n  }\n  const average = newSamples.reduce((a, b) => a + b, 0) / newSamples.length\n  return {\n    ...window,\n    samples: newSamples,\n    average,\n  }\n}\n\n// Calculate Eye Aspect Ratio (EAR) from landmarks\nexport function calculateEAR(eyePoints: { x: number; y: number }[]): number {\n  if (eyePoints.length < 6) return 0.3 // Default open\n\n  // Vertical distances\n  const v1 = Math.sqrt(Math.pow(eyePoints[1].x - eyePoints[5].x, 2) + Math.pow(eyePoints[1].y - eyePoints[5].y, 2))\n  const v2 = Math.sqrt(Math.pow(eyePoints[2].x - eyePoints[4].x, 2) + Math.pow(eyePoints[2].y - eyePoints[4].y, 2))\n\n  // Horizontal distance\n  const h = Math.sqrt(Math.pow(eyePoints[0].x - eyePoints[3].x, 2) + Math.pow(eyePoints[0].y - eyePoints[3].y, 2))\n\n  if (h === 0) return 0.3\n  return (v1 + v2) / (2.0 * h)\n}\n\n// Convert EAR to alertness score (0-100)\nexport function earToAlertness(ear: number): number {\n  // EAR typically ranges from 0.15 (closed) to 0.35 (open)\n  const minEAR = 0.15\n  const maxEAR = 0.35\n  const normalized = Math.max(0, Math.min(1, (ear - minEAR) / (maxEAR - minEAR)))\n  return Math.round(normalized * 100)\n}\n\n// Get hazard severity based on class and confidence\nexport function getHazardSeverity(objectClass: string, confidence: number): \"critical\" | \"high\" | \"medium\" | \"low\" {\n  const isCriticalClass = CONFIG.CRITICAL_HAZARDS.includes(objectClass)\n\n  if (isCriticalClass && confidence > 0.8) return \"critical\"\n  if (isCriticalClass && confidence > 0.6) return \"high\"\n  if (confidence > 0.8) return \"high\"\n  if (confidence > 0.6) return \"medium\"\n  return \"low\"\n}\n\n// Calculate hazard risk score from detections\nexport function calculateHazardRisk(hazards: HazardDetection[]): number {\n  if (hazards.length === 0) return 0\n\n  let maxRisk = 0\n  for (const hazard of hazards) {\n    let risk = hazard.confidence * 100\n\n    // Boost risk for critical hazards\n    if (CONFIG.CRITICAL_HAZARDS.includes(hazard.objectClass)) {\n      risk = Math.min(100, risk * 1.3)\n    }\n\n    // Severity multiplier\n    const severityMultiplier = {\n      critical: 1.0,\n      high: 0.8,\n      medium: 0.5,\n      low: 0.3,\n    }\n    risk *= severityMultiplier[hazard.severity]\n\n    maxRisk = Math.max(maxRisk, risk)\n  }\n\n  return Math.round(maxRisk)\n}\n\n// Main VASE risk assessment function\nexport function assessRisk(\n  drowsiness: DrowsinessMetrics | null,\n  hazards: HazardDetection[],\n  smoothedAlertness: number,\n): DVSERiskAssessment {\n  // Calculate individual risks\n  const alertnessRisk = drowsiness ? Math.max(0, 100 - smoothedAlertness) : 0\n  const hazardRisk = calculateHazardRisk(hazards)\n\n  // Combined risk score (weighted)\n  const riskScore = Math.round(alertnessRisk * CONFIG.RISK_WEIGHTS.drowsiness + hazardRisk * CONFIG.RISK_WEIGHTS.hazard)\n\n  // Determine overall status\n  let overallStatus: SafetyStatus = \"safe\"\n  if (riskScore >= CONFIG.HIGH_RISK_THRESHOLD) {\n    overallStatus = \"high-risk\"\n  } else if (riskScore >= CONFIG.CAUTION_THRESHOLD) {\n    overallStatus = \"caution\"\n  }\n\n  // Determine if alert should trigger\n  const shouldAlert =\n    smoothedAlertness < CONFIG.ALERTNESS_THRESHOLD ||\n    hazards.some((h) => h.severity === \"critical\" || h.severity === \"high\")\n\n  // Generate alert message\n  let alertMessage: string | null = null\n  if (shouldAlert) {\n    if (smoothedAlertness < CONFIG.ALERTNESS_THRESHOLD && hazards.length > 0) {\n      alertMessage = `DANGER: Drowsy driving detected + ${hazards[0].objectClass} on road!`\n    } else if (smoothedAlertness < CONFIG.ALERTNESS_THRESHOLD) {\n      alertMessage = \"ALERT: Drowsiness detected - Please take a break!\"\n    } else if (hazards.length > 0) {\n      const criticalHazard = hazards.find((h) => h.severity === \"critical\")\n      if (criticalHazard) {\n        alertMessage = `DANGER: ${criticalHazard.objectClass.replace(\"_\", \" \")} detected ahead!`\n      } else {\n        alertMessage = `WARNING: ${hazards[0].objectClass.replace(\"_\", \" \")} detected on road`\n      }\n    }\n  }\n\n  return {\n    overallStatus,\n    riskScore,\n    alertnessRisk,\n    hazardRisk,\n    timestamp: Date.now(),\n    shouldAlert,\n    alertMessage,\n  }\n}\n\n// Get status color for UI\nexport function getStatusColor(status: SafetyStatus): string {\n  switch (status) {\n    case \"safe\":\n      return \"text-success\"\n    case \"caution\":\n      return \"text-warning\"\n    case \"high-risk\":\n      return \"text-destructive\"\n  }\n}\n\nexport function getStatusBgColor(status: SafetyStatus): string {\n  switch (status) {\n    case \"safe\":\n      return \"bg-success\"\n    case \"caution\":\n      return \"bg-warning\"\n    case \"high-risk\":\n      return \"bg-destructive\"\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1681, "column": 0}, "map": {"version":3,"sources":["file:///C:/Projects/Vision-AI/app/dualvision/page.tsx"],"sourcesContent":["\"use client\"\n// new imports - add at top of file\nimport { loadModels } from \"@/lib/models\"\nimport { runRealDrowsinessDetection, runRealHazardDetection } from \"@/lib/detection\"\nimport { logDrowsinessEvent, logHazardEvents, startVaseSession, endVaseSession, logVaseAlert } from \"@/lib/supabase/analytics\"\nimport { useState, useRef, useCallback, useEffect } from \"react\"\nimport { motion, AnimatePresence } from \"framer-motion\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Switch } from \"@/components/ui/switch\"\nimport { Label } from \"@/components/ui/label\"\nimport { Input } from \"@/components/ui/input\"\nimport { Badge } from \"@/components/ui/badge\"\nimport { Progress } from \"@/components/ui/progress\"\nimport {\n  Eye,\n  Video,\n  VideoOff,\n  Volume2,\n  VolumeX,\n  AlertTriangle,\n  Phone,\n  ArrowLeft,\n  Shield,\n  Bell,\n  Camera,\n  Gauge,\n} from \"lucide-react\"\nimport Link from \"next/link\"\nimport { VisionAILogo } from \"@/components/ui/vision-ai-logo\"\nimport type { DVSERiskAssessment, DrowsinessMetrics, HazardDetection, SafetyStatus, AlertnessWindow, HazardObjectClass } from \"@/lib/types\"\nimport {\n  assessRisk,\n  createAlertnessWindow,\n  updateAlertnessWindow,\n  getStatusColor,\n} from \"@/lib/dvse/engine\"\n\n// Hazard class labels\nconst hazardLabels: Record<string, string> = {\n  cow: \"Cow\",\n  dog: \"Dog\",\n  buffalo: \"Buffalo\",\n  pothole: \"Pothole\",\n  debris: \"Debris\",\n  pedestrian: \"Pedestrian\",\n  broken_vehicle: \"Broken Vehicle\",\n  fallen_tree: \"Fallen Tree\",\n}\n\nexport default function DualVisionDemo() {\n  // Camera refs\n  const frontVideoRef = useRef<HTMLVideoElement>(null)\n  const rearVideoRef = useRef<HTMLVideoElement>(null)\n  const frontCanvasRef = useRef<HTMLCanvasElement>(null)\n  const rearCanvasRef = useRef<HTMLCanvasElement>(null)\n\n  // State\n  const [frontCameraActive, setFrontCameraActive] = useState(false)\n  const [rearCameraActive, setRearCameraActive] = useState(false)\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [soundEnabled, setSoundEnabled] = useState(true)\n  const [emergencyContact, setEmergencyContact] = useState(\"\")\n\n  // VASE State\n  const [drowsiness, setDrowsiness] = useState<DrowsinessMetrics | null>(null)\n  const [hazards, setHazards] = useState<HazardDetection[]>([])\n  const [riskAssessment, setRiskAssessment] = useState<DVSERiskAssessment>({\n    overallStatus: \"safe\",\n    riskScore: 0,\n    alertnessRisk: 0,\n    hazardRisk: 0,\n    timestamp: Date.now(),\n    shouldAlert: false,\n    alertMessage: null,\n  })\n  const [alertnessWindow, setAlertnessWindow] = useState<AlertnessWindow>(() => createAlertnessWindow())\n  const [showAlert, setShowAlert] = useState(false)\n  const [alertHistory, setAlertHistory] = useState<{ time: Date; message: string; status: SafetyStatus }[]>([])\n\n  const audioRef = useRef<HTMLAudioElement | null>(null)\n  const sessionStartRef = useRef<Date | null>(null)\n  const sessionIdRef = useRef<string | null>(null)\n  const alertCountRef = useRef(0)\n  const hazardCountRef = useRef(0)\n  const alertnessSumRef = useRef(0)\n  const alertnessSamplesRef = useRef(0)\n\n  // // Simulate drowsiness detection (in production, use TensorFlow.js face-landmarks)\n  // const simulateDrowsinessDetection = useCallback((): DrowsinessMetrics => {\n  //   const baseAlertness = 75\n  //   const timeVariation = Math.sin(Date.now() / 15000) * 25\n  //   const randomVariation = (Math.random() - 0.5) * 15\n  //   const alertnessScore = Math.max(0, Math.min(100, baseAlertness + timeVariation + randomVariation))\n\n  //   return {\n  //     alertnessScore: Math.round(alertnessScore),\n  //     eyeAspectRatio: 0.2 + (alertnessScore / 100) * 0.15,\n  //     blinkCount: Math.floor(Math.random() * 20) + 10,\n  //     blinkFrequency: Math.floor(Math.random() * 10) + 12,\n  //     isAlert: alertnessScore >= 50,\n  //     headTilt: (Math.random() - 0.5) * 20,\n  //     lookingAway: Math.random() > 0.9,\n  //     yawning: Math.random() > 0.95,\n  //     lastUpdated: Date.now(),\n  //   }\n  // }, [])\n\n  // // Simulate hazard detection (in production, use YOLO model)\n  // const simulateHazardDetection = useCallback((): HazardDetection[] => {\n  //   if (Math.random() > 0.7) return []\n\n  //   const classes: HazardObjectClass[] = [\"cow\", \"pothole\", \"debris\", \"pedestrian\", \"dog\"]\n  //   const detectedClass: HazardObjectClass = classes[Math.floor(Math.random() * classes.length)]\n  //   const confidence = 0.6 + Math.random() * 0.35\n\n  //   const isCritical = [\"cow\", \"buffalo\", \"pedestrian\"].includes(detectedClass)\n  //   let severity: HazardDetection[\"severity\"] = \"low\"\n  //   if (isCritical && confidence > 0.8) severity = \"critical\"\n  //   else if (isCritical && confidence > 0.6) severity = \"high\"\n  //   else if (confidence > 0.8) severity = \"high\"\n  //   else if (confidence > 0.6) severity = \"medium\"\n\n  //   return [\n  //     {\n  //       id: `${Date.now()}`,\n  //       objectClass: detectedClass,\n  //       confidence,\n  //       severity,\n  //       bbox: {\n  //         x: 0.2 + Math.random() * 0.4,\n  //         y: 0.3 + Math.random() * 0.3,\n  //         width: 0.15 + Math.random() * 0.1,\n  //         height: 0.2 + Math.random() * 0.1,\n  //       },\n  //       timestamp: Date.now(),\n  //     },\n  //   ]\n  // }, [])\n\n  // Main detection loop\n  const runDetection = useCallback(async () => {\n  // Drowsiness (front)\n  let newDrowsiness = null\n  if (frontCameraActive && frontVideoRef.current) {\n    try {\n      const dr = await runRealDrowsinessDetection(frontVideoRef.current)\n      if (dr) {\n        newDrowsiness = dr\n        setDrowsiness(dr)\n        const newWindow = updateAlertnessWindow(alertnessWindow, dr.alertnessScore)\n        setAlertnessWindow(newWindow)\n      }\n    } catch (err) {\n      console.error(\"Real drowsiness detection error:\", err)\n    }\n  } else {\n    // fallback: keep old rolling avg if no front camera\n    newDrowsiness = drowsiness\n  }\n\n  // Hazards (rear)\n  let newHazards: any[] = []\n  if (rearCameraActive && rearVideoRef.current) {\n    try {\n      newHazards = await runRealHazardDetection(rearVideoRef.current)\n      setHazards(newHazards)\n    } catch (err) {\n      console.error(\"Real hazard detection error:\", err)\n      newHazards = []\n    }\n  } else {\n    newHazards = []\n    setHazards([])\n  }\n\n  // If models didn't run (camera off), skip assessment\n  const smoothed = alertnessWindow.average\n  const assessment = assessRisk(newDrowsiness, newHazards, smoothed)\n  setRiskAssessment(assessment)\n\n  // accumulate stats for current session\n  if (newDrowsiness) {\n    alertnessSumRef.current += newDrowsiness.alertnessScore\n    alertnessSamplesRef.current += 1\n  }\n  hazardCountRef.current += newHazards.length\n\n  // Persist tick data to Supabase (per-tick logging)\n  if (newDrowsiness) {\n    logDrowsinessEvent({\n      alertnessScore: newDrowsiness.alertnessScore,\n      ear: newDrowsiness.eyeAspectRatio,\n      blinkFrequency: newDrowsiness.blinkFrequency,\n      triggeredAlert: assessment.shouldAlert,\n      sessionId: sessionIdRef.current,\n    })\n  }\n\n  if (newHazards.length > 0) {\n    logHazardEvents(newHazards, sessionIdRef.current)\n  }\n\n  // handle alerts same as before\n  if (assessment.shouldAlert && !showAlert) {\n    alertCountRef.current += 1\n    setShowAlert(true)\n    setAlertHistory((prev) => [\n      ...prev.slice(-9),\n      { time: new Date(), message: assessment.alertMessage || \"Alert\", status: assessment.overallStatus },\n    ])\n    if (soundEnabled && audioRef.current) audioRef.current.play().catch(() => {})\n    const severity =\n      assessment.overallStatus === \"high-risk\"\n        ? \"critical\"\n        : assessment.overallStatus === \"caution\"\n          ? \"medium\"\n          : \"low\"\n\n    // Log a high-level VASE alert for the dashboard\n    logVaseAlert({\n      sessionId: sessionIdRef.current,\n      severity,\n      title: assessment.alertMessage || \"Vision-AI Safety Alert\",\n      description: assessment.alertMessage,\n    })\n\n    // Auto-send email on drowsiness < 50 or high-severity highway hazards\n    const alertnessThreshold = 50\n    const highSeverityHazards = [\"cow\", \"buffalo\", \"deer\", \"elk\", \"bear\", \"fallen_tree\", \"pothole\", \"debris\"]\n    const hasHighSeverityHazard = newHazards.some(h => highSeverityHazards.includes(h.objectClass))\n    const drowsinessBelowThreshold = newDrowsiness && newDrowsiness.alertnessScore < alertnessThreshold\n\n    if (drowsinessBelowThreshold || hasHighSeverityHazard) {\n      const contact = emergencyContact.trim() || undefined\n      let message = \"\"\n      if (drowsinessBelowThreshold && hasHighSeverityHazard) {\n        message = `Drowsiness detected (${newDrowsiness!.alertnessScore}%) and high-severity hazards detected (${newHazards.filter(h => highSeverityHazards.includes(h.objectClass)).map(h => h.objectClass).join(\", \")}). Please check on the driver immediately.`\n      } else if (drowsinessBelowThreshold) {\n        message = `Drowsiness detected (${newDrowsiness!.alertnessScore}%). Please check on the driver immediately.`\n      } else if (hasHighSeverityHazard) {\n        message = `High-severity hazards detected: ${newHazards.filter(h => highSeverityHazards.includes(h.objectClass)).map(h => h.objectClass).join(\", \")}). Please advise the driver immediately.`\n      }\n\n      fetch(\"/api/email-alert\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          subject: \"Vision-AI Safety Alert\",\n          message,\n          to: contact,\n        }),\n      }).catch(() => {\n        // best-effort; avoid breaking UI if email fails\n      })\n    }\n    setTimeout(() => setShowAlert(false), 5000)\n  }\n\n  // draw boxes on rear canvas if detection present\n  drawDetections(newHazards)\n}, [frontCameraActive, rearCameraActive, alertnessWindow, drowsiness, showAlert, soundEnabled])\n\n  // Draw bounding boxes on rear camera canvas\n  const drawDetections = (detections: HazardDetection[]) => {\n    const canvas = rearCanvasRef.current\n    const video = rearVideoRef.current\n    if (!canvas || !video) return\n\n    const ctx = canvas.getContext(\"2d\")\n    if (!ctx) return\n\n    canvas.width = video.videoWidth || 640\n    canvas.height = video.videoHeight || 480\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\n\n    detections.forEach((det) => {\n      const x = det.bbox.x * canvas.width\n      const y = det.bbox.y * canvas.height\n      const w = det.bbox.width * canvas.width\n      const h = det.bbox.height * canvas.height\n\n      // Color based on severity\n      const colors = {\n        critical: \"#ef4444\",\n        high: \"#f59e0b\",\n        medium: \"#06b6d4\",\n        low: \"#22c55e\",\n      } as const\n      ctx.strokeStyle = colors[det.severity]\n      ctx.lineWidth = 3\n      ctx.strokeRect(x, y, w, h)\n\n      // Label\n      const label = `${hazardLabels[det.objectClass] || det.objectClass} ${Math.round(det.confidence * 100)}%`\n      ctx.fillStyle = ctx.strokeStyle\n      const textWidth = ctx.measureText(label).width\n      ctx.fillRect(x, y - 24, textWidth + 12, 24)\n      ctx.fillStyle = \"#fff\"\n      ctx.font = \"14px sans-serif\"\n      ctx.fillText(label, x + 6, y - 7)\n    })\n  }\n\n  // Toggle front camera (for drowsiness)\n  const toggleFrontCamera = async () => {\n    if (frontCameraActive) {\n      const stream = frontVideoRef.current?.srcObject as MediaStream\n      stream?.getTracks().forEach((track) => track.stop())\n      if (frontVideoRef.current) frontVideoRef.current.srcObject = null\n      setFrontCameraActive(false)\n    } else {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: { facingMode: \"user\", width: 640, height: 480 },\n        })\n        if (frontVideoRef.current) {\n          frontVideoRef.current.srcObject = stream\n          setFrontCameraActive(true)\n          if (!sessionStartRef.current) sessionStartRef.current = new Date()\n        }\n      } catch (err) {\n        console.error(\"Front camera access failed:\", err)\n      }\n    }\n  }\n\n  // Toggle rear camera (for hazards)\n  const toggleRearCamera = async () => {\n    if (rearCameraActive) {\n      const stream = rearVideoRef.current?.srcObject as MediaStream\n      stream?.getTracks().forEach((track) => track.stop())\n      if (rearVideoRef.current) rearVideoRef.current.srcObject = null\n      setRearCameraActive(false)\n    } else {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: { facingMode: \"environment\", width: 1280, height: 720 },\n        })\n        if (rearVideoRef.current) {\n          rearVideoRef.current.srcObject = stream\n          setRearCameraActive(true)\n          if (!sessionStartRef.current) sessionStartRef.current = new Date()\n        }\n      } catch (err) {\n        console.error(\"Rear camera access failed:\", err)\n      }\n    }\n  }\n\n  // Toggle processing\n  const toggleProcessing = () => {\n    if (!isProcessing) {\n      // starting a new VASE session\n      startVaseSession().then((id) => {\n        sessionIdRef.current = id\n        alertCountRef.current = 0\n        hazardCountRef.current = 0\n        alertnessSumRef.current = 0\n        alertnessSamplesRef.current = 0\n      })\n    } else {\n      // stopping session: finalize stats\n      if (sessionIdRef.current) {\n        const averageAlertness =\n          alertnessSamplesRef.current > 0 ? alertnessSumRef.current / alertnessSamplesRef.current : null\n\n        endVaseSession({\n          sessionId: sessionIdRef.current,\n          startTime: sessionStartRef.current,\n          totalAlerts: alertCountRef.current,\n          averageAlertness,\n          hazardsDetected: hazardCountRef.current,\n          emergencyContactNotified: false,\n        })\n      }\n      sessionIdRef.current = null\n    }\n    setIsProcessing(!isProcessing)\n  }\n\n  // Run detection loop when processing\n  useEffect(() => {\n  if (!isProcessing) return\n\n  let active = true\n\n  const loop = async () => {\n    while (active && isProcessing) {\n      await runDetection() // wait for model to finish\n      await new Promise((r) => setTimeout(r, 500)) // pause 500ms\n    }\n  }\n\n  loop()\n\n  return () => {\n    active = false\n  }\n}, [isProcessing, runDetection])\n  // Load TensorFlow models on client mount only\nuseEffect(() => {\n  if (typeof window === \"undefined\") return // prevent SSR failures\n\n  let mounted = true\n  ;(async () => {\n    try {\n      console.log(\"Loading TFJS models...\")\n      await loadModels()\n      if (mounted) console.log(\"Models ready \")\n    } catch (err) {\n      console.error(\"Error loading models:\", err)\n    }\n  })()\n\n  return () => {\n    mounted = false\n  }\n}, [])\n\n  // Get status display\n  const getStatusDisplay = (status: SafetyStatus) => {\n    switch (status) {\n      case \"safe\":\n        return { label: \"SAFE\", bg: \"bg-success\", text: \"text-success\" }\n      case \"caution\":\n        return { label: \"CAUTION\", bg: \"bg-warning\", text: \"text-warning\" }\n      case \"high-risk\":\n        return { label: \"HIGH RISK\", bg: \"bg-destructive\", text: \"text-destructive\" }\n    }\n  }\n\n  const statusDisplay = getStatusDisplay(riskAssessment.overallStatus)\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Audio for alerts */}\n      <audio ref={audioRef} preload=\"auto\">\n        <source\n          src=\"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleU9PT46xvqF0Q0VBetjD2aJtOUJdxN7j4Z2CUUpBfbG8rH1LS0ttyuLx8qqIU0tBfaq6rnlKSEtzz+j2+qqJVEpAf6m5r3pJR0p40O3++q2MVUY8g6y5r31KSEp40vD//7GOVkY7hK66sH5KSUl41PL//7KQWEI4h6+7sYBLSkh41vT//7WSWUE2iLC8soFMS0h41/X//7iTW0E1irC8s4JNTEh52Pb//7qUXEAzjLG9tIROTUd52ff//7yVXkAyi7K+tYVPTkd52vj//76XX0Axi7O/toZQT0Z63Pn//8CYYEA\"\n          type=\"audio/wav\"\n        />\n      </audio>\n\n      {/* Header */}\n      <header className=\"border-b border-border bg-card/50 backdrop-blur sticky top-0 z-40\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center gap-4\">\n              <Link\n                href=\"/\"\n                className=\"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors\"\n              >\n                <ArrowLeft className=\"h-4 w-4\" />\n                <span className=\"hidden sm:inline\">Back</span>\n              </Link>\n              <VisionAILogo size=\"sm\" />\n            </div>\n            <Badge variant=\"secondary\" className=\"gap-1\">\n              <Shield className=\"h-3 w-3\" />\n              Vision-AI Safety Engine (VASE)\n            </Badge>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Risk Assessment Banner */}\n        <motion.div\n          className={`mb-6 p-4 rounded-xl border ${\n            riskAssessment.overallStatus === \"high-risk\"\n              ? \"border-destructive bg-destructive/10\"\n              : riskAssessment.overallStatus === \"caution\"\n                ? \"border-warning bg-warning/10\"\n                : \"border-success bg-success/10\"\n          }`}\n          animate={riskAssessment.shouldAlert ? { scale: [1, 1.02, 1] } : {}}\n          transition={{ duration: 0.5, repeat: riskAssessment.shouldAlert ? Number.POSITIVE_INFINITY : 0 }}\n        >\n          <div className=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-4\">\n              <div className={`h-16 w-16 rounded-full flex items-center justify-center ${statusDisplay.bg}`}>\n                <Shield className=\"h-8 w-8 text-white\" />\n              </div>\n              <div>\n                <div className={`text-2xl font-bold ${statusDisplay.text}`}>{statusDisplay.label}</div>\n                <div className=\"text-sm text-muted-foreground\">\n                  Risk Score: {riskAssessment.riskScore}% | Alertness Risk: {Math.round(riskAssessment.alertnessRisk)}% | Hazard\n                  Risk: {riskAssessment.hazardRisk}%\n                </div>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Button onClick={toggleProcessing} variant={isProcessing ? \"destructive\" : \"default\"} size=\"lg\">\n                {isProcessing ? \"Stop VASE\" : \"Start VASE\"}\n              </Button>\n            </div>\n          </div>\n        </motion.div>\n\n        <div className=\"grid lg:grid-cols-2 gap-6\">\n          {/* Front Camera - Drowsiness */}\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <Eye className=\"h-5 w-5 text-primary\" />\n                  <div>\n                    <CardTitle>Front Camera</CardTitle>\n                    <CardDescription>Driver Alertness Monitoring</CardDescription>\n                  </div>\n                </div>\n                <Button onClick={toggleFrontCamera} variant={frontCameraActive ? \"destructive\" : \"outline\"} size=\"sm\">\n                  {frontCameraActive ? <VideoOff className=\"h-4 w-4\" /> : <Video className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"relative aspect-video bg-secondary/30\">\n                <video ref={frontVideoRef} autoPlay playsInline muted className=\"w-full h-full object-cover\" />\n                <canvas ref={frontCanvasRef} className=\"absolute inset-0 w-full h-full pointer-events-none\" />\n\n                {!frontCameraActive && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <Eye className=\"h-12 w-12 text-muted-foreground/30 mx-auto mb-2\" />\n                      <p className=\"text-sm text-muted-foreground\">Front camera for drowsiness detection</p>\n                    </div>\n                  </div>\n                )}\n\n                {/* Drowsiness Overlay */}\n                {frontCameraActive && drowsiness && (\n                  <div className=\"absolute bottom-4 left-4 right-4 bg-background/80 backdrop-blur rounded-lg p-3\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-sm font-medium\">Alertness</span>\n                      <span className={`text-lg font-bold ${getStatusColor(riskAssessment.overallStatus)}`}>\n                        {Math.round(alertnessWindow.average)}%\n                      </span>\n                    </div>\n                    <Progress value={alertnessWindow.average} className=\"h-2\" />\n                    <div className=\"flex justify-between text-xs text-muted-foreground mt-2\">\n                      <span>EAR: {drowsiness.eyeAspectRatio.toFixed(3)}</span>\n                      <span>Blinks/min: {drowsiness.blinkFrequency}</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Rear Camera - Hazards */}\n          <Card>\n            <CardHeader className=\"pb-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <AlertTriangle className=\"h-5 w-5 text-warning\" />\n                  <div>\n                    <CardTitle>Rear Camera</CardTitle>\n                    <CardDescription>Road Hazard Detection</CardDescription>\n                  </div>\n                </div>\n                <Button onClick={toggleRearCamera} variant={rearCameraActive ? \"destructive\" : \"outline\"} size=\"sm\">\n                  {rearCameraActive ? <VideoOff className=\"h-4 w-4\" /> : <Camera className=\"h-4 w-4\" />}\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <div className=\"relative aspect-video bg-secondary/30\">\n                <video ref={rearVideoRef} autoPlay playsInline muted className=\"w-full h-full object-cover\" />\n                <canvas ref={rearCanvasRef} className=\"absolute inset-0 w-full h-full pointer-events-none\" />\n\n                {!rearCameraActive && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"text-center\">\n                      <Camera className=\"h-12 w-12 text-muted-foreground/30 mx-auto mb-2\" />\n                      <p className=\"text-sm text-muted-foreground\">Rear camera for hazard detection</p>\n                    </div>\n                  </div>\n                )}\n\n                {/* Hazard Overlay */}\n                {rearCameraActive && hazards.length > 0 && (\n                  <div className=\"absolute top-4 right-4\">\n                    <Badge variant=\"destructive\" className=\"animate-pulse\">\n                      {hazards.length} Hazard{hazards.length > 1 ? \"s\" : \"\"} Detected\n                    </Badge>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Bottom Row */}\n        <div className=\"grid lg:grid-cols-3 gap-6 mt-6\">\n          {/* Risk Meter */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Gauge className=\"h-5 w-5\" />\n                Unified Risk Meter\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div className=\"relative h-32 flex items-end justify-center\">\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className={`text-5xl font-bold ${getStatusColor(riskAssessment.overallStatus)}`}>\n                      {riskAssessment.riskScore}%\n                    </div>\n                  </div>\n                </div>\n                <div className=\"h-4 rounded-full bg-gradient-to-r from-success via-warning to-destructive overflow-hidden\">\n                  <motion.div\n                    className=\"h-full bg-foreground/20\"\n                    style={{ marginLeft: `${riskAssessment.riskScore}%` }}\n                    animate={{ marginLeft: `${riskAssessment.riskScore}%` }}\n                  />\n                </div>\n                <div className=\"flex justify-between text-xs text-muted-foreground\">\n                  <span>Safe</span>\n                  <span>Caution</span>\n                  <span>High Risk</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Current Detections */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <AlertTriangle className=\"h-5 w-5\" />\n                Active Hazards\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {hazards.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">\n                  <Shield className=\"h-8 w-8 mx-auto mb-2 opacity-30\" />\n                  <p className=\"text-sm\">No hazards detected</p>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {hazards.map((hazard) => (\n                    <div key={hazard.id} className=\"p-3 rounded-lg bg-warning/10 border border-warning/20\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"font-medium\">{hazardLabels[hazard.objectClass]}</span>\n                        <Badge\n                          variant={hazard.severity === \"critical\" ? \"destructive\" : \"secondary\"}\n                          className=\"text-xs\"\n                        >\n                          {hazard.severity}\n                        </Badge>\n                      </div>\n                      <div className=\"text-sm text-muted-foreground mt-1\">\n                        Confidence: {Math.round(hazard.confidence * 100)}%\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Settings & Alert History */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Bell className=\"h-5 w-5\" />\n                Settings & Alerts\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  {soundEnabled ? <Volume2 className=\"h-4 w-4\" /> : <VolumeX className=\"h-4 w-4\" />}\n                  <Label htmlFor=\"sound\">Alert Sound</Label>\n                </div>\n                <Switch id=\"sound\" checked={soundEnabled} onCheckedChange={setSoundEnabled} />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"emergency\" className=\"flex items-center gap-2\">\n                  <Bell className=\"h-4 w-4\" />\n                  Emergency Email\n                </Label>\n                <Input\n                  id=\"emergency\"\n                  type=\"email\"\n                  placeholder=\"emergency@example.com\"\n                  value={emergencyContact}\n                  onChange={(e) => setEmergencyContact(e.target.value)}\n                />\n              </div>\n\n              {alertHistory.length > 0 && (\n                <div className=\"pt-4 border-t border-border\">\n                  <div className=\"text-sm font-medium mb-2\">Recent Alerts</div>\n                  <div className=\"space-y-1 max-h-32 overflow-y-auto\">\n                    {alertHistory.slice(-3).map((alert, i) => (\n                      <div key={i} className=\"text-xs text-muted-foreground flex justify-between\">\n                        <span className=\"truncate flex-1\">{alert.message}</span>\n                        <span>{alert.time.toLocaleTimeString()}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      {/* Fullscreen Alert Overlay */}\n      <AnimatePresence>\n        {showAlert && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className={`fixed inset-0 z-50 backdrop-blur-sm flex items-center justify-center ${\n              riskAssessment.overallStatus === \"high-risk\" ? \"bg-destructive/20\" : \"bg-warning/20\"\n            }`}\n            onClick={() => setShowAlert(false)}\n          >\n            <motion.div\n              initial={{ scale: 0.8 }}\n              animate={{ scale: 1 }}\n              exit={{ scale: 0.8 }}\n              className={`${\n                riskAssessment.overallStatus === \"high-risk\" ? \"bg-destructive\" : \"bg-warning\"\n              } text-white p-8 rounded-2xl text-center max-w-md mx-4`}\n            >\n              <AlertTriangle className=\"h-16 w-16 mx-auto mb-4 animate-pulse\" />\n              <h2 className=\"text-2xl font-bold mb-2\">\n                {riskAssessment.overallStatus === \"high-risk\" ? \"DANGER DETECTED\" : \"CAUTION\"}\n              </h2>\n              <p className=\"mb-4\">{riskAssessment.alertMessage}</p>\n              <Button variant=\"secondary\" onClick={() => setShowAlert(false)}>\n                Acknowledge\n              </Button>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcA;AACA;AAEA;AA/BA;;;;;;;;;;;;;;;;;;AAsCA,sBAAsB;AACtB,MAAM,eAAuC;IAC3C,KAAK;IACL,KAAK;IACL,SAAS;IACT,SAAS;IACT,QAAQ;IACR,YAAY;IACZ,gBAAgB;IAChB,aAAa;AACf;AAEe,SAAS;IACtB,cAAc;IACd,MAAM,gBAAgB,IAAA,+MAAM,EAAmB;IAC/C,MAAM,eAAe,IAAA,+MAAM,EAAmB;IAC9C,MAAM,iBAAiB,IAAA,+MAAM,EAAoB;IACjD,MAAM,gBAAgB,IAAA,+MAAM,EAAoB;IAEhD,QAAQ;IACR,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,iNAAQ,EAAC;IAC3D,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IACzD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IAEzD,aAAa;IACb,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAA2B;IACvE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAoB,EAAE;IAC5D,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAqB;QACvE,eAAe;QACf,WAAW;QACX,eAAe;QACf,YAAY;QACZ,WAAW,KAAK,GAAG;QACnB,aAAa;QACb,cAAc;IAChB;IACA,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAkB,IAAM,IAAA,8IAAqB;IACnG,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAA0D,EAAE;IAE5G,MAAM,WAAW,IAAA,+MAAM,EAA0B;IACjD,MAAM,kBAAkB,IAAA,+MAAM,EAAc;IAC5C,MAAM,eAAe,IAAA,+MAAM,EAAgB;IAC3C,MAAM,gBAAgB,IAAA,+MAAM,EAAC;IAC7B,MAAM,iBAAiB,IAAA,+MAAM,EAAC;IAC9B,MAAM,kBAAkB,IAAA,+MAAM,EAAC;IAC/B,MAAM,sBAAsB,IAAA,+MAAM,EAAC;IAEnC,qFAAqF;IACrF,6EAA6E;IAC7E,6BAA6B;IAC7B,4DAA4D;IAC5D,uDAAuD;IACvD,uGAAuG;IAEvG,aAAa;IACb,kDAAkD;IAClD,2DAA2D;IAC3D,uDAAuD;IACvD,2DAA2D;IAC3D,qCAAqC;IACrC,4CAA4C;IAC5C,wCAAwC;IACxC,qCAAqC;IACrC,+BAA+B;IAC/B,MAAM;IACN,SAAS;IAET,+DAA+D;IAC/D,yEAAyE;IACzE,uCAAuC;IAEvC,2FAA2F;IAC3F,iGAAiG;IACjG,kDAAkD;IAElD,gFAAgF;IAChF,sDAAsD;IACtD,8DAA8D;IAC9D,+DAA+D;IAC/D,iDAAiD;IACjD,mDAAmD;IAEnD,aAAa;IACb,QAAQ;IACR,6BAA6B;IAC7B,oCAAoC;IACpC,oBAAoB;IACpB,kBAAkB;IAClB,gBAAgB;IAChB,wCAAwC;IACxC,wCAAwC;IACxC,6CAA6C;IAC7C,6CAA6C;IAC7C,WAAW;IACX,+BAA+B;IAC/B,SAAS;IACT,MAAM;IACN,SAAS;IAET,sBAAsB;IACtB,MAAM,eAAe,IAAA,oNAAW,EAAC;QACjC,qBAAqB;QACrB,IAAI,gBAAgB;QACpB,IAAI,qBAAqB,cAAc,OAAO,EAAE;YAC9C,IAAI;gBACF,MAAM,KAAK,MAAM,IAAA,8IAA0B,EAAC,cAAc,OAAO;gBACjE,IAAI,IAAI;oBACN,gBAAgB;oBAChB,cAAc;oBACd,MAAM,YAAY,IAAA,8IAAqB,EAAC,iBAAiB,GAAG,cAAc;oBAC1E,mBAAmB;gBACrB;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,oCAAoC;YACpD;QACF,OAAO;YACL,oDAAoD;YACpD,gBAAgB;QAClB;QAEA,iBAAiB;QACjB,IAAI,aAAoB,EAAE;QAC1B,IAAI,oBAAoB,aAAa,OAAO,EAAE;YAC5C,IAAI;gBACF,aAAa,MAAM,IAAA,0IAAsB,EAAC,aAAa,OAAO;gBAC9D,WAAW;YACb,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,gCAAgC;gBAC9C,aAAa,EAAE;YACjB;QACF,OAAO;YACL,aAAa,EAAE;YACf,WAAW,EAAE;QACf;QAEA,qDAAqD;QACrD,MAAM,WAAW,gBAAgB,OAAO;QACxC,MAAM,aAAa,IAAA,mIAAU,EAAC,eAAe,YAAY;QACzD,kBAAkB;QAElB,uCAAuC;QACvC,IAAI,eAAe;YACjB,gBAAgB,OAAO,IAAI,cAAc,cAAc;YACvD,oBAAoB,OAAO,IAAI;QACjC;QACA,eAAe,OAAO,IAAI,WAAW,MAAM;QAE3C,mDAAmD;QACnD,IAAI,eAAe;YACjB,IAAA,kJAAkB,EAAC;gBACjB,gBAAgB,cAAc,cAAc;gBAC5C,KAAK,cAAc,cAAc;gBACjC,gBAAgB,cAAc,cAAc;gBAC5C,gBAAgB,WAAW,WAAW;gBACtC,WAAW,aAAa,OAAO;YACjC;QACF;QAEA,IAAI,WAAW,MAAM,GAAG,GAAG;YACzB,IAAA,+IAAe,EAAC,YAAY,aAAa,OAAO;QAClD;QAEA,+BAA+B;QAC/B,IAAI,WAAW,WAAW,IAAI,CAAC,WAAW;YACxC,cAAc,OAAO,IAAI;YACzB,aAAa;YACb,gBAAgB,CAAC,OAAS;uBACrB,KAAK,KAAK,CAAC,CAAC;oBACf;wBAAE,MAAM,IAAI;wBAAQ,SAAS,WAAW,YAAY,IAAI;wBAAS,QAAQ,WAAW,aAAa;oBAAC;iBACnG;YACD,IAAI,gBAAgB,SAAS,OAAO,EAAE,SAAS,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,KAAO;YAC3E,MAAM,WACJ,WAAW,aAAa,KAAK,cACzB,aACA,WAAW,aAAa,KAAK,YAC3B,WACA;YAER,gDAAgD;YAChD,IAAA,4IAAY,EAAC;gBACX,WAAW,aAAa,OAAO;gBAC/B;gBACA,OAAO,WAAW,YAAY,IAAI;gBAClC,aAAa,WAAW,YAAY;YACtC;YAEA,sEAAsE;YACtE,MAAM,qBAAqB;YAC3B,MAAM,sBAAsB;gBAAC;gBAAO;gBAAW;gBAAQ;gBAAO;gBAAQ;gBAAe;gBAAW;aAAS;YACzG,MAAM,wBAAwB,WAAW,IAAI,CAAC,CAAA,IAAK,oBAAoB,QAAQ,CAAC,EAAE,WAAW;YAC7F,MAAM,2BAA2B,iBAAiB,cAAc,cAAc,GAAG;YAEjF,IAAI,4BAA4B,uBAAuB;gBACrD,MAAM,UAAU,iBAAiB,IAAI,MAAM;gBAC3C,IAAI,UAAU;gBACd,IAAI,4BAA4B,uBAAuB;oBACrD,UAAU,CAAC,qBAAqB,EAAE,cAAe,cAAc,CAAC,uCAAuC,EAAE,WAAW,MAAM,CAAC,CAAA,IAAK,oBAAoB,QAAQ,CAAC,EAAE,WAAW,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW,EAAE,IAAI,CAAC,MAAM,0CAA0C,CAAC;gBAC7P,OAAO,IAAI,0BAA0B;oBACnC,UAAU,CAAC,qBAAqB,EAAE,cAAe,cAAc,CAAC,2CAA2C,CAAC;gBAC9G,OAAO,IAAI,uBAAuB;oBAChC,UAAU,CAAC,gCAAgC,EAAE,WAAW,MAAM,CAAC,CAAA,IAAK,oBAAoB,QAAQ,CAAC,EAAE,WAAW,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,WAAW,EAAE,IAAI,CAAC,MAAM,wCAAwC,CAAC;gBAC/L;gBAEA,MAAM,oBAAoB;oBACxB,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,SAAS;wBACT;wBACA,IAAI;oBACN;gBACF,GAAG,KAAK,CAAC;gBACP,gDAAgD;gBAClD;YACF;YACA,WAAW,IAAM,aAAa,QAAQ;QACxC;QAEA,iDAAiD;QACjD,eAAe;IACjB,GAAG;QAAC;QAAmB;QAAkB;QAAiB;QAAY;QAAW;KAAa;IAE5F,4CAA4C;IAC5C,MAAM,iBAAiB,CAAC;QACtB,MAAM,SAAS,cAAc,OAAO;QACpC,MAAM,QAAQ,aAAa,OAAO;QAClC,IAAI,CAAC,UAAU,CAAC,OAAO;QAEvB,MAAM,MAAM,OAAO,UAAU,CAAC;QAC9B,IAAI,CAAC,KAAK;QAEV,OAAO,KAAK,GAAG,MAAM,UAAU,IAAI;QACnC,OAAO,MAAM,GAAG,MAAM,WAAW,IAAI;QACrC,IAAI,SAAS,CAAC,GAAG,GAAG,OAAO,KAAK,EAAE,OAAO,MAAM;QAE/C,WAAW,OAAO,CAAC,CAAC;YAClB,MAAM,IAAI,IAAI,IAAI,CAAC,CAAC,GAAG,OAAO,KAAK;YACnC,MAAM,IAAI,IAAI,IAAI,CAAC,CAAC,GAAG,OAAO,MAAM;YACpC,MAAM,IAAI,IAAI,IAAI,CAAC,KAAK,GAAG,OAAO,KAAK;YACvC,MAAM,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,OAAO,MAAM;YAEzC,0BAA0B;YAC1B,MAAM,SAAS;gBACb,UAAU;gBACV,MAAM;gBACN,QAAQ;gBACR,KAAK;YACP;YACA,IAAI,WAAW,GAAG,MAAM,CAAC,IAAI,QAAQ,CAAC;YACtC,IAAI,SAAS,GAAG;YAChB,IAAI,UAAU,CAAC,GAAG,GAAG,GAAG;YAExB,QAAQ;YACR,MAAM,QAAQ,GAAG,YAAY,CAAC,IAAI,WAAW,CAAC,IAAI,IAAI,WAAW,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,IAAI,UAAU,GAAG,KAAK,CAAC,CAAC;YACxG,IAAI,SAAS,GAAG,IAAI,WAAW;YAC/B,MAAM,YAAY,IAAI,WAAW,CAAC,OAAO,KAAK;YAC9C,IAAI,QAAQ,CAAC,GAAG,IAAI,IAAI,YAAY,IAAI;YACxC,IAAI,SAAS,GAAG;YAChB,IAAI,IAAI,GAAG;YACX,IAAI,QAAQ,CAAC,OAAO,IAAI,GAAG,IAAI;QACjC;IACF;IAEA,uCAAuC;IACvC,MAAM,oBAAoB;QACxB,IAAI,mBAAmB;YACrB,MAAM,SAAS,cAAc,OAAO,EAAE;YACtC,QAAQ,YAAY,QAAQ,CAAC,QAAU,MAAM,IAAI;YACjD,IAAI,cAAc,OAAO,EAAE,cAAc,OAAO,CAAC,SAAS,GAAG;YAC7D,qBAAqB;QACvB,OAAO;YACL,IAAI;gBACF,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;oBACvD,OAAO;wBAAE,YAAY;wBAAQ,OAAO;wBAAK,QAAQ;oBAAI;gBACvD;gBACA,IAAI,cAAc,OAAO,EAAE;oBACzB,cAAc,OAAO,CAAC,SAAS,GAAG;oBAClC,qBAAqB;oBACrB,IAAI,CAAC,gBAAgB,OAAO,EAAE,gBAAgB,OAAO,GAAG,IAAI;gBAC9D;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,+BAA+B;YAC/C;QACF;IACF;IAEA,mCAAmC;IACnC,MAAM,mBAAmB;QACvB,IAAI,kBAAkB;YACpB,MAAM,SAAS,aAAa,OAAO,EAAE;YACrC,QAAQ,YAAY,QAAQ,CAAC,QAAU,MAAM,IAAI;YACjD,IAAI,aAAa,OAAO,EAAE,aAAa,OAAO,CAAC,SAAS,GAAG;YAC3D,oBAAoB;QACtB,OAAO;YACL,IAAI;gBACF,MAAM,SAAS,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;oBACvD,OAAO;wBAAE,YAAY;wBAAe,OAAO;wBAAM,QAAQ;oBAAI;gBAC/D;gBACA,IAAI,aAAa,OAAO,EAAE;oBACxB,aAAa,OAAO,CAAC,SAAS,GAAG;oBACjC,oBAAoB;oBACpB,IAAI,CAAC,gBAAgB,OAAO,EAAE,gBAAgB,OAAO,GAAG,IAAI;gBAC9D;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,8BAA8B;YAC9C;QACF;IACF;IAEA,oBAAoB;IACpB,MAAM,mBAAmB;QACvB,IAAI,CAAC,cAAc;YACjB,8BAA8B;YAC9B,IAAA,gJAAgB,IAAG,IAAI,CAAC,CAAC;gBACvB,aAAa,OAAO,GAAG;gBACvB,cAAc,OAAO,GAAG;gBACxB,eAAe,OAAO,GAAG;gBACzB,gBAAgB,OAAO,GAAG;gBAC1B,oBAAoB,OAAO,GAAG;YAChC;QACF,OAAO;YACL,mCAAmC;YACnC,IAAI,aAAa,OAAO,EAAE;gBACxB,MAAM,mBACJ,oBAAoB,OAAO,GAAG,IAAI,gBAAgB,OAAO,GAAG,oBAAoB,OAAO,GAAG;gBAE5F,IAAA,8IAAc,EAAC;oBACb,WAAW,aAAa,OAAO;oBAC/B,WAAW,gBAAgB,OAAO;oBAClC,aAAa,cAAc,OAAO;oBAClC;oBACA,iBAAiB,eAAe,OAAO;oBACvC,0BAA0B;gBAC5B;YACF;YACA,aAAa,OAAO,GAAG;QACzB;QACA,gBAAgB,CAAC;IACnB;IAEA,qCAAqC;IACrC,IAAA,kNAAS,EAAC;QACV,IAAI,CAAC,cAAc;QAEnB,IAAI,SAAS;QAEb,MAAM,OAAO;YACX,MAAO,UAAU,aAAc;gBAC7B,MAAM,gBAAe,2BAA2B;gBAChD,MAAM,IAAI,QAAQ,CAAC,IAAM,WAAW,GAAG,OAAM,cAAc;YAC7D;QACF;QAEA;QAEA,OAAO;YACL,SAAS;QACX;IACF,GAAG;QAAC;QAAc;KAAa;IAC7B,8CAA8C;IAChD,IAAA,kNAAS,EAAC;QACR,wCAAmC,QAAO,uBAAuB;;;QAEjE,IAAI;IAcN,GAAG,EAAE;IAEH,qBAAqB;IACrB,MAAM,mBAAmB,CAAC;QACxB,OAAQ;YACN,KAAK;gBACH,OAAO;oBAAE,OAAO;oBAAQ,IAAI;oBAAc,MAAM;gBAAe;YACjE,KAAK;gBACH,OAAO;oBAAE,OAAO;oBAAW,IAAI;oBAAc,MAAM;gBAAe;YACpE,KAAK;gBACH,OAAO;oBAAE,OAAO;oBAAa,IAAI;oBAAkB,MAAM;gBAAmB;QAChF;IACF;IAEA,MAAM,gBAAgB,iBAAiB,eAAe,aAAa;IAEnE,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAM,KAAK;gBAAU,SAAQ;0BAC5B,cAAA,8OAAC;oBACC,KAAI;oBACJ,MAAK;;;;;;;;;;;0BAKT,8OAAC;gBAAO,WAAU;0BAChB,cAAA,8OAAC;oBAAI,WAAU;8BACb,cAAA,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC,uKAAI;wCACH,MAAK;wCACL,WAAU;;0DAEV,8OAAC,6NAAS;gDAAC,WAAU;;;;;;0DACrB,8OAAC;gDAAK,WAAU;0DAAmB;;;;;;;;;;;;kDAErC,8OAAC,yJAAY;wCAAC,MAAK;;;;;;;;;;;;0CAErB,8OAAC,mIAAK;gCAAC,SAAQ;gCAAY,WAAU;;kDACnC,8OAAC,gNAAM;wCAAC,WAAU;;;;;;oCAAY;;;;;;;;;;;;;;;;;;;;;;;0BAOtC,8OAAC;gBAAK,WAAU;;kCAEd,8OAAC,oMAAM,CAAC,GAAG;wBACT,WAAW,CAAC,2BAA2B,EACrC,eAAe,aAAa,KAAK,cAC7B,yCACA,eAAe,aAAa,KAAK,YAC/B,iCACA,gCACN;wBACF,SAAS,eAAe,WAAW,GAAG;4BAAE,OAAO;gCAAC;gCAAG;gCAAM;6BAAE;wBAAC,IAAI,CAAC;wBACjE,YAAY;4BAAE,UAAU;4BAAK,QAAQ,eAAe,WAAW,GAAG,OAAO,iBAAiB,GAAG;wBAAE;kCAE/F,cAAA,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAW,CAAC,wDAAwD,EAAE,cAAc,EAAE,EAAE;sDAC3F,cAAA,8OAAC,gNAAM;gDAAC,WAAU;;;;;;;;;;;sDAEpB,8OAAC;;8DACC,8OAAC;oDAAI,WAAW,CAAC,mBAAmB,EAAE,cAAc,IAAI,EAAE;8DAAG,cAAc,KAAK;;;;;;8DAChF,8OAAC;oDAAI,WAAU;;wDAAgC;wDAChC,eAAe,SAAS;wDAAC;wDAAqB,KAAK,KAAK,CAAC,eAAe,aAAa;wDAAE;wDAC7F,eAAe,UAAU;wDAAC;;;;;;;;;;;;;;;;;;;8CAIvC,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC,qIAAM;wCAAC,SAAS;wCAAkB,SAAS,eAAe,gBAAgB;wCAAW,MAAK;kDACxF,eAAe,cAAc;;;;;;;;;;;;;;;;;;;;;;kCAMtC,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC,iIAAI;;kDACH,8OAAC,uIAAU;wCAAC,WAAU;kDACpB,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,uMAAG;4DAAC,WAAU;;;;;;sEACf,8OAAC;;8EACC,8OAAC,sIAAS;8EAAC;;;;;;8EACX,8OAAC,4IAAe;8EAAC;;;;;;;;;;;;;;;;;;8DAGrB,8OAAC,qIAAM;oDAAC,SAAS;oDAAmB,SAAS,oBAAoB,gBAAgB;oDAAW,MAAK;8DAC9F,kCAAoB,8OAAC,0NAAQ;wDAAC,WAAU;;;;;6EAAe,8OAAC,6MAAK;wDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kDAI/E,8OAAC,wIAAW;wCAAC,WAAU;kDACrB,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAM,KAAK;oDAAe,QAAQ;oDAAC,WAAW;oDAAC,KAAK;oDAAC,WAAU;;;;;;8DAChE,8OAAC;oDAAO,KAAK;oDAAgB,WAAU;;;;;;gDAEtC,CAAC,mCACA,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC;wDAAI,WAAU;;0EACb,8OAAC,uMAAG;gEAAC,WAAU;;;;;;0EACf,8OAAC;gEAAE,WAAU;0EAAgC;;;;;;;;;;;;;;;;;gDAMlD,qBAAqB,4BACpB,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;oEAAK,WAAU;8EAAsB;;;;;;8EACtC,8OAAC;oEAAK,WAAW,CAAC,kBAAkB,EAAE,IAAA,uIAAc,EAAC,eAAe,aAAa,GAAG;;wEACjF,KAAK,KAAK,CAAC,gBAAgB,OAAO;wEAAE;;;;;;;;;;;;;sEAGzC,8OAAC,yIAAQ;4DAAC,OAAO,gBAAgB,OAAO;4DAAE,WAAU;;;;;;sEACpD,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;;wEAAK;wEAAM,WAAW,cAAc,CAAC,OAAO,CAAC;;;;;;;8EAC9C,8OAAC;;wEAAK;wEAAa,WAAW,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CASxD,8OAAC,iIAAI;;kDACH,8OAAC,uIAAU;wCAAC,WAAU;kDACpB,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;;sEACb,8OAAC,yOAAa;4DAAC,WAAU;;;;;;sEACzB,8OAAC;;8EACC,8OAAC,sIAAS;8EAAC;;;;;;8EACX,8OAAC,4IAAe;8EAAC;;;;;;;;;;;;;;;;;;8DAGrB,8OAAC,qIAAM;oDAAC,SAAS;oDAAkB,SAAS,mBAAmB,gBAAgB;oDAAW,MAAK;8DAC5F,iCAAmB,8OAAC,0NAAQ;wDAAC,WAAU;;;;;6EAAe,8OAAC,gNAAM;wDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;kDAI/E,8OAAC,wIAAW;wCAAC,WAAU;kDACrB,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAM,KAAK;oDAAc,QAAQ;oDAAC,WAAW;oDAAC,KAAK;oDAAC,WAAU;;;;;;8DAC/D,8OAAC;oDAAO,KAAK;oDAAe,WAAU;;;;;;gDAErC,CAAC,kCACA,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC;wDAAI,WAAU;;0EACb,8OAAC,gNAAM;gEAAC,WAAU;;;;;;0EAClB,8OAAC;gEAAE,WAAU;0EAAgC;;;;;;;;;;;;;;;;;gDAMlD,oBAAoB,QAAQ,MAAM,GAAG,mBACpC,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC,mIAAK;wDAAC,SAAQ;wDAAc,WAAU;;4DACpC,QAAQ,MAAM;4DAAC;4DAAQ,QAAQ,MAAM,GAAG,IAAI,MAAM;4DAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAUpE,8OAAC;wBAAI,WAAU;;0CAEb,8OAAC,iIAAI;;kDACH,8OAAC,uIAAU;kDACT,cAAA,8OAAC,sIAAS;4CAAC,WAAU;;8DACnB,8OAAC,6MAAK;oDAAC,WAAU;;;;;;gDAAY;;;;;;;;;;;;kDAIjC,8OAAC,wIAAW;kDACV,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC;wDAAI,WAAU;kEACb,cAAA,8OAAC;4DAAI,WAAW,CAAC,mBAAmB,EAAE,IAAA,uIAAc,EAAC,eAAe,aAAa,GAAG;;gEACjF,eAAe,SAAS;gEAAC;;;;;;;;;;;;;;;;;8DAIhC,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC,oMAAM,CAAC,GAAG;wDACT,WAAU;wDACV,OAAO;4DAAE,YAAY,GAAG,eAAe,SAAS,CAAC,CAAC,CAAC;wDAAC;wDACpD,SAAS;4DAAE,YAAY,GAAG,eAAe,SAAS,CAAC,CAAC,CAAC;wDAAC;;;;;;;;;;;8DAG1D,8OAAC;oDAAI,WAAU;;sEACb,8OAAC;sEAAK;;;;;;sEACN,8OAAC;sEAAK;;;;;;sEACN,8OAAC;sEAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CAOd,8OAAC,iIAAI;;kDACH,8OAAC,uIAAU;kDACT,cAAA,8OAAC,sIAAS;4CAAC,WAAU;;8DACnB,8OAAC,yOAAa;oDAAC,WAAU;;;;;;gDAAY;;;;;;;;;;;;kDAIzC,8OAAC,wIAAW;kDACT,QAAQ,MAAM,KAAK,kBAClB,8OAAC;4CAAI,WAAU;;8DACb,8OAAC,gNAAM;oDAAC,WAAU;;;;;;8DAClB,8OAAC;oDAAE,WAAU;8DAAU;;;;;;;;;;;iEAGzB,8OAAC;4CAAI,WAAU;sDACZ,QAAQ,GAAG,CAAC,CAAC,uBACZ,8OAAC;oDAAoB,WAAU;;sEAC7B,8OAAC;4DAAI,WAAU;;8EACb,8OAAC;oEAAK,WAAU;8EAAe,YAAY,CAAC,OAAO,WAAW,CAAC;;;;;;8EAC/D,8OAAC,mIAAK;oEACJ,SAAS,OAAO,QAAQ,KAAK,aAAa,gBAAgB;oEAC1D,WAAU;8EAET,OAAO,QAAQ;;;;;;;;;;;;sEAGpB,8OAAC;4DAAI,WAAU;;gEAAqC;gEACrC,KAAK,KAAK,CAAC,OAAO,UAAU,GAAG;gEAAK;;;;;;;;mDAX3C,OAAO,EAAE;;;;;;;;;;;;;;;;;;;;;0CAqB7B,8OAAC,iIAAI;;kDACH,8OAAC,uIAAU;kDACT,cAAA,8OAAC,sIAAS;4CAAC,WAAU;;8DACnB,8OAAC,0MAAI;oDAAC,WAAU;;;;;;gDAAY;;;;;;;;;;;;kDAIhC,8OAAC,wIAAW;wCAAC,WAAU;;0DACrB,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAI,WAAU;;4DACZ,6BAAe,8OAAC,uNAAO;gEAAC,WAAU;;;;;qFAAe,8OAAC,uNAAO;gEAAC,WAAU;;;;;;0EACrE,8OAAC,mIAAK;gEAAC,SAAQ;0EAAQ;;;;;;;;;;;;kEAEzB,8OAAC,qIAAM;wDAAC,IAAG;wDAAQ,SAAS;wDAAc,iBAAiB;;;;;;;;;;;;0DAG7D,8OAAC;gDAAI,WAAU;;kEACb,8OAAC,mIAAK;wDAAC,SAAQ;wDAAY,WAAU;;0EACnC,8OAAC,0MAAI;gEAAC,WAAU;;;;;;4DAAY;;;;;;;kEAG9B,8OAAC,mIAAK;wDACJ,IAAG;wDACH,MAAK;wDACL,aAAY;wDACZ,OAAO;wDACP,UAAU,CAAC,IAAM,oBAAoB,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;4CAItD,aAAa,MAAM,GAAG,mBACrB,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAI,WAAU;kEAA2B;;;;;;kEAC1C,8OAAC;wDAAI,WAAU;kEACZ,aAAa,KAAK,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,OAAO,kBAClC,8OAAC;gEAAY,WAAU;;kFACrB,8OAAC;wEAAK,WAAU;kFAAmB,MAAM,OAAO;;;;;;kFAChD,8OAAC;kFAAM,MAAM,IAAI,CAAC,kBAAkB;;;;;;;+DAF5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAc1B,8OAAC,4MAAe;0BACb,2BACC,8OAAC,oMAAM,CAAC,GAAG;oBACT,SAAS;wBAAE,SAAS;oBAAE;oBACtB,SAAS;wBAAE,SAAS;oBAAE;oBACtB,MAAM;wBAAE,SAAS;oBAAE;oBACnB,WAAW,CAAC,qEAAqE,EAC/E,eAAe,aAAa,KAAK,cAAc,sBAAsB,iBACrE;oBACF,SAAS,IAAM,aAAa;8BAE5B,cAAA,8OAAC,oMAAM,CAAC,GAAG;wBACT,SAAS;4BAAE,OAAO;wBAAI;wBACtB,SAAS;4BAAE,OAAO;wBAAE;wBACpB,MAAM;4BAAE,OAAO;wBAAI;wBACnB,WAAW,GACT,eAAe,aAAa,KAAK,cAAc,mBAAmB,aACnE,qDAAqD,CAAC;;0CAEvD,8OAAC,yOAAa;gCAAC,WAAU;;;;;;0CACzB,8OAAC;gCAAG,WAAU;0CACX,eAAe,aAAa,KAAK,cAAc,oBAAoB;;;;;;0CAEtE,8OAAC;gCAAE,WAAU;0CAAQ,eAAe,YAAY;;;;;;0CAChD,8OAAC,qIAAM;gCAAC,SAAQ;gCAAY,SAAS,IAAM,aAAa;0CAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAS9E"}}]
}